{"version":3,"file":"index.es.js","sources":["../src/modules/Status.js","../src/modules/Redirect.js","../src/modules/ServerRouter.js","../src/modules/Route.js","../src/server.js","../src/modules/BrowserRouter.js","../src/browser.js","../src/modules/ServerHistory.js","../src/plugin.js","../src/index.js"],"sourcesContent":["/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\n\nexport class Status extends React.Component<any> {\n  constructor(props: any, context: any) {\n    super(props, context);\n    const {\n      router: {staticContext},\n    } = context;\n    if (staticContext && staticContext.setCode) {\n      staticContext.setCode(parseInt(this.props.code, 10));\n    }\n  }\n\n  render() {\n    const children = this.props && this.props.children;\n    return Array.isArray(children) ? children[0] : children;\n  }\n}\n\nStatus.contextTypes = {\n  router: PropTypes.shape({\n    staticContext: PropTypes.object,\n  }),\n};\n\nexport const NotFound = (props: any) => (\n  <Status code={404}>{props.children}</Status>\n);\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\n\nexport class Redirect extends React.Component<any> {\n  constructor(props: any, context: any) {\n    super(props, context);\n    if (this.isStatic(context)) this.perform();\n  }\n\n  componentDidMount() {\n    if (!this.isStatic()) this.perform();\n  }\n\n  isStatic(context: any = this.context) {\n    return context.router && context.router.staticContext;\n  }\n\n  perform() {\n    const {history, staticContext} = this.context.router;\n    const {push, to, code} = this.props;\n\n    if (__NODE__ && staticContext) {\n      staticContext.setCode(parseInt(code, 10));\n      staticContext.redirect(to);\n      return;\n    }\n\n    if (push) {\n      history.push(to);\n    } else {\n      history.replace(to);\n    }\n  }\n\n  render() {\n    return null;\n  }\n}\n\n// $FlowFixMe\nRedirect.defaultProps = {\n  push: false,\n  code: 307,\n};\n\nRedirect.contextTypes = {\n  router: PropTypes.shape({\n    history: PropTypes.shape({\n      push: PropTypes.func.isRequired,\n      replace: PropTypes.func.isRequired,\n    }).isRequired,\n    staticContext: PropTypes.object,\n  }).isRequired,\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport React from 'react';\nimport {Router} from 'react-router-dom';\n\n/**\n * The public top-level API for a \"static\" <Router>, so-called because it\n * can't actually change the current location. Instead, it just records\n * location changes in a context object. Useful mainly in testing and\n * server-rendering scenarios.\n */\nexport class ServerRouter extends React.Component<any> {\n  getChildContext() {\n    return {\n      router: {\n        staticContext: this.props.context || {},\n      },\n      onRoute: (routeData: any) => this.props.onRoute(routeData),\n    };\n  }\n\n  render() {\n    const {Provider, history, basename, children} = this.props;\n    return (\n      <Provider basename={basename} history={history}>\n        {children}\n      </Provider>\n    );\n  }\n}\n\n// $FlowFixMe\nServerRouter.defaultProps = {\n  basename: '',\n  context: {},\n  Provider: Router,\n  onRoute: () => {},\n};\n\nServerRouter.childContextTypes = {\n  router: () => {},\n  onRoute: () => {},\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport {Route as ReactRouterRoute} from 'react-router-dom';\n\nconst isEmptyChildren = children => React.Children.count(children) === 0;\n\nfunction Route(props: any, context: any) {\n  const {trackingId, component, render, children, ...remainingProps} = props;\n\n  return (\n    <ReactRouterRoute\n      {...remainingProps}\n      // eslint-disable-next-line react/no-children-prop\n      children={routeProps => {\n        const {match} = routeProps;\n        if (match && match.isExact) {\n          context.onRoute({\n            page: match.path,\n            title: trackingId || match.path,\n          });\n        }\n\n        if (component)\n          return match ? React.createElement(component, routeProps) : null;\n\n        if (render) return match ? render(routeProps) : null;\n\n        if (typeof children === 'function') return children(routeProps);\n\n        if (children && !isEmptyChildren(children))\n          return React.Children.only(children);\n\n        return null;\n      }}\n    />\n  );\n}\n\nRoute.contextTypes = {\n  onRoute: PropTypes.func.isRequired,\n};\n\nRoute.displayName = 'FusionRoute';\n\nexport {Route};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport {\n  BrowserRouter,\n  HashRouter,\n  Link,\n  MemoryRouter,\n  NavLink,\n  Prompt,\n  Router as _Router,\n  Switch,\n  matchPath,\n  withRouter,\n} from 'react-router-dom';\n\nimport {Status, NotFound} from './modules/Status';\nimport {Redirect} from './modules/Redirect';\nimport {ServerRouter as Router} from './modules/ServerRouter';\nimport {Route} from './modules/Route';\n\nexport {\n  BrowserRouter,\n  HashRouter,\n  Link,\n  MemoryRouter,\n  NavLink,\n  Prompt,\n  _Router,\n  Switch,\n  matchPath,\n  withRouter,\n  Status,\n  NotFound,\n  Redirect,\n  Router,\n  Route,\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport {Router as BaseRouter} from 'react-router-dom';\n\nexport {Status, NotFound} from './Status';\nexport {Redirect} from './Redirect';\n\nclass BrowserRouter extends React.Component<any> {\n  lastTitle: any;\n\n  constructor(props: any = {}, context: any) {\n    super(props, context);\n    this.lastTitle = null;\n  }\n\n  getChildContext() {\n    const {__IS_PREPARE__} = this.context;\n    return {\n      onRoute: (routeData: any) => {\n        if (routeData.title !== this.lastTitle && !__IS_PREPARE__) {\n          this.lastTitle = routeData.title;\n          this.props.onRoute(routeData);\n        }\n      },\n    };\n  }\n\n  render() {\n    const {Provider, history, basename} = this.props;\n    return (\n      <Provider basename={basename} history={history}>\n        {this.props.children}\n      </Provider>\n    );\n  }\n}\n\nBrowserRouter.propTypes = {\n  children: PropTypes.node,\n  onRoute: PropTypes.func,\n  history: PropTypes.object,\n  Provider: PropTypes.any,\n  basename: PropTypes.string,\n};\n\nBrowserRouter.contextTypes = {\n  __IS_PREPARE__: PropTypes.bool,\n};\n\nBrowserRouter.childContextTypes = {\n  onRoute: PropTypes.func.isRequired,\n};\n\n// $FlowFixMe\nBrowserRouter.defaultProps = {\n  onRoute: () => {},\n  Provider: BaseRouter,\n};\n\nexport {BrowserRouter as Router};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport {\n  BrowserRouter,\n  HashRouter,\n  Link,\n  MemoryRouter,\n  NavLink,\n  Prompt,\n  StaticRouter,\n  Switch,\n  matchPath,\n  withRouter,\n} from 'react-router-dom';\n\nimport {Status, NotFound} from './modules/Status';\nimport {Redirect} from './modules/Redirect';\nimport {Router} from './modules/BrowserRouter';\nimport {Route} from './modules/Route';\n\nexport {\n  BrowserRouter,\n  HashRouter,\n  Link,\n  MemoryRouter,\n  NavLink,\n  Prompt,\n  StaticRouter,\n  Switch,\n  matchPath,\n  withRouter,\n  Status,\n  NotFound,\n  Redirect,\n  Router,\n  Route,\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\nimport {createPath, parsePath} from 'history';\nimport type {HistoryType, LocationType} from '../types';\n\nconst addLeadingSlash = path => (path.charAt(0) === '/' ? path : '/' + path);\n\nconst addRoutePrefix = (\n  location: string | LocationType,\n  prefix: string\n): string | LocationType => {\n  if (!prefix) return location;\n  if (typeof location === 'string') {\n    return `${prefix}${addLeadingSlash(location)}`;\n  } else {\n    return {\n      ...location,\n      pathname: `${prefix}${addLeadingSlash(location.pathname)}`,\n    };\n  }\n};\n\nconst removeRoutePrefix = (\n  location: string | LocationType,\n  prefix: string\n): string | LocationType => {\n  if (!prefix) return location;\n  const pathname = typeof location === 'string' ? location : location.pathname;\n  const hasPrefix = (pathname + '/').indexOf(prefix + '/') === 0;\n  const unprefixedPathname = pathname.slice(prefix.length);\n  const relativePathname = hasPrefix ? unprefixedPathname : pathname;\n\n  if (typeof location === 'string') {\n    return relativePathname;\n  } else {\n    return {\n      ...location,\n      pathname: relativePathname,\n    };\n  }\n};\n\nconst createLocation = (\n  path: string | LocationType,\n  prefix: string\n): LocationType => {\n  const unprefixedPath = removeRoutePrefix(path, prefix);\n  return parsePath(unprefixedPath);\n};\n\nconst createPrefixedURL = (\n  location: string | LocationType,\n  prefix: string\n): string | LocationType => {\n  if (typeof location === 'string') {\n    return addRoutePrefix(location, prefix);\n  } else {\n    return createPath(addRoutePrefix(location, prefix));\n  }\n};\n\n/**\n * @param {string|object} location\n * @param {string} prefix\n * @returns {string}\n */\nconst createURL = (location, prefix) => {\n  if (typeof location === 'string') {\n    return removeRoutePrefix(location, prefix);\n  } else {\n    return createPath(removeRoutePrefix(location, prefix));\n  }\n};\n\nconst staticHandler = methodName => () => {\n  throw new Error(`You cannot ${methodName} with server side <Router>`);\n};\n\nconst noop = () => {};\n\ntype ContextType = {\n  action: ?string,\n  location: any,\n  url: ?string,\n};\n\nexport function createServerHistory(\n  basename: string,\n  context: ContextType,\n  location: string | LocationType\n): HistoryType {\n  function createHref(location: string | LocationType): string | LocationType {\n    return createPrefixedURL(location, basename);\n  }\n  function push(path: string) {\n    context.action = 'PUSH';\n    context.location = createLocation(path, basename);\n    // $FlowFixMe\n    context.url = createURL(path, basename);\n  }\n\n  function replace(path: string) {\n    context.action = 'REPLACE';\n    context.location = createLocation(path, basename);\n    // $FlowFixMe\n    context.url = createURL(path, basename);\n  }\n  const history = {\n    length: 0,\n    createHref,\n    action: 'POP',\n    location: createLocation(location, basename),\n    push,\n    replace,\n    go: staticHandler('go'),\n    goBack: staticHandler('back'),\n    goForward: staticHandler('forward'),\n    listen: () => noop,\n  };\n  return history;\n}\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\nimport {UniversalEventsToken} from 'fusion-plugin-universal-events';\nimport {createPlugin, createToken, html, unescape, memoize} from 'fusion-core';\nimport {Router as ServerRouter} from './server';\nimport {Router as BrowserRouter} from './browser';\nimport {Router as DefaultProvider} from 'react-router-dom';\nimport createBrowserHistory from 'history/createBrowserHistory';\nimport {createServerHistory} from './modules/ServerHistory';\nimport type {HistoryType} from './types';\nimport type {Token, Context} from 'fusion-core';\n\ntype ProviderPropsType = {\n  history: HistoryType,\n  basename: string,\n};\ntype HistoryWrapperType = {\n  from: (\n    ctx: Context\n  ) => {\n    history: HistoryType,\n  },\n};\n\nexport const RouterProviderToken: Token<\n  React.ComponentType<ProviderPropsType>\n> = createToken('RouterProvider');\n\nexport const RouterToken: Token<HistoryWrapperType> = createToken('Router');\n\nconst Router = __NODE__ ? ServerRouter : BrowserRouter;\n\nexport default createPlugin({\n  deps: {\n    emitter: UniversalEventsToken.optional,\n    Provider: RouterProviderToken.optional,\n  },\n  middleware: ({emitter, Provider = DefaultProvider}, self) => {\n    return async (ctx, next) => {\n      const prefix = ctx.prefix || '';\n      if (!ctx.element) {\n        return next();\n      }\n      const myAPI = self.from(ctx);\n      if (__NODE__) {\n        let pageData = {\n          title: ctx.path,\n          page: ctx.path,\n        };\n        const context = {\n          action: null,\n          location: null,\n          url: null,\n          setCode: code => {\n            ctx.status = code;\n          },\n          redirect: url => {\n            ctx.redirect(url);\n          },\n        };\n        // Expose the history object\n        const history = createServerHistory(prefix, context, prefix + ctx.url);\n        myAPI.history = history;\n        ctx.element = (\n          <Router\n            history={history}\n            Provider={Provider}\n            onRoute={d => {\n              pageData = d;\n            }}\n            basename={prefix}\n            context={context}\n          >\n            {ctx.element}\n          </Router>\n        );\n        return next().then(() => {\n          ctx.template.body.push(\n            html`<script id=\"__ROUTER_DATA__\" type=\"application/json\">${JSON.stringify(\n              pageData\n            )}</script>`\n          );\n\n          if (emitter) {\n            const emitTiming = type => timing => {\n              emitter.emit(type, {\n                title: pageData.title,\n                page: pageData.page,\n                status: ctx.status,\n                timing,\n              });\n            };\n            emitter.from(ctx).map(payload => {\n              if (payload && typeof payload === 'object') {\n                payload.__url__ = pageData.title;\n              }\n              return payload;\n            });\n            ctx.timing.end.then(timing => {\n              emitTiming('pageview:server')(timing);\n              ctx.timing.render.then(emitTiming('render:server'));\n            });\n          }\n        });\n      } else if (__BROWSER__) {\n        // TODO(#3): We should consider adding render/downstream/upstream timings for the browser\n        let pageData = {};\n        const element = document.getElementById('__ROUTER_DATA__');\n        if (element) {\n          pageData = JSON.parse(unescape(element.textContent));\n        }\n        emitter &&\n          emitter.map(payload => {\n            if (payload && typeof payload === 'object') {\n              payload.__url__ = pageData.title;\n            }\n            return payload;\n          });\n        // Expose the history object\n        const history = createBrowserHistory({basename: ctx.prefix});\n        myAPI.history = history;\n        ctx.element = (\n          <Router\n            history={history}\n            Provider={Provider}\n            basename={ctx.prefix}\n            onRoute={payload => {\n              pageData = payload;\n              emitter && emitter.emit('pageview:browser', payload);\n            }}\n          >\n            {ctx.element}\n          </Router>\n        );\n        return next();\n      }\n    };\n  },\n  provides() {\n    return {\n      from: memoize(() => {\n        const api: {history: HistoryType} = ({\n          history: null,\n        }: any);\n        return api;\n      }),\n    };\n  },\n});\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport plugin, {RouterProviderToken, RouterToken} from './plugin';\nimport * as server from './server';\nimport * as browser from './browser';\n\ndeclare var __BROWSER__: Boolean;\nconst BrowserRouter = __BROWSER__\n  ? browser.BrowserRouter\n  : server.BrowserRouter;\nconst HashRouter = __BROWSER__ ? browser.HashRouter : server.HashRouter;\nconst Link = __BROWSER__ ? browser.Link : server.Link;\nconst matchPath = __BROWSER__ ? browser.matchPath : server.matchPath;\nconst MemoryRouter = __BROWSER__ ? browser.MemoryRouter : server.MemoryRouter;\nconst NavLink = __BROWSER__ ? browser.NavLink : server.NavLink;\nconst Prompt = __BROWSER__ ? browser.Prompt : server.Prompt;\nconst Route = __BROWSER__ ? browser.Route : server.Route;\nconst Router = __BROWSER__ ? browser.Router : server.Router;\nconst Switch = __BROWSER__ ? browser.Switch : server.Switch;\nconst withRouter = __BROWSER__ ? browser.withRouter : server.withRouter;\n\nconst NotFound = __BROWSER__ ? browser.NotFound : server.NotFound;\nconst Redirect = __BROWSER__ ? browser.Redirect : server.Redirect;\nconst Status = __BROWSER__ ? browser.Status : server.Status;\n\nexport default plugin;\nexport {\n  BrowserRouter,\n  HashRouter,\n  Link,\n  matchPath,\n  MemoryRouter,\n  NavLink,\n  NotFound,\n  Prompt,\n  Redirect,\n  Route,\n  Router,\n  Status,\n  Switch,\n  withRouter,\n  RouterProviderToken,\n  RouterToken,\n};\n"],"names":["Status","React","Component","constructor","props","context","router","staticContext","setCode","parseInt","code","render","children","Array","isArray","contextTypes","PropTypes","shape","object","NotFound","Redirect","isStatic","perform","componentDidMount","history","push","to","redirect","replace","defaultProps","func","isRequired","ServerRouter","getChildContext","onRoute","routeData","Provider","basename","Router","childContextTypes","isEmptyChildren","Children","count","Route","trackingId","component","remainingProps","ReactRouterRoute","routeProps","match","isExact","page","path","title","createElement","only","displayName","BrowserRouter","lastTitle","__IS_PREPARE__","propTypes","node","any","string","bool","BaseRouter","addLeadingSlash","charAt","addRoutePrefix","location","prefix","pathname","removeRoutePrefix","hasPrefix","indexOf","unprefixedPathname","slice","length","relativePathname","createLocation","unprefixedPath","parsePath","createPrefixedURL","createPath","createURL","staticHandler","methodName","Error","noop","createServerHistory","createHref","action","url","go","goBack","goForward","listen","RouterProviderToken","createToken","RouterToken","createPlugin","deps","emitter","UniversalEventsToken","optional","middleware","DefaultProvider","self","ctx","next","element","myAPI","from","pageData","status","React.createElement","d","then","template","body","html","JSON","stringify","emitTiming","type","timing","emit","map","payload","__url__","end","provides","memoize","api","server","HashRouter","Link","matchPath","MemoryRouter","NavLink","Prompt","Switch","withRouter"],"mappings":"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"}