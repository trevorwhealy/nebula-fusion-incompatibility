export default `
#define SHADER_NAME mesh-layer-vs

// Scale the model
uniform float sizeScale;

// Primitive attributes
attribute vec3 positions;
attribute vec3 normals;
attribute vec2 texCoords;

// Instance attributes
attribute vec3 instancePositions;
attribute vec2 instancePositions64xy;
attribute vec3 instanceRotations;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

// Outputs to fragment shader
varying vec2 vTexCoord;
varying vec4 vColor;
varying float vLightWeight;

// yaw(z) pitch(y) roll(x)
mat3 getRotationMatrix(vec3 rotation) {
  float sr = sin(rotation.x);
  float sp = sin(rotation.y);
  float sw = sin(rotation.z);

  float cr = cos(rotation.x);
  float cp = cos(rotation.y);
  float cw = cos(rotation.z);

  return mat3(
    cw * cp,                  // 0,0
    sw * cp,                  // 1,0
    -sp,                      // 2,0
    -sw * cr + cw * sp * sr,  // 0,1
    cw * cr + sw * sp * sr,   // 1,1
    cp * sr,                  // 2,1
    sw * sr + cw * sp * cr,   // 0,2
    -cw * sr + sw * sp * cr,  // 1,2
    cp * cr                   // 2,2
  );
}

void main(void) {
  mat3 rotationMatrix = getRotationMatrix(instanceRotations);

  vec3 pos = positions;
  pos = project_scale(pos * sizeScale);
  pos = rotationMatrix * pos;

  vec4 worldPosition;
  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xy, pos, worldPosition);

  // TODO - transform normals

  picking_setPickingColor(instancePickingColors);

  vTexCoord = texCoords;
  vColor = instanceColors;
  vLightWeight = lighting_getLightWeight(worldPosition.xyz, project_normal(normals));
}
`;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tZXNoLWxheWVyL21lc2gtbGF5ZXItdmVydGV4Lmdsc2wuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsZUFBZ0I7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Q0FBaEIiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBgXG4jZGVmaW5lIFNIQURFUl9OQU1FIG1lc2gtbGF5ZXItdnNcblxuLy8gU2NhbGUgdGhlIG1vZGVsXG51bmlmb3JtIGZsb2F0IHNpemVTY2FsZTtcblxuLy8gUHJpbWl0aXZlIGF0dHJpYnV0ZXNcbmF0dHJpYnV0ZSB2ZWMzIHBvc2l0aW9ucztcbmF0dHJpYnV0ZSB2ZWMzIG5vcm1hbHM7XG5hdHRyaWJ1dGUgdmVjMiB0ZXhDb29yZHM7XG5cbi8vIEluc3RhbmNlIGF0dHJpYnV0ZXNcbmF0dHJpYnV0ZSB2ZWMzIGluc3RhbmNlUG9zaXRpb25zO1xuYXR0cmlidXRlIHZlYzIgaW5zdGFuY2VQb3NpdGlvbnM2NHh5O1xuYXR0cmlidXRlIHZlYzMgaW5zdGFuY2VSb3RhdGlvbnM7XG5hdHRyaWJ1dGUgdmVjNCBpbnN0YW5jZUNvbG9ycztcbmF0dHJpYnV0ZSB2ZWMzIGluc3RhbmNlUGlja2luZ0NvbG9ycztcblxuLy8gT3V0cHV0cyB0byBmcmFnbWVudCBzaGFkZXJcbnZhcnlpbmcgdmVjMiB2VGV4Q29vcmQ7XG52YXJ5aW5nIHZlYzQgdkNvbG9yO1xudmFyeWluZyBmbG9hdCB2TGlnaHRXZWlnaHQ7XG5cbi8vIHlhdyh6KSBwaXRjaCh5KSByb2xsKHgpXG5tYXQzIGdldFJvdGF0aW9uTWF0cml4KHZlYzMgcm90YXRpb24pIHtcbiAgZmxvYXQgc3IgPSBzaW4ocm90YXRpb24ueCk7XG4gIGZsb2F0IHNwID0gc2luKHJvdGF0aW9uLnkpO1xuICBmbG9hdCBzdyA9IHNpbihyb3RhdGlvbi56KTtcblxuICBmbG9hdCBjciA9IGNvcyhyb3RhdGlvbi54KTtcbiAgZmxvYXQgY3AgPSBjb3Mocm90YXRpb24ueSk7XG4gIGZsb2F0IGN3ID0gY29zKHJvdGF0aW9uLnopO1xuXG4gIHJldHVybiBtYXQzKFxuICAgIGN3ICogY3AsICAgICAgICAgICAgICAgICAgLy8gMCwwXG4gICAgc3cgKiBjcCwgICAgICAgICAgICAgICAgICAvLyAxLDBcbiAgICAtc3AsICAgICAgICAgICAgICAgICAgICAgIC8vIDIsMFxuICAgIC1zdyAqIGNyICsgY3cgKiBzcCAqIHNyLCAgLy8gMCwxXG4gICAgY3cgKiBjciArIHN3ICogc3AgKiBzciwgICAvLyAxLDFcbiAgICBjcCAqIHNyLCAgICAgICAgICAgICAgICAgIC8vIDIsMVxuICAgIHN3ICogc3IgKyBjdyAqIHNwICogY3IsICAgLy8gMCwyXG4gICAgLWN3ICogc3IgKyBzdyAqIHNwICogY3IsICAvLyAxLDJcbiAgICBjcCAqIGNyICAgICAgICAgICAgICAgICAgIC8vIDIsMlxuICApO1xufVxuXG52b2lkIG1haW4odm9pZCkge1xuICBtYXQzIHJvdGF0aW9uTWF0cml4ID0gZ2V0Um90YXRpb25NYXRyaXgoaW5zdGFuY2VSb3RhdGlvbnMpO1xuXG4gIHZlYzMgcG9zID0gcG9zaXRpb25zO1xuICBwb3MgPSBwcm9qZWN0X3NjYWxlKHBvcyAqIHNpemVTY2FsZSk7XG4gIHBvcyA9IHJvdGF0aW9uTWF0cml4ICogcG9zO1xuXG4gIHZlYzQgd29ybGRQb3NpdGlvbjtcbiAgZ2xfUG9zaXRpb24gPSBwcm9qZWN0X3Bvc2l0aW9uX3RvX2NsaXBzcGFjZShpbnN0YW5jZVBvc2l0aW9ucywgaW5zdGFuY2VQb3NpdGlvbnM2NHh5LCBwb3MsIHdvcmxkUG9zaXRpb24pO1xuXG4gIC8vIFRPRE8gLSB0cmFuc2Zvcm0gbm9ybWFsc1xuXG4gIHBpY2tpbmdfc2V0UGlja2luZ0NvbG9yKGluc3RhbmNlUGlja2luZ0NvbG9ycyk7XG5cbiAgdlRleENvb3JkID0gdGV4Q29vcmRzO1xuICB2Q29sb3IgPSBpbnN0YW5jZUNvbG9ycztcbiAgdkxpZ2h0V2VpZ2h0ID0gbGlnaHRpbmdfZ2V0TGlnaHRXZWlnaHQod29ybGRQb3NpdGlvbi54eXosIHByb2plY3Rfbm9ybWFsKG5vcm1hbHMpKTtcbn1cbmA7XG4iXX0=