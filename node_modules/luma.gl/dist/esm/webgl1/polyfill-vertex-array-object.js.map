{"version":3,"sources":["../../../src/webgl1/polyfill-vertex-array-object.js"],"names":["OES_vertex_array_object","GL_VERTEX_ARRAY_BINDING","VertexAttrib","gl","enabled","buffer","size","type","FLOAT","normalized","stride","offset","cached","recache","join","WebGLVertexArrayObjectOES","ext","isAlive","hasBeenBound","elementArrayBuffer","attribs","Array","maxVertexAttribs","n","length","attrib","maxAttrib","OESVertexArrayObject","wrapGLError","_polyfillWebGLRenderingContext","arrayObject","vertexArrayObjects","push","splice","indexOf","currentVertexArrayObject","bindVertexArrayOES","synthesizeGLError","INVALID_OPERATION","original","oldVAO","defaultVertexArrayObject","newVAO","bindBuffer","call","ELEMENT_ARRAY_BUFFER","currentBinding","currentArrayBuffer","Math","max","oldAttrib","enableVertexAttribArray","disableVertexAttribArray","bufferChanged","ARRAY_BUFFER","vertexAttribPointer","getParameter","getVertexAttrib","self","Object","assign","pname","VERTEX_ARRAY_BINDING_OES","apply","arguments","index","vao","target","Error","VERTEX_ATTRIB_ARRAY_BUFFER_BINDING","VERTEX_ATTRIB_ARRAY_ENABLED","VERTEX_ATTRIB_ARRAY_SIZE","VERTEX_ATTRIB_ARRAY_STRIDE","VERTEX_ATTRIB_ARRAY_TYPE","VERTEX_ATTRIB_ARRAY_NORMALIZED","indx","instrumentExtension","canvas","addEventListener","console","debug","_reset","contextWasLost","undefined","ii","MAX_VERTEX_ATTRIBS","glErrorShadow","err","optionalMessage","error","originalFunc","getError","NO_ERROR","parseInt","polyfillVertexArrayObject","WebGLRenderingContext","isWebGL2","VERTEX_ARRAY_BINDING","originalMethods","POLYFILL_METHODS","getSupportedExtensions","list","getExtension","name","__OESVertexArrayObject","contextUsesPrototype","Boolean","prototype","polyfillContext"],"mappings":"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","sourcesContent":["/*\n** Copyright (c) 2015 The Khronos Group Inc.\n**\n** Permission is hereby granted, free of charge, to any person obtaining a\n** copy of this software and/or associated documentation files (the\n** 'Materials'), to deal in the Materials without restriction, including\n** without limitation the rights to use, copy, modify, merge, publish,\n** distribute, sublicense, and/or sell copies of the Materials, and to\n** permit persons to whom the Materials are furnished to do so, subject to\n** the following conditions:\n**\n** The above copyright notice and this permission notice shall be included\n** in all copies or substantial portions of the Materials.\n**\n** THE MATERIALS ARE PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,\n** EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n** MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n** IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\n** CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n** TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n** MATERIALS OR THE USE OR OTHER DEALINGS IN THE MATERIALS.\n*/\n\n// This file is a repackaging of the Khronos groups VertexArrayObject polyfill\n\n/* eslint-disable camelcase, no-console */\n/* global console */\n\nconst OES_vertex_array_object = 'OES_vertex_array_object';\nconst GL_VERTEX_ARRAY_BINDING = 0x85B5;\n\n// A helper class\nclass VertexAttrib {\n  constructor(gl) {\n    this.enabled = false;\n    this.buffer = null;\n    this.size = 4;\n    this.type = gl.FLOAT;\n    this.normalized = false;\n    this.stride = 16;\n    this.offset = 0;\n\n    this.cached = '';\n    this.recache();\n  }\n\n  recache() {\n    this.cached = [this.size, this.type, this.normalized, this.stride, this.offset].join(':');\n  }\n}\n\n// The emulated VertexArrayObject instance\nclass WebGLVertexArrayObjectOES {\n  constructor(ext) {\n    const gl = ext.gl;\n\n    this.ext = ext;\n    this.isAlive = true;\n    this.hasBeenBound = false;\n\n    this.elementArrayBuffer = null;\n    this.attribs = new Array(ext.maxVertexAttribs);\n    for (let n = 0; n < this.attribs.length; n++) {\n      const attrib = new VertexAttrib(gl);\n      this.attribs[n] = attrib;\n    }\n\n    this.maxAttrib = 0;\n  }\n}\n\n// The emulated OES_vertex_array_object **weblg extension**\nclass OESVertexArrayObject {\n  constructor(gl) {\n    this.gl = gl;\n\n    wrapGLError(gl);\n\n    this._polyfillWebGLRenderingContext(gl);\n  }\n\n  get VERTEX_ARRAY_BINDING_OES() {\n    return GL_VERTEX_ARRAY_BINDING;\n  }\n\n  createVertexArrayOES() {\n    const arrayObject = new WebGLVertexArrayObjectOES(this);\n    this.vertexArrayObjects.push(arrayObject);\n    return arrayObject;\n  }\n\n  deleteVertexArrayOES(arrayObject) {\n    arrayObject.isAlive = false;\n    this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(arrayObject), 1);\n    if (this.currentVertexArrayObject === arrayObject) {\n      this.bindVertexArrayOES(null);\n    }\n  }\n\n  isVertexArrayOES(arrayObject) {\n    if (arrayObject && arrayObject instanceof WebGLVertexArrayObjectOES) {\n      if (arrayObject.hasBeenBound && arrayObject.ext === this) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /* eslint-disable max-statements, complexity, max-depth */\n  bindVertexArrayOES(arrayObject) {\n    const gl = this.gl;\n    if (arrayObject && !arrayObject.isAlive) {\n      synthesizeGLError(gl.INVALID_OPERATION,\n        'bindVertexArrayOES: attempt to bind deleted arrayObject');\n      return;\n    }\n    const original = this.original;\n\n    const oldVAO = this.currentVertexArrayObject;\n    this.currentVertexArrayObject = arrayObject || this.defaultVertexArrayObject;\n    this.currentVertexArrayObject.hasBeenBound = true;\n    const newVAO = this.currentVertexArrayObject;\n\n    if (oldVAO === newVAO) {\n      return;\n    }\n\n    if (!oldVAO || newVAO.elementArrayBuffer !== oldVAO.elementArrayBuffer) {\n      original.bindBuffer.call(gl, gl.ELEMENT_ARRAY_BUFFER, newVAO.elementArrayBuffer);\n    }\n\n    let currentBinding = this.currentArrayBuffer;\n    const maxAttrib = Math.max(oldVAO ? oldVAO.maxAttrib : 0, newVAO.maxAttrib);\n    for (let n = 0; n <= maxAttrib; n++) {\n      const attrib = newVAO.attribs[n];\n      const oldAttrib = oldVAO ? oldVAO.attribs[n] : null;\n\n      if (!oldVAO || attrib.enabled !== oldAttrib.enabled) {\n        if (attrib.enabled) {\n          original.enableVertexAttribArray.call(gl, n);\n        } else {\n          original.disableVertexAttribArray.call(gl, n);\n        }\n      }\n\n      if (attrib.enabled) {\n        let bufferChanged = false;\n        if (!oldVAO || attrib.buffer !== oldAttrib.buffer) {\n          if (currentBinding !== attrib.buffer) {\n            original.bindBuffer.call(gl, gl.ARRAY_BUFFER, attrib.buffer);\n            currentBinding = attrib.buffer;\n          }\n          bufferChanged = true;\n        }\n\n        if (bufferChanged || attrib.cached !== oldAttrib.cached) {\n          original.vertexAttribPointer.call(\n            gl, n, attrib.size, attrib.type, attrib.normalized, attrib.stride, attrib.offset);\n        }\n      }\n    }\n\n    if (this.currentArrayBuffer !== currentBinding) {\n      original.bindBuffer.call(gl, gl.ARRAY_BUFFER, this.currentArrayBuffer);\n    }\n  }\n  /* eslint-enable max-statements, complexity, max-depth */\n\n  _polyfillWebGLRenderingContext(gl) {\n\n    const original = this.original = {\n      getParameter: gl.getParameter,\n      enableVertexAttribArray: gl.enableVertexAttribArray,\n      disableVertexAttribArray: gl.disableVertexAttribArray,\n      bindBuffer: gl.bindBuffer,\n      getVertexAttrib: gl.getVertexAttrib,\n      vertexAttribPointer: gl.vertexAttribPointer\n    };\n\n    const self = this;\n\n    Object.assign(gl, {\n      getParameter(pname) {\n        if (pname === self.VERTEX_ARRAY_BINDING_OES) {\n          return self.currentVertexArrayObject === self.defaultVertexArrayObject ?\n            null :\n            self.currentVertexArrayObject;\n        }\n        return original.getParameter.apply(this, arguments);\n      },\n\n      enableVertexAttribArray(index) {\n        const vao = self.currentVertexArrayObject;\n        vao.maxAttrib = Math.max(vao.maxAttrib, index);\n        const attrib = vao.attribs[index];\n        attrib.enabled = true;\n        return original.enableVertexAttribArray.apply(this, arguments);\n      },\n\n      disableVertexAttribArray(index) {\n        const vao = self.currentVertexArrayObject;\n        vao.maxAttrib = Math.max(vao.maxAttrib, index);\n        const attrib = vao.attribs[index];\n        attrib.enabled = false;\n        return original.disableVertexAttribArray.apply(this, arguments);\n      },\n\n      bindBuffer(target, buffer) {\n        switch (target) {\n        case gl.ARRAY_BUFFER:\n          self.currentArrayBuffer = buffer;\n          break;\n        case gl.ELEMENT_ARRAY_BUFFER:\n          self.currentVertexArrayObject.elementArrayBuffer = buffer;\n          break;\n        default:\n          throw new Error();\n        }\n        return original.bindBuffer.apply(this, arguments);\n      },\n\n      getVertexAttrib(index, pname) {\n        const vao = self.currentVertexArrayObject;\n        const attrib = vao.attribs[index];\n        switch (pname) {\n        case gl.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:\n          return attrib.buffer;\n        case gl.VERTEX_ATTRIB_ARRAY_ENABLED:\n          return attrib.enabled;\n        case gl.VERTEX_ATTRIB_ARRAY_SIZE:\n          return attrib.size;\n        case gl.VERTEX_ATTRIB_ARRAY_STRIDE:\n          return attrib.stride;\n        case gl.VERTEX_ATTRIB_ARRAY_TYPE:\n          return attrib.type;\n        case gl.VERTEX_ATTRIB_ARRAY_NORMALIZED:\n          return attrib.normalized;\n        default:\n          return original.getVertexAttrib.apply(this, arguments);\n        }\n      },\n\n      /* eslint-disable max-params */\n      vertexAttribPointer(indx, size, type, normalized, stride, offset) {\n      /* eslint-enable max-params */\n        const vao = self.currentVertexArrayObject;\n        vao.maxAttrib = Math.max(vao.maxAttrib, indx);\n        const attrib = vao.attribs[indx];\n        attrib.buffer = self.currentArrayBuffer;\n        attrib.size = size;\n        attrib.type = type;\n        attrib.normalized = normalized;\n        attrib.stride = stride;\n        attrib.offset = offset;\n        attrib.recache();\n        return original.vertexAttribPointer.apply(this, arguments);\n      }\n    });\n\n    if (gl.instrumentExtension) {\n      gl.instrumentExtension(this, OES_vertex_array_object);\n    }\n\n    // Note: gl.canvas is not available in headless gl\n    if (gl.canvas) {\n      gl.canvas.addEventListener('webglcontextrestored', function() {\n        console.debug('OESVertexArrayObject emulation library context restored');\n        self._reset();\n      }, true);\n    }\n\n    this._reset();\n  }\n\n  _reset() {\n    const contextWasLost = this.vertexArrayObjects !== undefined;\n    if (contextWasLost) {\n      for (let ii = 0; ii < this.vertexArrayObjects.length; ++ii) {\n        this.vertexArrayObjects.isAlive = false;\n      }\n    }\n    const gl = this.gl;\n    this.maxVertexAttribs = gl.getParameter(gl.MAX_VERTEX_ATTRIBS);\n\n    this.defaultVertexArrayObject = new WebGLVertexArrayObjectOES(this);\n    this.currentVertexArrayObject = null;\n    this.currentArrayBuffer = null;\n    this.vertexArrayObjects = [this.defaultVertexArrayObject];\n\n    this.bindVertexArrayOES(null);\n  }\n}\n\n// ERROR emulation\n\nconst glErrorShadow = {};\n\nfunction synthesizeGLError(err, optionalMessage) {\n  glErrorShadow[err] = true;\n  if (optionalMessage !== undefined) {\n    console.error(optionalMessage);\n  }\n}\n\nfunction wrapGLError(gl) {\n  const originalFunc = gl.getError;\n  Object.assign(gl, {\n    getError() {\n      let err;\n      do {\n        err = originalFunc.apply(gl);\n        if (err !== gl.NO_ERROR) {\n          glErrorShadow[err] = true;\n        }\n      } while (err !== gl.NO_ERROR);\n\n      for (err in glErrorShadow) {\n        if (glErrorShadow[err]) {\n          delete glErrorShadow[err];\n          return parseInt(err, 10);\n        }\n      }\n      return gl.NO_ERROR;\n    }\n  });\n}\n\n// Install polyfill as extension\nexport default function polyfillVertexArrayObject(WebGLRenderingContext, gl) {\n  // 1) WebGL2 supports VertexArrayObjects by default, so return\n  // 2) If already installed, VERTEX_ARRAY_BINDING is defined\n  const isWebGL2 = WebGLRenderingContext.VERTEX_ARRAY_BINDING === GL_VERTEX_ARRAY_BINDING;\n  if (isWebGL2) {\n    return;\n  }\n\n  const originalMethods = {};\n\n  const POLYFILL_METHODS = {\n    // TODO - not per extension spec\n    VERTEX_ARRAY_BINDING: GL_VERTEX_ARRAY_BINDING,\n\n    getSupportedExtensions() {\n      const list = originalMethods.getSupportedExtensions.call(this) || [];\n      if (list.indexOf(OES_vertex_array_object) < 0) {\n        list.push(OES_vertex_array_object);\n      }\n      return list;\n    },\n\n    getExtension(name) {\n      const ext = originalMethods.getExtension.call(this, name);\n      if (ext) {\n        return ext;\n      }\n      if (name !== OES_vertex_array_object) {\n        return null;\n      }\n\n      if (!this.__OESVertexArrayObject) {\n        // console.debug('Setup OES_vertex_array_object polyfill');\n        this.__OESVertexArrayObject = new OESVertexArrayObject(this);\n      }\n      return this.__OESVertexArrayObject;\n    }\n  };\n\n  // Prefer polyfilling on prototype, however headless gl defines methods on context instance.\n  const contextUsesPrototype = Boolean(WebGLRenderingContext.prototype.getExtension);\n  const polyfillContext = contextUsesPrototype ? WebGLRenderingContext.prototype : gl;\n  Object.assign(originalMethods, {\n    getSupportedExtensions: polyfillContext.getSupportedExtensions,\n    getExtension: polyfillContext.getExtension\n  });\n\n  // Add polyfills, either once on prototype, or on each context if needed\n  if (contextUsesPrototype) {\n    if (WebGLRenderingContext.prototype.getExtension !== POLYFILL_METHODS.getExtension) {\n      Object.assign(WebGLRenderingContext.prototype, POLYFILL_METHODS);\n    }\n  } else {\n    Object.assign(gl, POLYFILL_METHODS);\n  }\n}\n"],"file":"polyfill-vertex-array-object.js"}