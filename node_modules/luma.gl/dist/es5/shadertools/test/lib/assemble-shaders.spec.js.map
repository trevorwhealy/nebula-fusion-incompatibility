{"version":3,"sources":["../../../../../src/shadertools/test/lib/assemble-shaders.spec.js"],"names":["fixture","gl","VS_GLSL_300","FS_GLSL_300","t","ok","assembleShaders","undefined","end","assembleResult","vs","fs","modules","picking","equal","indexOf","testModuleSettings","pickingActive","picking2","Object","assign","getUniforms","sinon","spy","testModule","name","opts","context","picking_uActive","dependencies","is","fp64","called","deepEqual","getCall","args","calledAfter"],"mappings":";;AACA;;AACA;;AACA;;AACA;;;;;;AAEA,IAAMA,UAAU;AACdC,MAAI;AADU,CAAhB;AAIA,IAAMC,2GAAN;AASA,IAAMC,2JAAN;AAYA,wBAAK,wBAAL,EAA+B,aAAK;AAClCC,IAAEC,EAAF,CAAKC,0BAAoBC,SAAzB,EAAoC,mCAApC;AACAH,IAAEI,GAAF;AACD,CAHD;AAKA,wBAAK,mCAAL,EAA0C,aAAK;AAC7C,MAAMC,iBAAiB,2BAAgBT,QAAQC,EAAxB,EAA4B;AACjDS,QAAIR,WAD6C;AAEjDS,QAAIR,WAF6C;AAGjDS,aAAS,CAACC,aAAD;AAHwC,GAA5B,CAAvB,CAD6C,CAM7C;;AACAT,IAAEU,KAAF,CAAQL,eAAeC,EAAf,CAAkBK,OAAlB,CAA0B,iBAA1B,CAAR,EAAsD,CAAtD,EACE,6CADF;AAEAX,IAAEU,KAAF,CAAQL,eAAeE,EAAf,CAAkBI,OAAlB,CAA0B,iBAA1B,CAAR,EAAsD,CAAtD,EACE,6CADF;AAEAX,IAAEI,GAAF;AACD,CAZD;AAcA,wBAAK,6BAAL,EAAoC,aAAK;AAEvC,MAAMQ,qBAAqB;AAACC,mBAAe;AAAhB,GAA3B,CAFuC,CAIvC;;AACA,MAAMC,WAAWC,OAAOC,MAAP,CAAc,qCAAgBP,aAAhB,CAAd,EAAwC;AACvDQ,iBAAaC,eAAMC,GAAN,CAAU,qCAAgBV,aAAhB,EAAyBQ,WAAnC;AAD0C,GAAxC,CAAjB;AAIA,MAAMG,aAAa;AACjBC,UAAM,aADW;AAEjBf,QAAI,EAFa;AAGjBC,QAAI,EAHa;AAIjBU,iBAAaC,eAAMC,GAAN,CAAU,UAACG,IAAD,EAAOC,OAAP,EAAmB;AACxC;AACAvB,QAAEC,EAAF,CAAKsB,QAAQC,eAAb,EAA8B,mDAA9B;AACD,KAHY,CAJI;AAQjBC,kBAAc,CAAC,SAAD;AARG,GAAnB;AAWA,MAAIpB,cAAJ,CApBuC,CAsBvC;;AACAA,mBAAiB,2BAAgBT,QAAQC,EAAxB,EAA4B;AAC3CS,QAAIR,WADuC;AAE3CS,QAAIR;AAFuC,GAA5B,CAAjB,CAvBuC,CA2BvC;;AACAC,IAAE0B,EAAF,SAAYrB,eAAeY,WAA3B,GAAwC,UAAxC,EAAoD,gCAApD,EA5BuC,CA8BvC;;AACAZ,mBAAiB,2BAAgBT,QAAQC,EAAxB,EAA4B;AAC3CS,QAAIR,WADuC;AAE3CS,QAAIR,WAFuC;AAG3CS,aAAS,CAACM,QAAD,EAAWM,UAAX,EAAuBO,UAAvB;AAHkC,GAA5B,CAAjB,CA/BuC,CAqCvC;;AACA3B,IAAE0B,EAAF,SAAYrB,eAAeY,WAA3B,GAAwC,UAAxC,EAAoD,gCAApD;AAEAZ,iBAAeY,WAAf,CAA2BL,kBAA3B;AAEAZ,IAAEC,EAAF,CAAKa,SAASG,WAAT,CAAqBW,MAA1B,EAAkC,8BAAlC;AACA5B,IAAE6B,SAAF,CACEf,SAASG,WAAT,CAAqBa,OAArB,CAA6B,CAA7B,EAAgCC,IAAhC,CAAqC,CAArC,CADF,EAEEnB,kBAFF,EAGE,gDAHF;AAKAZ,IAAEC,EAAF,CAAKmB,WAAWH,WAAX,CAAuBe,WAAvB,CAAmClB,SAASG,WAA5C,CAAL,EACE,qDADF;AAEAjB,IAAE6B,SAAF,CACET,WAAWH,WAAX,CAAuBa,OAAvB,CAA+B,CAA/B,EAAkCC,IAAlC,CAAuC,CAAvC,CADF,EAEEnB,kBAFF,EAGE,gDAHF;AAKAZ,IAAEI,GAAF;AACD,CAxDD","sourcesContent":["/* eslint-disable camelcase */\nimport {createGLContext, assembleShaders, picking, fp64} from 'luma.gl';\nimport {getShaderModule} from 'luma.gl/shadertools/src/lib/resolve-modules';\nimport sinon from 'sinon';\nimport test from 'tape-catch';\n\nconst fixture = {\n  gl: createGLContext()\n};\n\nconst VS_GLSL_300 = `\\\n#version 300 es\n\nin vec4 positions;\n\nvoid main(void) {\n  gl_Position = positions;\n}\n`;\nconst FS_GLSL_300 = `\\\n#version 300 es\n\nprecision highp float;\n\nout vec4 fragmentColor;\n\nvoid main(void) {\n  fragmentColor = vec4(1.0, 1.0, 1.0, 1.0);\n}\n`;\n\ntest('assembleShaders#import', t => {\n  t.ok(assembleShaders !== undefined, 'assembleShaders import successful');\n  t.end();\n});\n\ntest('assembleShaders#version_directive', t => {\n  const assembleResult = assembleShaders(fixture.gl, {\n    vs: VS_GLSL_300,\n    fs: FS_GLSL_300,\n    modules: [picking]\n  });\n  // Verify version directive remains as first line.\n  t.equal(assembleResult.vs.indexOf('#version 300 es'), 0,\n    'version directive should be first statement');\n  t.equal(assembleResult.fs.indexOf('#version 300 es'), 0,\n    'version directive should be first statement');\n  t.end();\n});\n\ntest('assembleShaders#getUniforms', t => {\n\n  const testModuleSettings = {pickingActive: true};\n\n  // inject spy into the picking module's getUniforms\n  const picking2 = Object.assign(getShaderModule(picking), {\n    getUniforms: sinon.spy(getShaderModule(picking).getUniforms)\n  });\n\n  const testModule = {\n    name: 'test-module',\n    vs: '',\n    fs: '',\n    getUniforms: sinon.spy((opts, context) => {\n      // Check a uniform generated by its dependency\n      t.ok(context.picking_uActive, 'module getUniforms is called with correct context');\n    }),\n    dependencies: ['picking']\n  };\n\n  let assembleResult;\n\n  // Without shader modules\n  assembleResult = assembleShaders(fixture.gl, {\n    vs: VS_GLSL_300,\n    fs: FS_GLSL_300\n  });\n  // Verify getUniforms is function\n  t.is(typeof assembleResult.getUniforms, 'function', 'getUniforms should be function');\n\n  // With shader modules\n  assembleResult = assembleShaders(fixture.gl, {\n    vs: VS_GLSL_300,\n    fs: FS_GLSL_300,\n    modules: [picking2, testModule, fp64]\n  });\n\n  // Verify getUniforms is function\n  t.is(typeof assembleResult.getUniforms, 'function', 'getUniforms should be function');\n\n  assembleResult.getUniforms(testModuleSettings);\n\n  t.ok(picking2.getUniforms.called, 'module getUniforms is called');\n  t.deepEqual(\n    picking2.getUniforms.getCall(0).args[0],\n    testModuleSettings,\n    'module getUniforms is called with correct opts');\n\n  t.ok(testModule.getUniforms.calledAfter(picking2.getUniforms),\n    'module getUniforms is called after its dependencies');\n  t.deepEqual(\n    testModule.getUniforms.getCall(0).args[0],\n    testModuleSettings,\n    'module getUniforms is called with correct opts');\n\n  t.end();\n});\n"],"file":"assemble-shaders.spec.js"}