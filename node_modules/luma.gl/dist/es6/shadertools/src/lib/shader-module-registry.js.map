{"version":3,"sources":["../../../../../src/shadertools/src/lib/shader-module-registry.js"],"names":["ShaderModule","assert","ShaderModuleRegistry","constructor","shaderModules","defaultShaderModules","setDefaultShaderModules","modules","resolveModules","registerShaderModules","shaderModuleList","ignoreMultipleRegistrations","shaderModule","_registerShaderModule","getShaderModule","moduleOrName","module","map","name","dependencies","Error"],"mappings":"AAAA,OAAOA,YAAP,MAAyB,iBAAzB;AACA,OAAOC,MAAP,MAAmB,iBAAnB;AAEA,eAAe,MAAMC,oBAAN,CAA2B;AACxCC,gBAAc;AACZ,SAAKC,aAAL,GAAqB,EAArB;AACA,SAAKC,oBAAL,GAA4B,EAA5B;AACD;;AAEDC,0BAAwBC,OAAxB,EAAiC;AAC/B,SAAKF,oBAAL,GAA4B,KAAKG,cAAL,CAAoBD,OAApB,CAA5B;AACD;;AAEDE,wBAAsBC,gBAAtB,EAAwC;AAACC,kCAA8B;AAA/B,MAAwC,EAAhF,EAAoF;AAClF,SAAK,MAAMC,YAAX,IAA2BF,gBAA3B,EAA6C;AAC3C,WAAKG,qBAAL,CAA2BD,YAA3B,EAAyCD,2BAAzC;AACD;AACF;;AAEDG,kBAAgBC,YAAhB,EAA8B;AAC5B;AACA,QAAIA,wBAAwBf,YAA5B,EAA0C;AACxC,aAAOe,YAAP;AACD,KAJ2B,CAM5B;;;AACA,QAAI,OAAOA,YAAP,KAAwB,QAA5B,EAAsC;AACpC,aAAO,KAAKF,qBAAL,CAA2BE,YAA3B,EAAyC,IAAzC,CAAP;AACD,KAT2B,CAW5B;;;AACA,UAAMC,SAAS,KAAKZ,aAAL,CAAmBW,YAAnB,CAAf;;AACA,QAAI,CAACC,MAAL,EAAa;AACX;AACAf,aAAO,KAAP,EAAe,yBAAwBc,YAAa,EAApD;AACD;;AACD,WAAOC,MAAP;AACD,GAlCuC,CAoCxC;AACA;;;AACAR,iBAAeD,OAAf,EAAwB;AACtB,WAAOA,QAAQU,GAAR,CAAYF,gBAAgB,KAAKD,eAAL,CAAqBC,YAArB,CAA5B,CAAP;AACD,GAxCuC,CA0CxC;;;AAEAF,wBAAsBG,MAAtB,EAA8BL,8BAA8B,KAA5D,EAAmE;AACjE;AACA,QAAIK,kBAAkBhB,YAAtB,EAAoC;AAClC,aAAOgB,MAAP;AACD;;AAEDf,WAAOe,OAAOE,IAAd,EAAoB,2BAApB;;AAEA,QAAI,CAAC,KAAKd,aAAL,CAAmBY,OAAOE,IAA1B,CAAL,EAAsC;AACpCF,eAAS,IAAIhB,YAAJ,CAAiBgB,MAAjB,CAAT;AACAA,aAAOG,YAAP,GAAsB,KAAKX,cAAL,CAAoBQ,OAAOG,YAA3B,CAAtB;AACA,WAAKf,aAAL,CAAmBY,OAAOE,IAA1B,IAAkCF,MAAlC;AACD,KAJD,MAIO,IAAI,CAACL,2BAAL,EAAkC;AACvC;AACA,YAAM,IAAIS,KAAJ,CAAW,iBAAgBJ,OAAOE,IAAK,qBAAvC,CAAN;AACD;;AAED,WAAO,KAAKd,aAAL,CAAmBY,OAAOE,IAA1B,CAAP;AACD;;AA9DuC","sourcesContent":["import ShaderModule from './shader-module';\nimport assert from '../utils/assert';\n\nexport default class ShaderModuleRegistry {\n  constructor() {\n    this.shaderModules = {};\n    this.defaultShaderModules = [];\n  }\n\n  setDefaultShaderModules(modules) {\n    this.defaultShaderModules = this.resolveModules(modules);\n  }\n\n  registerShaderModules(shaderModuleList, {ignoreMultipleRegistrations = false} = {}) {\n    for (const shaderModule of shaderModuleList) {\n      this._registerShaderModule(shaderModule, ignoreMultipleRegistrations);\n    }\n  }\n\n  getShaderModule(moduleOrName) {\n    // Check if \"inline\" module, return it\n    if (moduleOrName instanceof ShaderModule) {\n      return moduleOrName;\n    }\n\n    // Check if module descriptor\n    if (typeof moduleOrName !== 'string') {\n      return this._registerShaderModule(moduleOrName, true);\n    }\n\n    // Module name - Look up module\n    const module = this.shaderModules[moduleOrName];\n    if (!module) {\n      // console.log(`${moduleOrName} not in registered modules:`, modules);\n      assert(false, `Unknown shader module ${moduleOrName}`);\n    }\n    return module;\n  }\n\n  // registers any supplied modules, resolves any names into modules\n  // returns a list of modules\n  resolveModules(modules) {\n    return modules.map(moduleOrName => this.getShaderModule(moduleOrName));\n  }\n\n  // PRIVATE API\n\n  _registerShaderModule(module, ignoreMultipleRegistrations = false) {\n    // Check if \"inline\" module, return it\n    if (module instanceof ShaderModule) {\n      return module;\n    }\n\n    assert(module.name, 'shader module has no name');\n\n    if (!this.shaderModules[module.name]) {\n      module = new ShaderModule(module);\n      module.dependencies = this.resolveModules(module.dependencies);\n      this.shaderModules[module.name] = module;\n    } else if (!ignoreMultipleRegistrations) {\n      // TODO - instead verify that definition is not changing...\n      throw new Error(`shader module ${module.name} already registered`);\n    }\n\n    return this.shaderModules[module.name];\n  }\n}\n"],"file":"shader-module-registry.js"}