{"version":3,"sources":["../../../src/webgl/uniforms.js"],"names":["Framebuffer","Renderbuffer","Texture","Sampler","formatValue","log","assert","GL","UNIFORM_SETTERS","FLOAT","gl","location","value","uniform1fv","toFloatArray","FLOAT_VEC2","uniform2fv","FLOAT_VEC3","uniform3fv","FLOAT_VEC4","uniform4fv","INT","uniform1iv","toIntArray","INT_VEC2","uniform2iv","INT_VEC3","uniform3iv","INT_VEC4","uniform4iv","BOOL","BOOL_VEC2","BOOL_VEC3","BOOL_VEC4","FLOAT_MAT2","uniformMatrix2fv","FLOAT_MAT3","uniformMatrix3fv","FLOAT_MAT4","uniformMatrix4fv","SAMPLER_2D","uniform1i","SAMPLER_CUBE","UNSIGNED_INT","uniform1uiv","toUIntArray","UNSIGNED_INT_VEC2","uniform2uiv","UNSIGNED_INT_VEC3","uniform3uiv","UNSIGNED_INT_VEC4","uniform4uiv","FLOAT_MAT2x3","uniformMatrix2x3fv","FLOAT_MAT2x4","uniformMatrix2x4fv","FLOAT_MAT3x2","uniformMatrix3x2fv","FLOAT_MAT3x4","uniformMatrix3x4fv","FLOAT_MAT4x2","uniformMatrix4x2fv","FLOAT_MAT4x3","uniformMatrix4x3fv","SAMPLER_3D","SAMPLER_2D_SHADOW","SAMPLER_2D_ARRAY","SAMPLER_2D_ARRAY_SHADOW","SAMPLER_CUBE_SHADOW","INT_SAMPLER_2D","INT_SAMPLER_3D","INT_SAMPLER_CUBE","INT_SAMPLER_2D_ARRAY","UNSIGNED_INT_SAMPLER_2D","UNSIGNED_INT_SAMPLER_3D","UNSIGNED_INT_SAMPLER_CUBE","UNSIGNED_INT_SAMPLER_2D_ARRAY","FLOAT_ARRAY","INT_ARRAY","UINT_ARRAY","array1","toTypedArray","uniformLength","Type","cache","Number","isFinite","length","warn","result","i","Float32Array","Int32Array","Uint32Array","parseUniformName","name","UNIFORM_NAME_REGEXP","matches","match","Error","isArray","Boolean","getUniformSetter","info","setter","type","bind","checkUniformValues","uniforms","source","uniformName","checkUniformValue","console","error","Array","ArrayBuffer","isView","checkUniformArray","texture","checkLength","Math","min","areUniformsEqual","uniform1","uniform2","len","getUniformsTable","header","program","undefinedOnly","SHADER_MODULE_UNIFORM_REGEXP","PROJECT_MODULE_UNIFORM_REGEXP","uniformLocations","_uniformSetters","table","uniformNames","Object","keys","sort","count","addUniformToTable","unusedCount","unusedTable","uniform","isDefined","isUniformDefined","undefined"],"mappings":"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","sourcesContent":["import Framebuffer from './framebuffer';\nimport Renderbuffer from './renderbuffer';\nimport Texture from './texture';\nimport Sampler from './sampler';\nimport {formatValue, log} from '../utils';\nimport assert from '../utils/assert';\nimport GL from '../constants';\n\nconst UNIFORM_SETTERS = {\n\n  // WEBGL1\n\n  /* eslint-disable max-len */\n  [GL.FLOAT]: (gl, location, value) => gl.uniform1fv(location, toFloatArray(value, 1)),\n  [GL.FLOAT_VEC2]: (gl, location, value) => gl.uniform2fv(location, toFloatArray(value, 2)),\n  [GL.FLOAT_VEC3]: (gl, location, value) => gl.uniform3fv(location, toFloatArray(value, 3)),\n  [GL.FLOAT_VEC4]: (gl, location, value) => gl.uniform4fv(location, toFloatArray(value, 4)),\n\n  [GL.INT]: (gl, location, value) => gl.uniform1iv(location, toIntArray(value, 1)),\n  [GL.INT_VEC2]: (gl, location, value) => gl.uniform2iv(location, toIntArray(value, 2)),\n  [GL.INT_VEC3]: (gl, location, value) => gl.uniform3iv(location, toIntArray(value, 3)),\n  [GL.INT_VEC4]: (gl, location, value) => gl.uniform4iv(location, toIntArray(value, 4)),\n\n  [GL.BOOL]: (gl, location, value) => gl.uniform1iv(location, toIntArray(value, 1)),\n\n  [GL.BOOL_VEC2]: (gl, location, value) => gl.uniform2iv(location, toIntArray(value, 2)),\n  [GL.BOOL_VEC3]: (gl, location, value) => gl.uniform3iv(location, toIntArray(value, 3)),\n  [GL.BOOL_VEC4]: (gl, location, value) => gl.uniform4iv(location, toIntArray(value, 4)),\n\n  // uniformMatrix(false): don't transpose the matrix\n  [GL.FLOAT_MAT2]: (gl, location, value) => gl.uniformMatrix2fv(location, false, toFloatArray(value, 4)),\n  [GL.FLOAT_MAT3]: (gl, location, value) => gl.uniformMatrix3fv(location, false, toFloatArray(value, 9)),\n  [GL.FLOAT_MAT4]: (gl, location, value) => gl.uniformMatrix4fv(location, false, toFloatArray(value, 16)),\n\n  [GL.SAMPLER_2D]: (gl, location, value) => gl.uniform1i(location, value),\n  [GL.SAMPLER_CUBE]: (gl, location, value) => gl.uniform1i(location, value),\n\n  // WEBGL2 - unsigned integers, irregular matrices, additional texture samplers\n\n  [GL.UNSIGNED_INT]: (gl, location, value) => gl.uniform1uiv(location, toUIntArray(value, 1)),\n  [GL.UNSIGNED_INT_VEC2]: (gl, location, value) => gl.uniform2uiv(location, toUIntArray(value, 2)),\n  [GL.UNSIGNED_INT_VEC3]: (gl, location, value) => gl.uniform3uiv(location, toUIntArray(value, 3)),\n  [GL.UNSIGNED_INT_VEC4]: (gl, location, value) => gl.uniform4uiv(location, toUIntArray(value, 4)),\n\n  // uniformMatrix(false): don't transpose the matrix\n  [GL.FLOAT_MAT2x3]: (gl, location, value) => gl.uniformMatrix2x3fv(location, false, toFloatArray(value, 6)),\n  [GL.FLOAT_MAT2x4]: (gl, location, value) => gl.uniformMatrix2x4fv(location, false, toFloatArray(value, 8)),\n  [GL.FLOAT_MAT3x2]: (gl, location, value) => gl.uniformMatrix3x2fv(location, false, toFloatArray(value, 6)),\n  [GL.FLOAT_MAT3x4]: (gl, location, value) => gl.uniformMatrix3x4fv(location, false, toFloatArray(value, 12)),\n  [GL.FLOAT_MAT4x2]: (gl, location, value) => gl.uniformMatrix4x2fv(location, false, toFloatArray(value, 8)),\n  [GL.FLOAT_MAT4x3]: (gl, location, value) => gl.uniformMatrix4x3fv(location, false, toFloatArray(value, 12)),\n\n  [GL.SAMPLER_3D]: (gl, location, value) => gl.uniform1i(location, value),\n  [GL.SAMPLER_2D_SHADOW]: (gl, location, value) => gl.uniform1i(location, value),\n  [GL.SAMPLER_2D_ARRAY]: (gl, location, value) => gl.uniform1i(location, value),\n  [GL.SAMPLER_2D_ARRAY_SHADOW]: (gl, location, value) => gl.uniform1i(location, value),\n  [GL.SAMPLER_CUBE_SHADOW]: (gl, location, value) => gl.uniform1i(location, value),\n  [GL.INT_SAMPLER_2D]: (gl, location, value) => gl.uniform1i(location, value),\n  [GL.INT_SAMPLER_3D]: (gl, location, value) => gl.uniform1i(location, value),\n  [GL.INT_SAMPLER_CUBE]: (gl, location, value) => gl.uniform1i(location, value),\n  [GL.INT_SAMPLER_2D_ARRAY]: (gl, location, value) => gl.uniform1i(location, value),\n  [GL.UNSIGNED_INT_SAMPLER_2D]: (gl, location, value) => gl.uniform1i(location, value),\n  [GL.UNSIGNED_INT_SAMPLER_3D]: (gl, location, value) => gl.uniform1i(location, value),\n  [GL.UNSIGNED_INT_SAMPLER_CUBE]: (gl, location, value) => gl.uniform1i(location, value),\n  [GL.UNSIGNED_INT_SAMPLER_2D_ARRAY]: (gl, location, value) => gl.uniform1i(location, value)\n  /* eslint-enable max-len */\n};\n\n// Pre-allocated typed arrays for temporary conversion\nconst FLOAT_ARRAY = {};\nconst INT_ARRAY = {};\nconst UINT_ARRAY = {};\n\nconst array1 = [0];\n\n// Functions to ensure the type of uniform values\n// TODO - Why is this necessary? The uniform*v funtions can consume Arrays\nfunction toTypedArray(value, uniformLength, Type, cache) {\n  // convert boolean uniforms to Number\n  if (uniformLength === 1 && typeof value === 'boolean') {\n    value = value ? 1 : 0;\n  }\n  if (Number.isFinite(value)) {\n    array1[0] = value;\n    value = array1;\n  }\n  const length = value.length;\n  if (length % uniformLength) {\n    log.warn(`Uniform size should be multiples of ${uniformLength}`, value)();\n  }\n\n  if (value instanceof Type) {\n    return value;\n  }\n  let result = cache[length];\n  if (!result) {\n    result = new Type(length);\n    cache[length] = result;\n  }\n  for (let i = 0; i < length; i++) {\n    result[i] = value[i];\n  }\n  return result;\n}\n\nfunction toFloatArray(value, uniformLength) {\n  return toTypedArray(value, uniformLength, Float32Array, FLOAT_ARRAY);\n}\n\nfunction toIntArray(value, uniformLength) {\n  return toTypedArray(value, uniformLength, Int32Array, INT_ARRAY);\n}\n\nfunction toUIntArray(value, uniformLength) {\n  return toTypedArray(value, uniformLength, Uint32Array, UINT_ARRAY);\n}\n\nexport function parseUniformName(name) {\n  // name = name[name.length - 1] === ']' ?\n  // name.substr(0, name.length - 3) : name;\n\n  // if array name then clean the array brackets\n  const UNIFORM_NAME_REGEXP = /([^\\[]*)(\\[[0-9]+\\])?/;\n  const matches = name.match(UNIFORM_NAME_REGEXP);\n  if (!matches || matches.length < 2) {\n    throw new Error(`Failed to parse GLSL uniform name ${name}`);\n  }\n\n  return {\n    name: matches[1],\n    length: matches[2] || 1,\n    isArray: Boolean(matches[2])\n  };\n}\n\n// Returns a Magic Uniform Setter\n/* eslint-disable complexity */\nexport function getUniformSetter(gl, location, info) {\n  const setter = UNIFORM_SETTERS[info.type];\n  if (!setter) {\n    throw new Error(`Unknown GLSL uniform type ${info.type}`);\n  }\n  return setter.bind(null, gl, location);\n}\n\n// Basic checks of uniform values without knowledge of program\n// To facilitate early detection of e.g. undefined values in JavaScript\nexport function checkUniformValues(uniforms, source) {\n  for (const uniformName in uniforms) {\n    const value = uniforms[uniformName];\n    if (!checkUniformValue(value)) {\n      // Add space to source\n      source = source ? `${source} ` : '';\n      // Value could be unprintable so write the object on console\n      console.error(`${source} Bad uniform ${uniformName}`, value); // eslint-disable-line\n      /* eslint-enable no-console */\n      throw new Error(`${source} Bad uniform ${uniformName}`);\n    }\n  }\n  return true;\n}\n\n// TODO use type information during validation\nfunction checkUniformValue(value) {\n  if (Array.isArray(value) || ArrayBuffer.isView(value)) {\n    return checkUniformArray(value);\n  }\n\n  // Check if single value is a number\n  if (isFinite(value)) {\n    return true;\n  } else if (value === true || value === false) {\n    return true;\n  } else if (value instanceof Texture || value instanceof Sampler) {\n    return true;\n  } else if (value instanceof Renderbuffer) {\n    return true;\n  } else if (value instanceof Framebuffer) {\n    return Boolean(value.texture);\n  }\n  return false;\n}\n\nfunction checkUniformArray(value) {\n  // Check that every element in array is a number, and at least 1 element\n  if (value.length === 0) {\n    return false;\n  }\n\n  const checkLength = Math.min(value.length, 16);\n\n  for (let i = 0; i < checkLength; ++i) {\n    if (!Number.isFinite(value[i])) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\n/**\n * Given two values of a uniform, returns `true` if they are equal\n */\nexport function areUniformsEqual(uniform1, uniform2) {\n  if (Array.isArray(uniform1) || ArrayBuffer.isView(uniform1)) {\n    if (!uniform2) {\n      return false;\n    }\n    const len = uniform1.length;\n    if (uniform2.length !== len) {\n      return false;\n    }\n    for (let i = 0; i < len; i++) {\n      if (uniform1[i] !== uniform2[i]) {\n        return false;\n      }\n    }\n    return true;\n  }\n  return uniform1 === uniform2;\n}\n\n// Prepares a table suitable for console.table\n/* eslint-disable max-statements */\nexport function getUniformsTable({\n  header = 'Uniforms',\n  program,\n  uniforms,\n  undefinedOnly = false\n} = {}) {\n  assert(program);\n\n  const SHADER_MODULE_UNIFORM_REGEXP = '.*_.*';\n  const PROJECT_MODULE_UNIFORM_REGEXP = '.*Matrix'; // TODO - Use explicit list\n\n  const uniformLocations = program._uniformSetters;\n  const table = {}; // {[header]: {}};\n\n  // Add program's provided uniforms (in alphabetical order)\n  const uniformNames = Object.keys(uniformLocations).sort();\n\n  let count = 0;\n\n  // First add non-underscored uniforms (assumed not coming from shader modules)\n  for (const uniformName of uniformNames) {\n    if (!uniformName.match(SHADER_MODULE_UNIFORM_REGEXP) &&\n      !uniformName.match(PROJECT_MODULE_UNIFORM_REGEXP)) {\n      if (addUniformToTable({table, header, uniforms, uniformName, undefinedOnly})) {\n        count++;\n      }\n    }\n  }\n\n  // add underscored uniforms (assumed from shader modules)\n  for (const uniformName of uniformNames) {\n    if (uniformName.match(PROJECT_MODULE_UNIFORM_REGEXP)) {\n      if (addUniformToTable({table, header, uniforms, uniformName, undefinedOnly})) {\n        count++;\n      }\n    }\n  }\n\n  for (const uniformName of uniformNames) {\n    if (!table[uniformName]) {\n      if (addUniformToTable({table, header, uniforms, uniformName, undefinedOnly})) {\n        count++;\n      }\n    }\n  }\n\n  // Create a table of unused uniforms\n  let unusedCount = 0;\n  const unusedTable = {};\n  if (!undefinedOnly) {\n    for (const uniformName in uniforms) {\n      const uniform = uniforms[uniformName];\n      if (!table[uniformName]) {\n        unusedCount++;\n        unusedTable[uniformName] = {\n          Type: `NOT USED: ${uniform}`,\n          [header]: formatValue(uniform)\n        };\n      }\n    }\n  }\n\n  return {table, count, unusedTable, unusedCount};\n}\n\n// Helper\nfunction addUniformToTable({table, header, uniforms, uniformName, undefinedOnly}) {\n  const value = uniforms[uniformName];\n  const isDefined = isUniformDefined(value);\n  if (!undefinedOnly || !isDefined) {\n    table[uniformName] = {\n      // Add program's unprovided uniforms\n      [header]: isDefined ? formatValue(value) : 'N/A',\n      'Uniform Type': isDefined ? value : 'NOT PROVIDED'\n    };\n    return true;\n  }\n  return false;\n}\n\nfunction isUniformDefined(value) {\n  return value !== undefined && value !== null;\n}\n"],"file":"uniforms.js"}