{"version":3,"sources":["../../../src/webgl1/polyfill-vertex-array-object.js"],"names":["OES_vertex_array_object","GL_VERTEX_ARRAY_BINDING","VertexAttrib","constructor","gl","enabled","buffer","size","type","FLOAT","normalized","stride","offset","cached","recache","join","WebGLVertexArrayObjectOES","ext","isAlive","hasBeenBound","elementArrayBuffer","attribs","Array","maxVertexAttribs","n","length","attrib","maxAttrib","OESVertexArrayObject","wrapGLError","_polyfillWebGLRenderingContext","VERTEX_ARRAY_BINDING_OES","createVertexArrayOES","arrayObject","vertexArrayObjects","push","deleteVertexArrayOES","splice","indexOf","currentVertexArrayObject","bindVertexArrayOES","isVertexArrayOES","synthesizeGLError","INVALID_OPERATION","original","oldVAO","defaultVertexArrayObject","newVAO","bindBuffer","call","ELEMENT_ARRAY_BUFFER","currentBinding","currentArrayBuffer","Math","max","oldAttrib","enableVertexAttribArray","disableVertexAttribArray","bufferChanged","ARRAY_BUFFER","vertexAttribPointer","getParameter","getVertexAttrib","self","Object","assign","pname","apply","arguments","index","vao","target","Error","VERTEX_ATTRIB_ARRAY_BUFFER_BINDING","VERTEX_ATTRIB_ARRAY_ENABLED","VERTEX_ATTRIB_ARRAY_SIZE","VERTEX_ATTRIB_ARRAY_STRIDE","VERTEX_ATTRIB_ARRAY_TYPE","VERTEX_ATTRIB_ARRAY_NORMALIZED","indx","instrumentExtension","canvas","addEventListener","console","debug","_reset","contextWasLost","undefined","ii","MAX_VERTEX_ATTRIBS","glErrorShadow","err","optionalMessage","error","originalFunc","getError","NO_ERROR","parseInt","polyfillVertexArrayObject","WebGLRenderingContext","isWebGL2","VERTEX_ARRAY_BINDING","originalMethods","POLYFILL_METHODS","getSupportedExtensions","list","getExtension","name","__OESVertexArrayObject","contextUsesPrototype","Boolean","prototype","polyfillContext"],"mappings":"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","sourcesContent":["/*\n** Copyright (c) 2015 The Khronos Group Inc.\n**\n** Permission is hereby granted, free of charge, to any person obtaining a\n** copy of this software and/or associated documentation files (the\n** 'Materials'), to deal in the Materials without restriction, including\n** without limitation the rights to use, copy, modify, merge, publish,\n** distribute, sublicense, and/or sell copies of the Materials, and to\n** permit persons to whom the Materials are furnished to do so, subject to\n** the following conditions:\n**\n** The above copyright notice and this permission notice shall be included\n** in all copies or substantial portions of the Materials.\n**\n** THE MATERIALS ARE PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,\n** EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n** MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n** IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\n** CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n** TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n** MATERIALS OR THE USE OR OTHER DEALINGS IN THE MATERIALS.\n*/\n\n// This file is a repackaging of the Khronos groups VertexArrayObject polyfill\n\n/* eslint-disable camelcase, no-console */\n/* global console */\n\nconst OES_vertex_array_object = 'OES_vertex_array_object';\nconst GL_VERTEX_ARRAY_BINDING = 0x85B5;\n\n// A helper class\nclass VertexAttrib {\n  constructor(gl) {\n    this.enabled = false;\n    this.buffer = null;\n    this.size = 4;\n    this.type = gl.FLOAT;\n    this.normalized = false;\n    this.stride = 16;\n    this.offset = 0;\n\n    this.cached = '';\n    this.recache();\n  }\n\n  recache() {\n    this.cached = [this.size, this.type, this.normalized, this.stride, this.offset].join(':');\n  }\n}\n\n// The emulated VertexArrayObject instance\nclass WebGLVertexArrayObjectOES {\n  constructor(ext) {\n    const gl = ext.gl;\n\n    this.ext = ext;\n    this.isAlive = true;\n    this.hasBeenBound = false;\n\n    this.elementArrayBuffer = null;\n    this.attribs = new Array(ext.maxVertexAttribs);\n    for (let n = 0; n < this.attribs.length; n++) {\n      const attrib = new VertexAttrib(gl);\n      this.attribs[n] = attrib;\n    }\n\n    this.maxAttrib = 0;\n  }\n}\n\n// The emulated OES_vertex_array_object **weblg extension**\nclass OESVertexArrayObject {\n  constructor(gl) {\n    this.gl = gl;\n\n    wrapGLError(gl);\n\n    this._polyfillWebGLRenderingContext(gl);\n  }\n\n  get VERTEX_ARRAY_BINDING_OES() {\n    return GL_VERTEX_ARRAY_BINDING;\n  }\n\n  createVertexArrayOES() {\n    const arrayObject = new WebGLVertexArrayObjectOES(this);\n    this.vertexArrayObjects.push(arrayObject);\n    return arrayObject;\n  }\n\n  deleteVertexArrayOES(arrayObject) {\n    arrayObject.isAlive = false;\n    this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(arrayObject), 1);\n    if (this.currentVertexArrayObject === arrayObject) {\n      this.bindVertexArrayOES(null);\n    }\n  }\n\n  isVertexArrayOES(arrayObject) {\n    if (arrayObject && arrayObject instanceof WebGLVertexArrayObjectOES) {\n      if (arrayObject.hasBeenBound && arrayObject.ext === this) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /* eslint-disable max-statements, complexity, max-depth */\n  bindVertexArrayOES(arrayObject) {\n    const gl = this.gl;\n    if (arrayObject && !arrayObject.isAlive) {\n      synthesizeGLError(gl.INVALID_OPERATION,\n        'bindVertexArrayOES: attempt to bind deleted arrayObject');\n      return;\n    }\n    const original = this.original;\n\n    const oldVAO = this.currentVertexArrayObject;\n    this.currentVertexArrayObject = arrayObject || this.defaultVertexArrayObject;\n    this.currentVertexArrayObject.hasBeenBound = true;\n    const newVAO = this.currentVertexArrayObject;\n\n    if (oldVAO === newVAO) {\n      return;\n    }\n\n    if (!oldVAO || newVAO.elementArrayBuffer !== oldVAO.elementArrayBuffer) {\n      original.bindBuffer.call(gl, gl.ELEMENT_ARRAY_BUFFER, newVAO.elementArrayBuffer);\n    }\n\n    let currentBinding = this.currentArrayBuffer;\n    const maxAttrib = Math.max(oldVAO ? oldVAO.maxAttrib : 0, newVAO.maxAttrib);\n    for (let n = 0; n <= maxAttrib; n++) {\n      const attrib = newVAO.attribs[n];\n      const oldAttrib = oldVAO ? oldVAO.attribs[n] : null;\n\n      if (!oldVAO || attrib.enabled !== oldAttrib.enabled) {\n        if (attrib.enabled) {\n          original.enableVertexAttribArray.call(gl, n);\n        } else {\n          original.disableVertexAttribArray.call(gl, n);\n        }\n      }\n\n      if (attrib.enabled) {\n        let bufferChanged = false;\n        if (!oldVAO || attrib.buffer !== oldAttrib.buffer) {\n          if (currentBinding !== attrib.buffer) {\n            original.bindBuffer.call(gl, gl.ARRAY_BUFFER, attrib.buffer);\n            currentBinding = attrib.buffer;\n          }\n          bufferChanged = true;\n        }\n\n        if (bufferChanged || attrib.cached !== oldAttrib.cached) {\n          original.vertexAttribPointer.call(\n            gl, n, attrib.size, attrib.type, attrib.normalized, attrib.stride, attrib.offset);\n        }\n      }\n    }\n\n    if (this.currentArrayBuffer !== currentBinding) {\n      original.bindBuffer.call(gl, gl.ARRAY_BUFFER, this.currentArrayBuffer);\n    }\n  }\n  /* eslint-enable max-statements, complexity, max-depth */\n\n  _polyfillWebGLRenderingContext(gl) {\n\n    const original = this.original = {\n      getParameter: gl.getParameter,\n      enableVertexAttribArray: gl.enableVertexAttribArray,\n      disableVertexAttribArray: gl.disableVertexAttribArray,\n      bindBuffer: gl.bindBuffer,\n      getVertexAttrib: gl.getVertexAttrib,\n      vertexAttribPointer: gl.vertexAttribPointer\n    };\n\n    const self = this;\n\n    Object.assign(gl, {\n      getParameter(pname) {\n        if (pname === self.VERTEX_ARRAY_BINDING_OES) {\n          return self.currentVertexArrayObject === self.defaultVertexArrayObject ?\n            null :\n            self.currentVertexArrayObject;\n        }\n        return original.getParameter.apply(this, arguments);\n      },\n\n      enableVertexAttribArray(index) {\n        const vao = self.currentVertexArrayObject;\n        vao.maxAttrib = Math.max(vao.maxAttrib, index);\n        const attrib = vao.attribs[index];\n        attrib.enabled = true;\n        return original.enableVertexAttribArray.apply(this, arguments);\n      },\n\n      disableVertexAttribArray(index) {\n        const vao = self.currentVertexArrayObject;\n        vao.maxAttrib = Math.max(vao.maxAttrib, index);\n        const attrib = vao.attribs[index];\n        attrib.enabled = false;\n        return original.disableVertexAttribArray.apply(this, arguments);\n      },\n\n      bindBuffer(target, buffer) {\n        switch (target) {\n        case gl.ARRAY_BUFFER:\n          self.currentArrayBuffer = buffer;\n          break;\n        case gl.ELEMENT_ARRAY_BUFFER:\n          self.currentVertexArrayObject.elementArrayBuffer = buffer;\n          break;\n        default:\n          throw new Error();\n        }\n        return original.bindBuffer.apply(this, arguments);\n      },\n\n      getVertexAttrib(index, pname) {\n        const vao = self.currentVertexArrayObject;\n        const attrib = vao.attribs[index];\n        switch (pname) {\n        case gl.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:\n          return attrib.buffer;\n        case gl.VERTEX_ATTRIB_ARRAY_ENABLED:\n          return attrib.enabled;\n        case gl.VERTEX_ATTRIB_ARRAY_SIZE:\n          return attrib.size;\n        case gl.VERTEX_ATTRIB_ARRAY_STRIDE:\n          return attrib.stride;\n        case gl.VERTEX_ATTRIB_ARRAY_TYPE:\n          return attrib.type;\n        case gl.VERTEX_ATTRIB_ARRAY_NORMALIZED:\n          return attrib.normalized;\n        default:\n          return original.getVertexAttrib.apply(this, arguments);\n        }\n      },\n\n      /* eslint-disable max-params */\n      vertexAttribPointer(indx, size, type, normalized, stride, offset) {\n      /* eslint-enable max-params */\n        const vao = self.currentVertexArrayObject;\n        vao.maxAttrib = Math.max(vao.maxAttrib, indx);\n        const attrib = vao.attribs[indx];\n        attrib.buffer = self.currentArrayBuffer;\n        attrib.size = size;\n        attrib.type = type;\n        attrib.normalized = normalized;\n        attrib.stride = stride;\n        attrib.offset = offset;\n        attrib.recache();\n        return original.vertexAttribPointer.apply(this, arguments);\n      }\n    });\n\n    if (gl.instrumentExtension) {\n      gl.instrumentExtension(this, OES_vertex_array_object);\n    }\n\n    // Note: gl.canvas is not available in headless gl\n    if (gl.canvas) {\n      gl.canvas.addEventListener('webglcontextrestored', function() {\n        console.debug('OESVertexArrayObject emulation library context restored');\n        self._reset();\n      }, true);\n    }\n\n    this._reset();\n  }\n\n  _reset() {\n    const contextWasLost = this.vertexArrayObjects !== undefined;\n    if (contextWasLost) {\n      for (let ii = 0; ii < this.vertexArrayObjects.length; ++ii) {\n        this.vertexArrayObjects.isAlive = false;\n      }\n    }\n    const gl = this.gl;\n    this.maxVertexAttribs = gl.getParameter(gl.MAX_VERTEX_ATTRIBS);\n\n    this.defaultVertexArrayObject = new WebGLVertexArrayObjectOES(this);\n    this.currentVertexArrayObject = null;\n    this.currentArrayBuffer = null;\n    this.vertexArrayObjects = [this.defaultVertexArrayObject];\n\n    this.bindVertexArrayOES(null);\n  }\n}\n\n// ERROR emulation\n\nconst glErrorShadow = {};\n\nfunction synthesizeGLError(err, optionalMessage) {\n  glErrorShadow[err] = true;\n  if (optionalMessage !== undefined) {\n    console.error(optionalMessage);\n  }\n}\n\nfunction wrapGLError(gl) {\n  const originalFunc = gl.getError;\n  Object.assign(gl, {\n    getError() {\n      let err;\n      do {\n        err = originalFunc.apply(gl);\n        if (err !== gl.NO_ERROR) {\n          glErrorShadow[err] = true;\n        }\n      } while (err !== gl.NO_ERROR);\n\n      for (err in glErrorShadow) {\n        if (glErrorShadow[err]) {\n          delete glErrorShadow[err];\n          return parseInt(err, 10);\n        }\n      }\n      return gl.NO_ERROR;\n    }\n  });\n}\n\n// Install polyfill as extension\nexport default function polyfillVertexArrayObject(WebGLRenderingContext, gl) {\n  // 1) WebGL2 supports VertexArrayObjects by default, so return\n  // 2) If already installed, VERTEX_ARRAY_BINDING is defined\n  const isWebGL2 = WebGLRenderingContext.VERTEX_ARRAY_BINDING === GL_VERTEX_ARRAY_BINDING;\n  if (isWebGL2) {\n    return;\n  }\n\n  const originalMethods = {};\n\n  const POLYFILL_METHODS = {\n    // TODO - not per extension spec\n    VERTEX_ARRAY_BINDING: GL_VERTEX_ARRAY_BINDING,\n\n    getSupportedExtensions() {\n      const list = originalMethods.getSupportedExtensions.call(this) || [];\n      if (list.indexOf(OES_vertex_array_object) < 0) {\n        list.push(OES_vertex_array_object);\n      }\n      return list;\n    },\n\n    getExtension(name) {\n      const ext = originalMethods.getExtension.call(this, name);\n      if (ext) {\n        return ext;\n      }\n      if (name !== OES_vertex_array_object) {\n        return null;\n      }\n\n      if (!this.__OESVertexArrayObject) {\n        // console.debug('Setup OES_vertex_array_object polyfill');\n        this.__OESVertexArrayObject = new OESVertexArrayObject(this);\n      }\n      return this.__OESVertexArrayObject;\n    }\n  };\n\n  // Prefer polyfilling on prototype, however headless gl defines methods on context instance.\n  const contextUsesPrototype = Boolean(WebGLRenderingContext.prototype.getExtension);\n  const polyfillContext = contextUsesPrototype ? WebGLRenderingContext.prototype : gl;\n  Object.assign(originalMethods, {\n    getSupportedExtensions: polyfillContext.getSupportedExtensions,\n    getExtension: polyfillContext.getExtension\n  });\n\n  // Add polyfills, either once on prototype, or on each context if needed\n  if (contextUsesPrototype) {\n    if (WebGLRenderingContext.prototype.getExtension !== POLYFILL_METHODS.getExtension) {\n      Object.assign(WebGLRenderingContext.prototype, POLYFILL_METHODS);\n    }\n  } else {\n    Object.assign(gl, POLYFILL_METHODS);\n  }\n}\n"],"file":"polyfill-vertex-array-object.js"}