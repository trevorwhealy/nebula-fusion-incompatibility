{"version":3,"file":"index.es.js","sources":["../src/async/constants.js","../src/async/prepared.js","../src/async/dispatched.js","../src/async/utils/isReactCompositeComponent.js","../src/async/prepare.js","../src/async/split.js","../src/async/traverse-exclude.js","../src/async/prepare-provider.js","../src/async/middleware.js","../src/async/index.js","../src/server.js","../src/client.js","../src/provider.js","../src/plugin.js","../src/hoc.js","../src/index.js"],"sourcesContent":["/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nexport const REACT_PREPARE = '@__REACT_PREPARE__@';\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport React, {Component} from 'react';\n\nimport {REACT_PREPARE} from './constants';\n\n// $FlowFixMe\nconst prepared = (sideEffect, opts = {}) => OriginalComponent => {\n  opts = Object.assign(\n    {\n      boundary: false,\n      defer: false,\n      componentDidMount: true,\n      componentWillReceiveProps: false,\n      componentDidUpdate: false,\n      contextTypes: {},\n      forceUpdate: false,\n    },\n    opts\n  );\n  const prep = {\n    prepare: (...args) => Promise.resolve(sideEffect(...args)),\n    defer: opts.defer,\n  };\n  // Disable eslint for deprecated componentWillReceiveProps\n  // eslint-disable-next-line react/no-deprecated\n  class PreparedComponent extends Component<*, *> {\n    // $FlowFixMe\n    constructor(props, context) {\n      super(props, context);\n      // $FlowFixMe\n      this[REACT_PREPARE] = prep;\n    }\n    componentDidMount() {\n      if (opts.componentDidMount) {\n        Promise.resolve(sideEffect(this.props, this.context)).then(() => {\n          if (opts.forceUpdate) {\n            this.forceUpdate();\n          }\n        });\n      }\n    }\n\n    // $FlowFixMe\n    UNSAFE_componentWillReceiveProps(nextProps, nextContext) {\n      if (opts.componentWillReceiveProps) {\n        sideEffect(nextProps, nextContext);\n      }\n    }\n\n    componentDidUpdate() {\n      if (opts.componentDidUpdate) {\n        sideEffect(this.props, this.context);\n      }\n    }\n\n    render() {\n      return <OriginalComponent {...this.props} />;\n    }\n  }\n\n  const displayName =\n    OriginalComponent.displayName || OriginalComponent.name || '';\n  PreparedComponent.contextTypes = opts.contextTypes;\n  PreparedComponent.displayName = `PreparedComponent(${displayName})`;\n\n  return PreparedComponent;\n};\n\n// $FlowFixMe\nfunction isPrepared(CustomComponent) {\n  return (\n    CustomComponent[REACT_PREPARE] &&\n    typeof CustomComponent[REACT_PREPARE].prepare === 'function'\n  );\n}\n\n// $FlowFixMe\nfunction getPrepare(CustomComponent) {\n  return CustomComponent[REACT_PREPARE] || {};\n}\n\nexport {isPrepared, getPrepare};\nexport default prepared;\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport PropTypes from 'prop-types';\n\nimport prepared from './prepared';\n\nconst storeShape = PropTypes.shape({\n  dispatch: PropTypes.func.isRequired,\n});\n\n// $FlowFixMe\nconst dispatched = (prepareUsingDispatch, opts = {}) => OriginalComponent => {\n  const prepare = (props, context) => {\n    return prepareUsingDispatch(props, context.store.dispatch);\n  };\n  const contextTypes = Object.assign(\n    {},\n    opts && opts.contextTypes ? opts.contextTypes : {},\n    {store: storeShape}\n  );\n  const preparedOpts = Object.assign({}, opts, {contextTypes});\n  return prepared(prepare, preparedOpts)(OriginalComponent);\n};\n\nexport default dispatched;\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nexport default function isReactCompositeComponent(type: mixed) {\n  if (typeof type !== 'function') {\n    return false;\n  }\n  if (typeof type.prototype !== 'object') {\n    return false;\n  }\n  if (typeof type.prototype.render !== 'function') {\n    return false;\n  }\n  return true;\n}\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport React from 'react';\nimport {\n  isFragment,\n  isContextConsumer,\n  isContextProvider,\n  isForwardRef,\n} from 'react-is';\n\nimport isReactCompositeComponent from './utils/isReactCompositeComponent';\nimport {isPrepared, getPrepare} from './prepared';\n\nfunction renderCompositeElementInstance(instance) {\n  const childContext = Object.assign(\n    {},\n    instance.context,\n    instance.getChildContext ? instance.getChildContext() : {}\n  );\n  if (instance.componentWillMount) {\n    instance.componentWillMount();\n  } else if (instance.UNSAFE_componentWillMount) {\n    instance.UNSAFE_componentWillMount();\n  }\n  const children = instance.render();\n  return [children, childContext];\n}\n\nfunction prepareComponentInstance(instance) {\n  if (!isPrepared(instance)) {\n    return Promise.resolve({});\n  }\n  const prepareConfig = getPrepare(instance);\n  // If the component is deferred, skip the prepare step\n  if (prepareConfig.defer) {\n    return Promise.resolve(prepareConfig);\n  }\n  // $FlowFixMe\n  return prepareConfig.prepare(instance.props, instance.context).then(() => {\n    return prepareConfig;\n  });\n}\n\nfunction prepareElement(element, context) {\n  if (element === null || typeof element !== 'object') {\n    return Promise.resolve([null, context]);\n  }\n  const {type, props} = element;\n  if (isContextConsumer(element)) {\n    return Promise.resolve([props.children(type._currentValue), context]);\n  }\n  if (isContextProvider(element)) {\n    type._context._currentValue = props.value;\n    return Promise.resolve([props.children, context]);\n  }\n  if (\n    typeof type === 'string' ||\n    isFragment(element) ||\n    isForwardRef(element)\n  ) {\n    return Promise.resolve([props.children, context]);\n  }\n  if (!isReactCompositeComponent(type)) {\n    return Promise.resolve([type(props, context), context]);\n  }\n  const CompositeComponent = type;\n  const instance = new CompositeComponent(props, context);\n  instance.props = props;\n  instance.context = context;\n  if (instance.componentWillUnmount && __BROWSER__) {\n    context.__UNMOUNTS__.push(() => instance.componentWillUnmount());\n  }\n  return prepareComponentInstance(instance).then(prepareConfig => {\n    // Stop traversing if the component is defer or boundary\n    if (prepareConfig.defer || prepareConfig.boundary) {\n      return Promise.resolve([null, context]);\n    }\n    return renderCompositeElementInstance(instance);\n  });\n}\n\nfunction _prepare(element, context) {\n  return prepareElement(element, context).then(([children, childContext]) => {\n    return Promise.all(\n      React.Children.toArray(children).map(child =>\n        _prepare(child, childContext)\n      )\n    );\n  });\n}\n\nfunction prepare(element: any, context: any = {}) {\n  context.__IS_PREPARE__ = true;\n  context.__UNMOUNTS__ = [];\n  return _prepare(element, context).then(() => {\n    context.__IS_PREPARE__ = false;\n    context.__UNMOUNTS__.forEach(fn => {\n      return fn();\n    });\n  });\n}\n\nexport default prepare;\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport prepared from './prepared.js';\n\nconst CHUNKS_KEY = '__CHUNK_IDS';\n\nconst contextTypes = {\n  splitComponentLoaders: PropTypes.array.isRequired,\n};\n\nif (__NODE__) {\n  // $FlowFixMe\n  contextTypes.preloadChunks = PropTypes.array.isRequired;\n}\n\n// $FlowFixMe\nexport default function withAsyncComponent({\n  defer,\n  load,\n  LoadingComponent,\n  ErrorComponent,\n}) {\n  let AsyncComponent = null;\n  let error = null;\n  let chunkIds = [];\n\n  function WithAsyncComponent(props) {\n    if (error) {\n      return <ErrorComponent error={error} />;\n    }\n    if (!AsyncComponent) {\n      return <LoadingComponent />;\n    }\n    return <AsyncComponent {...props} />;\n  }\n  return prepared(\n    (props, context) => {\n      if (AsyncComponent) {\n        if (__NODE__) {\n          chunkIds.forEach(chunkId => {\n            context.preloadChunks.push(chunkId);\n          });\n        }\n        return Promise.resolve(AsyncComponent);\n      }\n\n      let componentPromise;\n      try {\n        componentPromise = load();\n      } catch (e) {\n        componentPromise = Promise.reject(e);\n      }\n      // $FlowFixMe\n      chunkIds = componentPromise[CHUNKS_KEY] || [];\n\n      if (__NODE__) {\n        chunkIds.forEach(chunkId => {\n          context.preloadChunks.push(chunkId);\n        });\n      }\n\n      const loadPromises = [\n        componentPromise,\n        ...context.splitComponentLoaders.map(loader => loader(chunkIds)),\n      ];\n\n      return Promise.all(loadPromises)\n        .then(([asyncComponent]) => {\n          // Note: .default is toolchain specific, breaks w/ CommonJS exports\n          AsyncComponent = asyncComponent.default;\n        })\n        .catch(err => {\n          error = err;\n          if (__BROWSER__)\n            setTimeout(() => {\n              throw err;\n            }); // log error\n        });\n    },\n    {defer, contextTypes, forceUpdate: true}\n  )(WithAsyncComponent);\n}\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport prepared from './prepared.js';\n\n// Stops the traversal at this node. Useful for optimizing the prepare traversal\n// to visit the minimum number of nodes\nexport default prepared(Promise.resolve(), {\n  componentDidMount: false,\n  componentWillReceiveProps: false,\n  componentDidUpdate: false,\n  defer: true,\n});\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\n\nclass PrepareProvider extends React.Component<*, *> {\n  constructor(props: any, context: any) {\n    super(props, context);\n    this.splitComponentLoaders = [];\n    this.preloadChunks = props.preloadChunks;\n  }\n\n  preloadChunks: any;\n  splitComponentLoaders: Array<any>;\n\n  getChildContext() {\n    return {\n      splitComponentLoaders: this.splitComponentLoaders,\n      preloadChunks: this.preloadChunks,\n    };\n  }\n  render() {\n    return React.Children.only(this.props.children);\n  }\n}\n\nPrepareProvider.childContextTypes = {\n  splitComponentLoaders: PropTypes.array.isRequired,\n  preloadChunks: PropTypes.array.isRequired,\n};\n\nexport default PrepareProvider;\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport React from 'react';\n\nimport type {Middleware} from 'fusion-core';\n\nimport PrepareProvider from './prepare-provider';\n\nconst middleware: Middleware = function(ctx, next) {\n  if (__NODE__ && !ctx.element) {\n    return next();\n  }\n  ctx.element = (\n    <PrepareProvider preloadChunks={ctx.preloadChunks}>\n      {ctx.element}\n    </PrepareProvider>\n  );\n  return next();\n};\n\nexport default middleware;\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\n\nimport dispatched from './dispatched';\nimport prepare from './prepare';\nimport prepared from './prepared';\nimport split from './split';\nimport exclude from './traverse-exclude';\nimport middleware from './middleware'; //typed\n\nconst prepareTyped: (\n  element: React.Element<any>\n  // $FlowFixMe\n) => Promise<React.ComponentType<any>> = prepare;\n\nconst preparedTyped: (\n  sideEffect: (props: Object, context: Object) => Promise<any>,\n  opts?: {\n    defer?: boolean,\n    boundary?: boolean,\n    componentDidMount?: boolean,\n    componentWillReceiveProps?: boolean,\n    componentDidUpdate?: boolean,\n    forceUpdate?: boolean,\n    contextTypes?: Object,\n  }\n) => (\n  Component: React.ComponentType<any>\n) => React.ComponentType<any> = prepared;\n\nconst splitTyped: (opts: {\n  load: () => Promise<any>,\n  LoadingComponent: React.ComponentType<any>,\n  ErrorComponent: React.ComponentType<any>,\n}) => React.ComponentType<any> = split;\n\nconst excludeTyped: (\n  Component: React.ComponentType<any>\n) => React.ComponentType<any> = exclude;\n\nexport {\n  dispatched,\n  prepareTyped as prepare,\n  preparedTyped as prepared,\n  splitTyped as split,\n  excludeTyped as exclude,\n  middleware,\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env node */\nimport * as React from 'react';\nimport {renderToString} from 'react-dom/server';\n\nexport default (el: React.Element<*>) =>\n  `<div id='root'>${renderToString(el)}</div>`;\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env browser */\nimport * as React from 'react';\nimport ReactDOM from 'react-dom';\n\nexport default (el: React.Element<*>) => {\n  const domElement = document.getElementById('root');\n\n  if (!domElement) {\n    throw new Error(\"Could not find 'root' element\");\n  }\n\n  return ReactDOM.hydrate\n    ? ReactDOM.hydrate(el, domElement)\n    : ReactDOM.render(el, domElement);\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\nimport PropTypes from 'prop-types';\n\nexport default {\n  create: (name: string) => {\n    class Provider extends React.Component<*> {\n      getChildContext() {\n        return {[name]: this.props.provides};\n      }\n      render() {\n        return React.Children.only(this.props.children);\n      }\n    }\n    Provider.childContextTypes = {\n      ...(Provider.childContextTypes || {}),\n      [name]: PropTypes.any.isRequired,\n    };\n    Provider.displayName =\n      name.replace(/^./, c => c.toUpperCase()) + 'Provider';\n\n    return Provider;\n  },\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\n\nimport {createPlugin} from 'fusion-core';\nimport type {FusionPlugin, Middleware} from 'fusion-core';\n\nimport Provider from './provider';\n\n// eslint-disable-next-line\ntype FusionPluginNoHidden<TDeps, TService> = $Diff<\n  FusionPlugin<TDeps, TService>,\n  {__plugin__: boolean}\n>;\n\nexport default {\n  create: <TDeps: *, TService: *>(\n    name: string,\n    // eslint-disable-next-line\n    plugin: FusionPluginNoHidden<TDeps, TService> | FusionPlugin<TDeps, TService>,\n    provider?: React.ComponentType<*>\n  ): FusionPlugin<TDeps, TService> => {\n    if (plugin.__plugin__ === undefined) {\n      plugin = createPlugin(plugin);\n    }\n    if (!plugin.__plugin__) {\n      throw new Error(\n        'Provided plugin does not match FusionPlugin<TDeps, TService>'\n      );\n    }\n\n    let originalMiddleware = plugin.middleware;\n    const ProviderComponent = provider || Provider.create(name);\n    plugin.middleware = (deps: *, provides: *) => {\n      let nextMiddleware =\n        originalMiddleware && originalMiddleware(deps, provides);\n      const mw: Middleware = function(ctx, next) {\n        if (ctx.element) {\n          ctx.element = React.createElement(\n            ProviderComponent,\n            {provides, ctx},\n            ctx.element\n          );\n        }\n        if (nextMiddleware) {\n          return nextMiddleware(ctx, next);\n        }\n        return next();\n      };\n      return mw;\n    };\n    return plugin;\n  },\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\n\nimport PropTypes from 'prop-types';\n\ntype ReactHOC = (React.ComponentType<*>) => React.ComponentType<*>;\nexport default {\n  create: (name: string, mapProvidesToProps?: Object => Object): ReactHOC => {\n    const mapProvides = mapProvidesToProps\n      ? mapProvidesToProps\n      : provides => ({[name]: provides});\n    return (Component: React.ComponentType<*>) => {\n      class HOC extends React.Component<*> {\n        provides: any;\n\n        constructor(props: *, ctx: *) {\n          super(props, ctx);\n          this.provides = ctx[name];\n        }\n        render() {\n          const props = {...this.props, ...mapProvides(this.provides)};\n          return React.createElement(Component, props);\n        }\n      }\n      const displayName = Component.displayName || Component.name;\n      HOC.displayName =\n        'With' +\n        name.replace(/^./, c => c.toUpperCase()) +\n        '(' +\n        displayName +\n        ')';\n      HOC.contextTypes = {\n        [name]: PropTypes.any.isRequired,\n      };\n      return HOC;\n    };\n  },\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env browser */\nimport * as React from 'react';\n\nimport FusionApp, {createPlugin} from 'fusion-core';\nimport {prepare, middleware} from './async/index.js';\n\nimport serverRender from './server';\nimport clientRender from './client';\n\nimport ProviderPlugin from './plugin';\nimport ProvidedHOC from './hoc';\nimport Provider from './provider';\n\ndeclare var __NODE__: Boolean;\n\nexport default class App extends FusionApp {\n  constructor(root: React.Element<*>, render: ?(React.Element<*>) => any) {\n    const renderer = createPlugin({\n      provides() {\n        return (el: React.Element<*>) => {\n          return prepare(el).then(() => {\n            if (render) {\n              return render(el);\n            }\n            return __NODE__ ? serverRender(el) : clientRender(el);\n          });\n        };\n      },\n      middleware() {\n        return middleware;\n      },\n    });\n    super(root, renderer);\n  }\n}\n\nexport {ProviderPlugin, ProvidedHOC, Provider};\n\nexport * from './async/index.js';\n"],"names":["REACT_PREPARE","prepared","sideEffect","opts","OriginalComponent","Object","assign","boundary","defer","componentDidMount","componentWillReceiveProps","componentDidUpdate","contextTypes","forceUpdate","prep","prepare","args","Promise","resolve","PreparedComponent","Component","constructor","props","context","then","UNSAFE_componentWillReceiveProps","nextProps","nextContext","render","React","displayName","name","isPrepared","CustomComponent","getPrepare","storeShape","PropTypes","shape","dispatch","func","isRequired","dispatched","prepareUsingDispatch","store","preparedOpts","isReactCompositeComponent","type","prototype","renderCompositeElementInstance","instance","childContext","getChildContext","componentWillMount","UNSAFE_componentWillMount","children","prepareComponentInstance","prepareConfig","prepareElement","element","isContextConsumer","_currentValue","isContextProvider","_context","value","isFragment","isForwardRef","CompositeComponent","componentWillUnmount","__UNMOUNTS__","push","_prepare","all","Children","toArray","map","child","__IS_PREPARE__","forEach","fn","CHUNKS_KEY","splitComponentLoaders","array","preloadChunks","withAsyncComponent","load","LoadingComponent","ErrorComponent","AsyncComponent","error","chunkIds","WithAsyncComponent","chunkId","componentPromise","e","reject","loadPromises","loader","asyncComponent","default","catch","err","PrepareProvider","only","childContextTypes","middleware","ctx","next","prepareTyped","preparedTyped","splitTyped","split","excludeTyped","exclude","el","renderToString","create","Provider","provides","any","replace","c","toUpperCase","plugin","provider","__plugin__","undefined","createPlugin","Error","originalMiddleware","ProviderComponent","deps","nextMiddleware","mw","mapProvidesToProps","mapProvides","HOC","App","FusionApp","root","renderer","serverRender"],"mappings":"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"}