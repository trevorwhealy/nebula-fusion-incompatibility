{"version":3,"file":"browser.es5.es.js","sources":["../src/async/constants.js","../src/async/prepared.js","../src/async/dispatched.js","../src/async/utils/isReactCompositeComponent.js","../src/async/prepare.js","../src/async/split.js","../src/async/traverse-exclude.js","../src/async/prepare-provider.js","../src/async/middleware.js","../src/async/index.js","../src/server.js","../src/client.js","../src/provider.js","../src/plugin.js","../src/hoc.js","../src/index.js"],"sourcesContent":["/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nexport const REACT_PREPARE = '@__REACT_PREPARE__@';\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport React, {Component} from 'react';\n\nimport {REACT_PREPARE} from './constants';\n\n// $FlowFixMe\nconst prepared = (sideEffect, opts = {}) => OriginalComponent => {\n  opts = Object.assign(\n    {\n      boundary: false,\n      defer: false,\n      componentDidMount: true,\n      componentWillReceiveProps: false,\n      componentDidUpdate: false,\n      contextTypes: {},\n      forceUpdate: false,\n    },\n    opts\n  );\n  const prep = {\n    prepare: (...args) => Promise.resolve(sideEffect(...args)),\n    defer: opts.defer,\n  };\n  // Disable eslint for deprecated componentWillReceiveProps\n  // eslint-disable-next-line react/no-deprecated\n  class PreparedComponent extends Component<*, *> {\n    // $FlowFixMe\n    constructor(props, context) {\n      super(props, context);\n      // $FlowFixMe\n      this[REACT_PREPARE] = prep;\n    }\n    componentDidMount() {\n      if (opts.componentDidMount) {\n        Promise.resolve(sideEffect(this.props, this.context)).then(() => {\n          if (opts.forceUpdate) {\n            this.forceUpdate();\n          }\n        });\n      }\n    }\n\n    // $FlowFixMe\n    UNSAFE_componentWillReceiveProps(nextProps, nextContext) {\n      if (opts.componentWillReceiveProps) {\n        sideEffect(nextProps, nextContext);\n      }\n    }\n\n    componentDidUpdate() {\n      if (opts.componentDidUpdate) {\n        sideEffect(this.props, this.context);\n      }\n    }\n\n    render() {\n      return <OriginalComponent {...this.props} />;\n    }\n  }\n\n  const displayName =\n    OriginalComponent.displayName || OriginalComponent.name || '';\n  PreparedComponent.contextTypes = opts.contextTypes;\n  PreparedComponent.displayName = `PreparedComponent(${displayName})`;\n\n  return PreparedComponent;\n};\n\n// $FlowFixMe\nfunction isPrepared(CustomComponent) {\n  return (\n    CustomComponent[REACT_PREPARE] &&\n    typeof CustomComponent[REACT_PREPARE].prepare === 'function'\n  );\n}\n\n// $FlowFixMe\nfunction getPrepare(CustomComponent) {\n  return CustomComponent[REACT_PREPARE] || {};\n}\n\nexport {isPrepared, getPrepare};\nexport default prepared;\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport PropTypes from 'prop-types';\n\nimport prepared from './prepared';\n\nconst storeShape = PropTypes.shape({\n  dispatch: PropTypes.func.isRequired,\n});\n\n// $FlowFixMe\nconst dispatched = (prepareUsingDispatch, opts = {}) => OriginalComponent => {\n  const prepare = (props, context) => {\n    return prepareUsingDispatch(props, context.store.dispatch);\n  };\n  const contextTypes = Object.assign(\n    {},\n    opts && opts.contextTypes ? opts.contextTypes : {},\n    {store: storeShape}\n  );\n  const preparedOpts = Object.assign({}, opts, {contextTypes});\n  return prepared(prepare, preparedOpts)(OriginalComponent);\n};\n\nexport default dispatched;\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nexport default function isReactCompositeComponent(type: mixed) {\n  if (typeof type !== 'function') {\n    return false;\n  }\n  if (typeof type.prototype !== 'object') {\n    return false;\n  }\n  if (typeof type.prototype.render !== 'function') {\n    return false;\n  }\n  return true;\n}\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport React from 'react';\nimport {\n  isFragment,\n  isContextConsumer,\n  isContextProvider,\n  isForwardRef,\n} from 'react-is';\n\nimport isReactCompositeComponent from './utils/isReactCompositeComponent';\nimport {isPrepared, getPrepare} from './prepared';\n\nfunction renderCompositeElementInstance(instance) {\n  const childContext = Object.assign(\n    {},\n    instance.context,\n    instance.getChildContext ? instance.getChildContext() : {}\n  );\n  if (instance.componentWillMount) {\n    instance.componentWillMount();\n  } else if (instance.UNSAFE_componentWillMount) {\n    instance.UNSAFE_componentWillMount();\n  }\n  const children = instance.render();\n  return [children, childContext];\n}\n\nfunction prepareComponentInstance(instance) {\n  if (!isPrepared(instance)) {\n    return Promise.resolve({});\n  }\n  const prepareConfig = getPrepare(instance);\n  // If the component is deferred, skip the prepare step\n  if (prepareConfig.defer) {\n    return Promise.resolve(prepareConfig);\n  }\n  // $FlowFixMe\n  return prepareConfig.prepare(instance.props, instance.context).then(() => {\n    return prepareConfig;\n  });\n}\n\nfunction prepareElement(element, context) {\n  if (element === null || typeof element !== 'object') {\n    return Promise.resolve([null, context]);\n  }\n  const {type, props} = element;\n  if (isContextConsumer(element)) {\n    return Promise.resolve([props.children(type._currentValue), context]);\n  }\n  if (isContextProvider(element)) {\n    type._context._currentValue = props.value;\n    return Promise.resolve([props.children, context]);\n  }\n  if (\n    typeof type === 'string' ||\n    isFragment(element) ||\n    isForwardRef(element)\n  ) {\n    return Promise.resolve([props.children, context]);\n  }\n  if (!isReactCompositeComponent(type)) {\n    return Promise.resolve([type(props, context), context]);\n  }\n  const CompositeComponent = type;\n  const instance = new CompositeComponent(props, context);\n  instance.props = props;\n  instance.context = context;\n  if (instance.componentWillUnmount && __BROWSER__) {\n    context.__UNMOUNTS__.push(() => instance.componentWillUnmount());\n  }\n  return prepareComponentInstance(instance).then(prepareConfig => {\n    // Stop traversing if the component is defer or boundary\n    if (prepareConfig.defer || prepareConfig.boundary) {\n      return Promise.resolve([null, context]);\n    }\n    return renderCompositeElementInstance(instance);\n  });\n}\n\nfunction _prepare(element, context) {\n  return prepareElement(element, context).then(([children, childContext]) => {\n    return Promise.all(\n      React.Children.toArray(children).map(child =>\n        _prepare(child, childContext)\n      )\n    );\n  });\n}\n\nfunction prepare(element: any, context: any = {}) {\n  context.__IS_PREPARE__ = true;\n  context.__UNMOUNTS__ = [];\n  return _prepare(element, context).then(() => {\n    context.__IS_PREPARE__ = false;\n    context.__UNMOUNTS__.forEach(fn => {\n      return fn();\n    });\n  });\n}\n\nexport default prepare;\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport prepared from './prepared.js';\n\nconst CHUNKS_KEY = '__CHUNK_IDS';\n\nconst contextTypes = {\n  splitComponentLoaders: PropTypes.array.isRequired,\n};\n\nif (__NODE__) {\n  // $FlowFixMe\n  contextTypes.preloadChunks = PropTypes.array.isRequired;\n}\n\n// $FlowFixMe\nexport default function withAsyncComponent({\n  defer,\n  load,\n  LoadingComponent,\n  ErrorComponent,\n}) {\n  let AsyncComponent = null;\n  let error = null;\n  let chunkIds = [];\n\n  function WithAsyncComponent(props) {\n    if (error) {\n      return <ErrorComponent error={error} />;\n    }\n    if (!AsyncComponent) {\n      return <LoadingComponent />;\n    }\n    return <AsyncComponent {...props} />;\n  }\n  return prepared(\n    (props, context) => {\n      if (AsyncComponent) {\n        if (__NODE__) {\n          chunkIds.forEach(chunkId => {\n            context.preloadChunks.push(chunkId);\n          });\n        }\n        return Promise.resolve(AsyncComponent);\n      }\n\n      let componentPromise;\n      try {\n        componentPromise = load();\n      } catch (e) {\n        componentPromise = Promise.reject(e);\n      }\n      // $FlowFixMe\n      chunkIds = componentPromise[CHUNKS_KEY] || [];\n\n      if (__NODE__) {\n        chunkIds.forEach(chunkId => {\n          context.preloadChunks.push(chunkId);\n        });\n      }\n\n      const loadPromises = [\n        componentPromise,\n        ...context.splitComponentLoaders.map(loader => loader(chunkIds)),\n      ];\n\n      return Promise.all(loadPromises)\n        .then(([asyncComponent]) => {\n          // Note: .default is toolchain specific, breaks w/ CommonJS exports\n          AsyncComponent = asyncComponent.default;\n        })\n        .catch(err => {\n          error = err;\n          if (__BROWSER__)\n            setTimeout(() => {\n              throw err;\n            }); // log error\n        });\n    },\n    {defer, contextTypes, forceUpdate: true}\n  )(WithAsyncComponent);\n}\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport prepared from './prepared.js';\n\n// Stops the traversal at this node. Useful for optimizing the prepare traversal\n// to visit the minimum number of nodes\nexport default prepared(Promise.resolve(), {\n  componentDidMount: false,\n  componentWillReceiveProps: false,\n  componentDidUpdate: false,\n  defer: true,\n});\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\n\nclass PrepareProvider extends React.Component<*, *> {\n  constructor(props: any, context: any) {\n    super(props, context);\n    this.splitComponentLoaders = [];\n    this.preloadChunks = props.preloadChunks;\n  }\n\n  preloadChunks: any;\n  splitComponentLoaders: Array<any>;\n\n  getChildContext() {\n    return {\n      splitComponentLoaders: this.splitComponentLoaders,\n      preloadChunks: this.preloadChunks,\n    };\n  }\n  render() {\n    return React.Children.only(this.props.children);\n  }\n}\n\nPrepareProvider.childContextTypes = {\n  splitComponentLoaders: PropTypes.array.isRequired,\n  preloadChunks: PropTypes.array.isRequired,\n};\n\nexport default PrepareProvider;\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport React from 'react';\n\nimport type {Middleware} from 'fusion-core';\n\nimport PrepareProvider from './prepare-provider';\n\nconst middleware: Middleware = function(ctx, next) {\n  if (__NODE__ && !ctx.element) {\n    return next();\n  }\n  ctx.element = (\n    <PrepareProvider preloadChunks={ctx.preloadChunks}>\n      {ctx.element}\n    </PrepareProvider>\n  );\n  return next();\n};\n\nexport default middleware;\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\n\nimport dispatched from './dispatched';\nimport prepare from './prepare';\nimport prepared from './prepared';\nimport split from './split';\nimport exclude from './traverse-exclude';\nimport middleware from './middleware'; //typed\n\nconst prepareTyped: (\n  element: React.Element<any>\n  // $FlowFixMe\n) => Promise<React.ComponentType<any>> = prepare;\n\nconst preparedTyped: (\n  sideEffect: (props: Object, context: Object) => Promise<any>,\n  opts?: {\n    defer?: boolean,\n    boundary?: boolean,\n    componentDidMount?: boolean,\n    componentWillReceiveProps?: boolean,\n    componentDidUpdate?: boolean,\n    forceUpdate?: boolean,\n    contextTypes?: Object,\n  }\n) => (\n  Component: React.ComponentType<any>\n) => React.ComponentType<any> = prepared;\n\nconst splitTyped: (opts: {\n  load: () => Promise<any>,\n  LoadingComponent: React.ComponentType<any>,\n  ErrorComponent: React.ComponentType<any>,\n}) => React.ComponentType<any> = split;\n\nconst excludeTyped: (\n  Component: React.ComponentType<any>\n) => React.ComponentType<any> = exclude;\n\nexport {\n  dispatched,\n  prepareTyped as prepare,\n  preparedTyped as prepared,\n  splitTyped as split,\n  excludeTyped as exclude,\n  middleware,\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env node */\nimport * as React from 'react';\nimport {renderToString} from 'react-dom/server';\n\nexport default (el: React.Element<*>) =>\n  `<div id='root'>${renderToString(el)}</div>`;\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env browser */\nimport * as React from 'react';\nimport ReactDOM from 'react-dom';\n\nexport default (el: React.Element<*>) => {\n  const domElement = document.getElementById('root');\n\n  if (!domElement) {\n    throw new Error(\"Could not find 'root' element\");\n  }\n\n  return ReactDOM.hydrate\n    ? ReactDOM.hydrate(el, domElement)\n    : ReactDOM.render(el, domElement);\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\nimport PropTypes from 'prop-types';\n\nexport default {\n  create: (name: string) => {\n    class Provider extends React.Component<*> {\n      getChildContext() {\n        return {[name]: this.props.provides};\n      }\n      render() {\n        return React.Children.only(this.props.children);\n      }\n    }\n    Provider.childContextTypes = {\n      ...(Provider.childContextTypes || {}),\n      [name]: PropTypes.any.isRequired,\n    };\n    Provider.displayName =\n      name.replace(/^./, c => c.toUpperCase()) + 'Provider';\n\n    return Provider;\n  },\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\n\nimport {createPlugin} from 'fusion-core';\nimport type {FusionPlugin, Middleware} from 'fusion-core';\n\nimport Provider from './provider';\n\n// eslint-disable-next-line\ntype FusionPluginNoHidden<TDeps, TService> = $Diff<\n  FusionPlugin<TDeps, TService>,\n  {__plugin__: boolean}\n>;\n\nexport default {\n  create: <TDeps: *, TService: *>(\n    name: string,\n    // eslint-disable-next-line\n    plugin: FusionPluginNoHidden<TDeps, TService> | FusionPlugin<TDeps, TService>,\n    provider?: React.ComponentType<*>\n  ): FusionPlugin<TDeps, TService> => {\n    if (plugin.__plugin__ === undefined) {\n      plugin = createPlugin(plugin);\n    }\n    if (!plugin.__plugin__) {\n      throw new Error(\n        'Provided plugin does not match FusionPlugin<TDeps, TService>'\n      );\n    }\n\n    let originalMiddleware = plugin.middleware;\n    const ProviderComponent = provider || Provider.create(name);\n    plugin.middleware = (deps: *, provides: *) => {\n      let nextMiddleware =\n        originalMiddleware && originalMiddleware(deps, provides);\n      const mw: Middleware = function(ctx, next) {\n        if (ctx.element) {\n          ctx.element = React.createElement(\n            ProviderComponent,\n            {provides, ctx},\n            ctx.element\n          );\n        }\n        if (nextMiddleware) {\n          return nextMiddleware(ctx, next);\n        }\n        return next();\n      };\n      return mw;\n    };\n    return plugin;\n  },\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\n\nimport PropTypes from 'prop-types';\n\ntype ReactHOC = (React.ComponentType<*>) => React.ComponentType<*>;\nexport default {\n  create: (name: string, mapProvidesToProps?: Object => Object): ReactHOC => {\n    const mapProvides = mapProvidesToProps\n      ? mapProvidesToProps\n      : provides => ({[name]: provides});\n    return (Component: React.ComponentType<*>) => {\n      class HOC extends React.Component<*> {\n        provides: any;\n\n        constructor(props: *, ctx: *) {\n          super(props, ctx);\n          this.provides = ctx[name];\n        }\n        render() {\n          const props = {...this.props, ...mapProvides(this.provides)};\n          return React.createElement(Component, props);\n        }\n      }\n      const displayName = Component.displayName || Component.name;\n      HOC.displayName =\n        'With' +\n        name.replace(/^./, c => c.toUpperCase()) +\n        '(' +\n        displayName +\n        ')';\n      HOC.contextTypes = {\n        [name]: PropTypes.any.isRequired,\n      };\n      return HOC;\n    };\n  },\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env browser */\nimport * as React from 'react';\n\nimport FusionApp, {createPlugin} from 'fusion-core';\nimport {prepare, middleware} from './async/index.js';\n\nimport serverRender from './server';\nimport clientRender from './client';\n\nimport ProviderPlugin from './plugin';\nimport ProvidedHOC from './hoc';\nimport Provider from './provider';\n\ndeclare var __NODE__: Boolean;\n\nexport default class App extends FusionApp {\n  constructor(root: React.Element<*>, render: ?(React.Element<*>) => any) {\n    const renderer = createPlugin({\n      provides() {\n        return (el: React.Element<*>) => {\n          return prepare(el).then(() => {\n            if (render) {\n              return render(el);\n            }\n            return __NODE__ ? serverRender(el) : clientRender(el);\n          });\n        };\n      },\n      middleware() {\n        return middleware;\n      },\n    });\n    super(root, renderer);\n  }\n}\n\nexport {ProviderPlugin, ProvidedHOC, Provider};\n\nexport * from './async/index.js';\n"],"names":["REACT_PREPARE","prepared","sideEffect","opts","OriginalComponent","Object","assign","boundary","defer","componentDidMount","componentWillReceiveProps","componentDidUpdate","contextTypes","forceUpdate","prep","prepare","Promise","resolve","PreparedComponent","props","context","then","UNSAFE_componentWillReceiveProps","nextProps","nextContext","render","React","Component","displayName","name","isPrepared","CustomComponent","getPrepare","storeShape","PropTypes","shape","dispatch","func","isRequired","dispatched","prepareUsingDispatch","store","preparedOpts","isReactCompositeComponent","type","prototype","renderCompositeElementInstance","instance","childContext","getChildContext","componentWillMount","UNSAFE_componentWillMount","children","prepareComponentInstance","prepareConfig","prepareElement","element","_typeof","isContextConsumer","_currentValue","isContextProvider","_context","value","isFragment","isForwardRef","CompositeComponent","componentWillUnmount","__UNMOUNTS__","push","_prepare","all","Children","toArray","map","child","__IS_PREPARE__","forEach","fn","CHUNKS_KEY","splitComponentLoaders","array","withAsyncComponent","load","LoadingComponent","ErrorComponent","AsyncComponent","error","chunkIds","WithAsyncComponent","componentPromise","e","reject","loadPromises","loader","asyncComponent","default","catch","err","setTimeout","PrepareProvider","preloadChunks","only","childContextTypes","middleware","ctx","next","prepareTyped","preparedTyped","splitTyped","split","excludeTyped","exclude","el","domElement","document","getElementById","Error","ReactDOM","hydrate","create","Provider","provides","any","replace","c","toUpperCase","plugin","provider","__plugin__","undefined","createPlugin","originalMiddleware","ProviderComponent","deps","nextMiddleware","mw","mapProvidesToProps","mapProvides","HOC","App","root","renderer","clientRender","FusionApp"],"mappings":"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"}