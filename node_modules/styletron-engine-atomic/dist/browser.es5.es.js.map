{"version":3,"file":"browser.es5.es.js","sources":["../src/sequential-id-generator.js","../src/cache.js","../src/hyphenate-style-name.js","../src/validate-no-mixed-hand.js","../src/inject-style-prefixed.js","../src/css.js","../src/client/client.js","../src/server/server.js"],"sourcesContent":["// @flow strict\n\nexport default class SequentialIDGenerator {\n  prefix: string;\n  count: number;\n  offset: number;\n  msb: number;\n  power: number;\n\n  constructor(prefix: string = \"\") {\n    // ensure start with \"ae\" so \"ad\" is never produced\n    this.prefix = prefix;\n    this.count = 0;\n    this.offset = 374;\n    this.msb = 1295;\n    this.power = 2;\n  }\n\n  next() {\n    const id = this.increment().toString(36);\n    return this.prefix ? `${this.prefix}${id}` : id;\n  }\n\n  increment() {\n    const id = this.count + this.offset;\n    if (id === this.msb) {\n      this.offset += (this.msb + 1) * 9;\n      this.msb = Math.pow(36, ++this.power) - 1;\n    }\n    this.count++;\n    return id;\n  }\n}\n","// @flow strict\n\nimport SequentialIDGenerator from \"./sequential-id-generator.js\";\n\nexport class MultiCache<T> {\n  caches: {[string]: Cache<T>};\n  idGenerator: SequentialIDGenerator;\n  onNewCache: (string, Cache<T>) => any;\n  onNewValue: (cache: Cache<T>, id: string, value: T) => any;\n\n  constructor(\n    idGenerator: SequentialIDGenerator,\n    onNewCache: Function,\n    onNewValue: Function,\n  ) {\n    this.idGenerator = idGenerator;\n    this.onNewCache = onNewCache;\n    this.onNewValue = onNewValue;\n    this.caches = {};\n  }\n\n  getCache(key: string): Cache<T> {\n    if (!this.caches[key]) {\n      const cache = new Cache(this.idGenerator, this.onNewValue);\n      cache.key = key;\n      this.caches[key] = cache;\n      this.onNewCache(key, cache);\n    }\n    return this.caches[key];\n  }\n}\n\nexport class Cache<T> {\n  cache: {[string]: string};\n  idGenerator: SequentialIDGenerator;\n  key: string;\n  onNewValue: (cache: Cache<T>, id: string, value: any) => any;\n\n  constructor(\n    idGenerator: SequentialIDGenerator,\n    onNewValue: (cache: Cache<T>, id: string, value: any) => any,\n  ) {\n    this.cache = {};\n    this.idGenerator = idGenerator;\n    this.onNewValue = onNewValue;\n  }\n\n  addValue(key: string, value: T) {\n    const cached = this.cache[key];\n    if (cached) {\n      return cached;\n    }\n    const id = this.idGenerator.next();\n    this.cache[key] = id;\n    this.onNewValue(this, id, value);\n    return id;\n  }\n}\n","// @flow\n\nconst uppercasePattern = /[A-Z]/g;\nconst msPattern = /^ms-/;\nconst cache = {};\n\nexport default function hyphenateStyleName(prop: string): string {\n  return prop in cache\n    ? cache[prop]\n    : (cache[prop] = prop\n        .replace(uppercasePattern, \"-$&\")\n        .toLowerCase()\n        .replace(msPattern, \"-ms-\"));\n}\n","// @flow\n\n/**\n * Adapted from https://github.com/gilmoreorless/css-shorthand-properties\n */\n\nimport hyphenate from \"./hyphenate-style-name.js\";\n\nconst shorthandMap = {\n  // CSS 2.1: https://www.w3.org/TR/CSS2/propidx.html\n  \"list-style\": [\"list-style-type\", \"list-style-position\", \"list-style-image\"],\n  margin: [\"margin-top\", \"margin-right\", \"margin-bottom\", \"margin-left\"],\n  outline: [\"outline-width\", \"outline-style\", \"outline-color\"],\n  padding: [\"padding-top\", \"padding-right\", \"padding-bottom\", \"padding-left\"],\n\n  // CSS Backgrounds and Borders Module Level 3: https://www.w3.org/TR/css3-background/\n  background: [\n    \"background-image\",\n    \"background-position\",\n    \"background-size\",\n    \"background-repeat\",\n    \"background-origin\",\n    \"background-clip\",\n    \"background-attachment\",\n    \"background-color\",\n  ],\n  border: [\n    \"border-top-width\",\n    \"border-right-width\",\n    \"border-bottom-width\",\n    \"border-left-width\",\n    \"border-width\",\n    \"border-top-style\",\n    \"border-right-style\",\n    \"border-bottom-style\",\n    \"border-left-style\",\n    \"border-style\",\n    \"border-top-color\",\n    \"border-right-color\",\n    \"border-bottom-color\",\n    \"border-left-color\",\n    \"border-color\",\n  ],\n  \"border-color\": [\n    \"border-top-color\",\n    \"border-right-color\",\n    \"border-bottom-color\",\n    \"border-left-color\",\n  ],\n  \"border-style\": [\n    \"border-top-style\",\n    \"border-right-style\",\n    \"border-bottom-style\",\n    \"border-left-style\",\n  ],\n  \"border-width\": [\n    \"border-top-width\",\n    \"border-right-width\",\n    \"border-bottom-width\",\n    \"border-left-width\",\n  ],\n  \"border-top\": [\"border-top-width\", \"border-top-style\", \"border-top-color\"],\n  \"border-right\": [\n    \"border-right-width\",\n    \"border-right-style\",\n    \"border-right-color\",\n  ],\n  \"border-bottom\": [\n    \"border-bottom-width\",\n    \"border-bottom-style\",\n    \"border-bottom-color\",\n  ],\n  \"border-left\": [\n    \"border-left-width\",\n    \"border-left-style\",\n    \"border-left-color\",\n  ],\n  \"border-radius\": [\n    \"border-top-left-radius\",\n    \"border-top-right-radius\",\n    \"border-bottom-right-radius\",\n    \"border-bottom-left-radius\",\n  ],\n  \"border-image\": [\n    \"border-image-source\",\n    \"border-image-slice\",\n    \"border-image-width\",\n    \"border-image-outset\",\n    \"border-image-repeat\",\n  ],\n\n  // CSS Fonts Module Level 3: https://www.w3.org/TR/css3-fonts/\n  font: [\n    \"font-style\",\n    \"font-variant-ligatures\",\n    \"font-variant-alternates\",\n    \"font-variant-caps\",\n    \"font-variant-numeric\",\n    \"font-variant-east-asian\",\n    \"font-variant\",\n    \"font-weight\",\n    \"font-stretch\",\n    \"font-size\",\n    \"line-height\",\n    \"font-family\",\n  ],\n  \"font-variant\": [\n    \"font-variant-ligatures\",\n    \"font-variant-alternates\",\n    \"font-variant-caps\",\n    \"font-variant-numeric\",\n    \"font-variant-east-asian\",\n  ],\n\n  // CSS Flexible Box Layout Module Level 1: https://www.w3.org/TR/css3-flexbox-1/\n  flex: [\"flex-grow\", \"flex-shrink\", \"flex-basis\"],\n  \"flex-flow\": [\"flex-direction\", \"flex-wrap\"],\n\n  // CSS Grid Layout Module Level 1: https://www.w3.org/TR/css-grid-1/\n  grid: [\n    \"grid-template-rows\",\n    \"grid-template-columns\",\n    \"grid-template-areas\",\n    \"grid-auto-rows\",\n    \"grid-auto-columns\",\n    \"grid-auto-flow\",\n  ],\n  \"grid-template\": [\n    \"grid-template-rows\",\n    \"grid-template-columns\",\n    \"grid-template-areas\",\n  ],\n  \"grid-row\": [\"grid-row-start\", \"grid-row-end\"],\n  \"grid-column\": [\"grid-column-start\", \"grid-column-end\"],\n  \"grid-area\": [\n    \"grid-row-start\",\n    \"grid-column-start\",\n    \"grid-row-end\",\n    \"grid-column-end\",\n  ],\n  \"grid-gap\": [\"grid-row-gap\", \"grid-column-gap\"],\n\n  // CSS Masking Module Level 1: https://www.w3.org/TR/css-masking/\n  mask: [\n    \"mask-image\",\n    \"mask-mode\",\n    \"mask-position\",\n    \"mask-size\",\n    \"mask-repeat\",\n    \"mask-origin\",\n    \"mask-clip\",\n  ],\n  \"mask-border\": [\n    \"mask-border-source\",\n    \"mask-border-slice\",\n    \"mask-border-width\",\n    \"mask-border-outset\",\n    \"mask-border-repeat\",\n    \"mask-border-mode\",\n  ],\n\n  // CSS Multi-column Layout Module: https://www.w3.org/TR/css3-multicol/\n  columns: [\"column-width\", \"column-count\"],\n  \"column-rule\": [\n    \"column-rule-width\",\n    \"column-rule-style\",\n    \"column-rule-color\",\n  ],\n\n  // CSS Scroll Snap Module Level 1: https://www.w3.org/TR/css-scroll-snap-1/\n  \"scroll-padding\": [\n    \"scroll-padding-top\",\n    \"scroll-padding-right\",\n    \"scroll-padding-bottom\",\n    \"scroll-padding-left\",\n  ],\n  \"scroll-padding-block\": [\n    \"scroll-padding-block-start\",\n    \"scroll-padding-block-end\",\n  ],\n  \"scroll-padding-inline\": [\n    \"scroll-padding-inline-start\",\n    \"scroll-padding-inline-end\",\n  ],\n  \"scroll-snap-margin\": [\n    \"scroll-snap-margin-top\",\n    \"scroll-snap-margin-right\",\n    \"scroll-snap-margin-bottom\",\n    \"scroll-snap-margin-left\",\n  ],\n  \"scroll-snap-margin-block\": [\n    \"scroll-snap-margin-block-start\",\n    \"scroll-snap-margin-block-end\",\n  ],\n  \"scroll-snap-margin-inline\": [\n    \"scroll-snap-margin-inline-start\",\n    \"scroll-snap-margin-inline-end\",\n  ],\n\n  // CSS Speech Module: https://www.w3.org/TR/css3-speech/\n  cue: [\"cue-before\", \"cue-after\"],\n  pause: [\"pause-before\", \"pause-after\"],\n  rest: [\"rest-before\", \"rest-after\"],\n\n  // CSS Text Decoration Module Level 3: https://www.w3.org/TR/css-text-decor-3/\n  \"text-decoration\": [\n    \"text-decoration-line\",\n    \"text-decoration-style\",\n    \"text-decoration-color\",\n  ],\n  \"text-emphasis\": [\"text-emphasis-style\", \"text-emphasis-color\"],\n\n  // CSS Animations (WD): https://www.w3.org/TR/css3-animations\n  animation: [\n    \"animation-name\",\n    \"animation-duration\",\n    \"animation-timing-function\",\n    \"animation-delay\",\n    \"animation-iteration-count\",\n    \"animation-direction\",\n    \"animation-fill-mode\",\n    \"animation-play-state\",\n  ],\n\n  // CSS Transitions (WD): https://www.w3.org/TR/css3-transitions/\n  transition: [\n    \"transition-property\",\n    \"transition-duration\",\n    \"transition-timing-function\",\n    \"transition-delay\",\n  ],\n};\n\nexport function validateNoMixedHand(style: Object) {\n  const hyphenatedProperties = Object.keys(style).reduce((acc, property) => {\n    acc[hyphenate(property)] = property;\n    return acc;\n  }, {});\n\n  const mixed = [];\n  for (const property in hyphenatedProperties) {\n    if (property in shorthandMap) {\n      for (const longhand of shorthandMap[property]) {\n        if (longhand in hyphenatedProperties) {\n          const long = hyphenatedProperties[longhand];\n          const short = hyphenatedProperties[property];\n          mixed.push({\n            shorthand: {property: short, value: style[short]},\n            longhand: {property: long, value: style[long]},\n          });\n        }\n      }\n    }\n  }\n  return mixed;\n}\n","// @flow\n\ndeclare var __DEV__: boolean;\n\nimport hyphenate from \"./hyphenate-style-name.js\";\nimport {validateNoMixedHand} from \"./validate-no-mixed-hand.js\";\nimport prefixAll from \"inline-style-prefixer/static\";\n\nimport type {baseStyleT} from \"styletron-standard\";\n\nimport {MultiCache} from \"./cache.js\";\n\nexport default function injectStylePrefixed(\n  styleCache: MultiCache<{pseudo: string, block: string}>,\n  styles: baseStyleT,\n  media: string,\n  pseudo: string,\n) {\n  const cache = styleCache.getCache(media);\n  let classString = \"\";\n  for (const originalKey in styles) {\n    const originalVal = styles[originalKey];\n\n    if (typeof originalVal !== \"object\") {\n      // Primitive value\n      if (__DEV__) {\n        validateValueType(originalVal);\n      }\n\n      const propValPair = `${hyphenate(\n        originalKey,\n      )}:${((originalVal: any): string)}`;\n      const key = `${pseudo}${propValPair}`;\n      const cachedId = cache.cache[key];\n      if (cachedId !== void 0) {\n        // cache hit\n        classString += \" \" + cachedId;\n        continue;\n      } else {\n        // cache miss\n        let block = \"\";\n        const prefixed = prefixAll({[originalKey]: originalVal});\n        for (const prefixedKey in prefixed) {\n          const prefixedVal = prefixed[prefixedKey];\n          const prefixedValType = typeof prefixedVal;\n          if (prefixedValType === \"string\" || prefixedValType === \"number\") {\n            const prefixedPair = `${hyphenate(prefixedKey)}:${prefixedVal}`;\n            if (prefixedPair !== propValPair) {\n              block += `${prefixedPair};`;\n            }\n          } else if (Array.isArray(prefixedVal)) {\n            const hyphenated = hyphenate(prefixedKey);\n            for (let i = 0; i < prefixedVal.length; i++) {\n              const prefixedPair = `${hyphenated}:${prefixedVal[i]}`;\n              if (prefixedPair !== propValPair) {\n                block += `${prefixedPair};`;\n              }\n            }\n          }\n        }\n        block += propValPair; // ensure original prop/val is last (for hydration)\n        const id = cache.addValue(key, {pseudo, block});\n        classString += \" \" + id;\n      }\n    } else {\n      // Object value\n      if (originalKey[0] === \":\") {\n        classString +=\n          \" \" +\n          injectStylePrefixed(\n            styleCache,\n            originalVal,\n            media,\n            pseudo + originalKey,\n          );\n      } else if (originalKey.substring(0, 6) === \"@media\") {\n        classString +=\n          \" \" +\n          injectStylePrefixed(\n            styleCache,\n            originalVal,\n            originalKey.substr(7),\n            pseudo,\n          );\n      }\n    }\n  }\n\n  if (__DEV__) {\n    const conflicts = validateNoMixedHand(styles);\n    if (conflicts.length) {\n      conflicts.forEach(({shorthand, longhand}) => {\n        const short = JSON.stringify({[shorthand.property]: shorthand.value});\n        const long = JSON.stringify({[longhand.property]: longhand.value});\n        // eslint-disable-next-line no-console\n        console.warn(\n          `Styles \\`${short}\\` and \\`${long}\\` in object yielding class \"${classString.slice(\n            1,\n          )}\" may result in unexpected behavior. Mixing shorthand and longhand properties within the same style object is unsupported with atomic rendering.`,\n        );\n      });\n    }\n  }\n\n  // remove leading space\n  return classString.slice(1);\n}\n\nfunction validateValueType(value) {\n  if (\n    value === null ||\n    Array.isArray(value) ||\n    (typeof value !== \"number\" && typeof value !== \"string\")\n  ) {\n    throw new Error(`Unsupported style value: ${JSON.stringify(value)}`);\n  }\n}\n","// @flow strict\n\nimport hyphenate from \"./hyphenate-style-name.js\";\n\nexport function atomicSelector(id: string, pseudo: string): string {\n  let selector = `.${id}`;\n  if (pseudo) {\n    selector += pseudo;\n  }\n  return selector;\n}\n\nexport function keyframesToBlock(keyframes: Object): string {\n  let result = \"\";\n  for (const thing in keyframes) {\n    result += `${thing}{${declarationsToBlock(keyframes[thing])}}`;\n  }\n  return result;\n}\n\nexport function declarationsToBlock(style: Object): string {\n  let css = \"\";\n  for (const prop in style) {\n    const val = style[prop];\n    if (typeof val === \"string\" || typeof val === \"number\") {\n      css += `${hyphenate(prop)}:${val};`;\n    }\n  }\n  // trim trailing semicolon\n  return css.slice(0, -1);\n}\n\nexport function keyframesBlockToRule(id: string, block: string): string {\n  return `@keyframes ${id}{${block}}`;\n}\n\nexport function fontFaceBlockToRule(id: string, block: string): string {\n  return `@font-face{font-family:${id};${block}}`;\n}\n\nexport function styleBlockToRule(selector: string, block: string): string {\n  return `${selector}{${block}}`;\n}\n","/* eslint-env browser */\n\nconst STYLES_HYDRATOR = /\\.([^{:]+)(:[^{]+)?{(?:[^}]*;)?([^}]*?)}/g;\nconst KEYFRAMES_HYRDATOR = /@keyframes ([^{]+)\\{((?:[^{]+\\{[^}]*\\})*)\\}/g;\nconst FONT_FACE_HYDRATOR = /@font-face\\{font-family:([^;]+);([^}]*)\\}/g;\n\ntype hydratorT =\n  | typeof STYLES_HYDRATOR\n  | typeof KEYFRAMES_HYRDATOR\n  | typeof FONT_FACE_HYDRATOR;\n\nfunction hydrateStyles<T>(cache: Cache<T>, hydrator: hydratorT, css: string) {\n  let match;\n  while ((match = hydrator.exec(css))) {\n    const [, id, pseudo, key] = match;\n    const fullKey = pseudo ? `${pseudo}${key}` : key;\n    cache.cache[fullKey] = id; // set cache without triggering side effects\n    cache.idGenerator.increment(); // increment id\n  }\n}\n\nfunction hydrate<T>(cache: Cache<T>, hydrator: hydratorT, css: string) {\n  let match;\n  while ((match = hydrator.exec(css))) {\n    const [, id, key] = match;\n    cache.cache[key] = id; // set cache without triggering side effects\n    cache.idGenerator.increment(); // increment id\n  }\n}\n\nimport SequentialIDGenerator from \"../sequential-id-generator.js\";\n\nimport type {\n  StandardEngine,\n  keyframesT,\n  fontFaceT,\n  baseStyleT,\n} from \"styletron-standard\";\n\nimport {Cache, MultiCache} from \"../cache.js\";\n\nimport injectStylePrefixed from \"../inject-style-prefixed.js\";\n\nimport {\n  styleBlockToRule,\n  atomicSelector,\n  keyframesBlockToRule,\n  declarationsToBlock,\n  keyframesToBlock,\n  fontFaceBlockToRule,\n} from \"../css.js\";\n\ntype hydrateT =\n  | HTMLCollection<HTMLStyleElement>\n  | Array<HTMLStyleElement>\n  | NodeList<HTMLStyleElement>;\n\ntype optionsT = {\n  hydrate?: hydrateT,\n  container?: Element,\n  prefix?: string,\n};\n\nclass StyletronClient implements StandardEngine {\n  container: Element;\n  styleElements: {[string]: HTMLStyleElement};\n  fontFaceSheet: HTMLStyleElement;\n  keyframesSheet: HTMLStyleElement;\n\n  styleCache: MultiCache<{pseudo: string, block: string}>;\n  keyframesCache: Cache<keyframesT>;\n  fontFaceCache: Cache<fontFaceT>;\n\n  constructor(opts?: optionsT = {}) {\n    this.styleElements = {};\n\n    const styleIdGenerator = new SequentialIDGenerator(opts.prefix);\n    const onNewStyle = (cache, id, value) => {\n      const {pseudo, block} = value;\n      const sheet: CSSStyleSheet = (this.styleElements[cache.key].sheet: any);\n      sheet.insertRule(\n        styleBlockToRule(atomicSelector(id, pseudo), block),\n        sheet.cssRules.length,\n      );\n    };\n\n    // Setup style cache\n    this.styleCache = new MultiCache(\n      styleIdGenerator,\n      media => {\n        const styleElement = document.createElement(\"style\");\n        styleElement.media = media;\n        this.container.appendChild(styleElement);\n        this.styleElements[media] = styleElement;\n      },\n      onNewStyle,\n    );\n\n    this.keyframesCache = new Cache(\n      new SequentialIDGenerator(opts.prefix),\n      (cache, id, value) => {\n        this.styleCache.getCache(\"\");\n        const sheet: CSSStyleSheet = (this.styleElements[\"\"].sheet: any);\n        sheet.insertRule(\n          keyframesBlockToRule(id, keyframesToBlock(value)),\n          sheet.cssRules.length,\n        );\n      },\n    );\n\n    this.fontFaceCache = new Cache(\n      new SequentialIDGenerator(opts.prefix),\n      (cache, id, value) => {\n        this.styleCache.getCache(\"\");\n        const sheet: CSSStyleSheet = (this.styleElements[\"\"].sheet: any);\n        sheet.insertRule(\n          fontFaceBlockToRule(id, declarationsToBlock(value)),\n          sheet.cssRules.length,\n        );\n      },\n    );\n\n    if (opts.container) {\n      this.container = opts.container;\n    }\n\n    // Hydrate\n    if (opts.hydrate && opts.hydrate.length > 0) {\n      // infer container from parent element\n      if (!this.container) {\n        const parentElement = opts.hydrate[0].parentElement;\n        if (parentElement !== null && parentElement !== void 0) {\n          this.container = parentElement;\n        }\n      }\n\n      for (let i = 0; i < opts.hydrate.length; i++) {\n        const element = opts.hydrate[i];\n        const hydrateType = element.dataset.hydrate;\n        if (hydrateType === \"font-face\") {\n          hydrate(this.fontFaceCache, FONT_FACE_HYDRATOR, element.textContent);\n          continue;\n        }\n        if (hydrateType === \"keyframes\") {\n          hydrate(this.keyframesCache, KEYFRAMES_HYRDATOR, element.textContent);\n          continue;\n        }\n        const key = element.media ? element.media : \"\";\n        this.styleElements[key] = element;\n        const cache = new Cache(styleIdGenerator, onNewStyle);\n        cache.key = key;\n        hydrateStyles(cache, STYLES_HYDRATOR, element.textContent);\n        this.styleCache.caches[key] = cache;\n      }\n    }\n\n    if (!this.container) {\n      if (document.head === null) {\n        throw new Error(\"No container provided and `document.head` was null\");\n      }\n      this.container = document.head;\n    }\n  }\n\n  renderStyle(style: baseStyleT): string {\n    return injectStylePrefixed(this.styleCache, style, \"\", \"\");\n  }\n\n  renderFontFace(fontFace: fontFaceT): string {\n    const key = declarationsToBlock(fontFace);\n    return this.fontFaceCache.addValue(key, fontFace);\n  }\n\n  renderKeyframes(keyframes: keyframesT): string {\n    const key = keyframesToBlock(keyframes);\n    return this.keyframesCache.addValue(key, keyframes);\n  }\n}\n\nexport default StyletronClient;\n","// @flow\n\nimport SequentialIDGenerator from \"../sequential-id-generator.js\";\n\nimport type {StandardEngine} from \"styletron-standard\";\n\nimport {Cache, MultiCache} from \"../cache.js\";\n\nimport injectStylePrefixed from \"../inject-style-prefixed.js\";\n\nimport type {baseStyleT, fontFaceT, keyframesT} from \"styletron-standard\";\n\nimport {\n  styleBlockToRule,\n  atomicSelector,\n  keyframesBlockToRule,\n  declarationsToBlock,\n  keyframesToBlock,\n  fontFaceBlockToRule,\n} from \"../css.js\";\n\nexport type sheetT = {|\n  css: string,\n  attrs: {[string]: string},\n|};\n\ntype optionsT = {\n  prefix?: string,\n};\n\nclass StyletronServer implements StandardEngine {\n  styleCache: MultiCache<{pseudo: string, block: string}>;\n  keyframesCache: Cache<keyframesT>;\n  fontFaceCache: Cache<fontFaceT>;\n  styleRules: {[string]: string};\n  keyframesRules: string;\n  fontFaceRules: string;\n\n  constructor(opts?: optionsT = {}) {\n    this.styleRules = {\"\": \"\"};\n    this.styleCache = new MultiCache(\n      new SequentialIDGenerator(opts.prefix),\n      media => {\n        this.styleRules[media] = \"\";\n      },\n      (cache, id, value) => {\n        const {pseudo, block} = value;\n        this.styleRules[cache.key] += styleBlockToRule(\n          atomicSelector(id, pseudo),\n          block,\n        );\n      },\n    );\n\n    this.fontFaceRules = \"\";\n    this.fontFaceCache = new Cache(\n      new SequentialIDGenerator(opts.prefix),\n      (cache, id, value) => {\n        this.fontFaceRules += fontFaceBlockToRule(\n          id,\n          declarationsToBlock(value),\n        );\n      },\n    );\n\n    this.keyframesRules = \"\";\n    this.keyframesCache = new Cache(\n      new SequentialIDGenerator(opts.prefix),\n      (cache, id, value) => {\n        this.keyframesRules += keyframesBlockToRule(\n          id,\n          keyframesToBlock(value),\n        );\n      },\n    );\n  }\n\n  renderStyle(style: baseStyleT): string {\n    return injectStylePrefixed(this.styleCache, style, \"\", \"\");\n  }\n\n  renderFontFace(fontFace: fontFaceT): string {\n    const key = JSON.stringify(fontFace);\n    return this.fontFaceCache.addValue(key, fontFace);\n  }\n\n  renderKeyframes(keyframes: keyframesT): string {\n    const key = JSON.stringify(keyframes);\n    return this.keyframesCache.addValue(key, keyframes);\n  }\n\n  getStylesheets(): Array<sheetT> {\n    return [\n      ...(this.fontFaceRules.length\n        ? [\n            {\n              css: this.fontFaceRules,\n              attrs: {\"data-hydrate\": \"font-face\"},\n            },\n          ]\n        : []),\n      ...sheetify(this.styleRules),\n      ...(this.keyframesRules.length\n        ? [\n            {\n              css: this.keyframesRules,\n              attrs: {\"data-hydrate\": \"keyframes\"},\n            },\n          ]\n        : []),\n    ];\n  }\n\n  getStylesheetsHtml(className?: string = \"_styletron_hydrate_\") {\n    return generateHtmlString(this.getStylesheets(), className);\n  }\n\n  getCss() {\n    return (\n      this.fontFaceRules + stringify(this.styleRules) + this.keyframesRules\n    );\n  }\n}\n\nexport function generateHtmlString(sheets: Array<sheetT>, className: string) {\n  let html = \"\";\n  for (let i = 0; i < sheets.length; i++) {\n    const sheet = sheets[i];\n    const {class: originalClassName, ...rest} = sheet.attrs;\n    const attrs = {\n      class: originalClassName\n        ? `${className} ${originalClassName}`\n        : className,\n      ...rest,\n    };\n    html += `<style${attrsToString(attrs)}>${sheet.css}</style>`;\n  }\n  return html;\n}\n\nfunction attrsToString(attrs) {\n  let result = \"\";\n  for (const attr in attrs) {\n    const value = attrs[attr];\n    if (value === true) {\n      result += \" \" + attr;\n    } else if (value !== false) {\n      result += ` ${attr}=\"${value}\"`;\n    }\n  }\n  return result;\n}\n\nfunction stringify(styleRules) {\n  let result = \"\";\n  for (const media in styleRules) {\n    const rules = styleRules[media];\n    if (media) {\n      result += `@media ${media}{${rules}}`;\n    } else {\n      result += rules;\n    }\n  }\n  return result;\n}\n\nfunction sheetify(styleRules) {\n  const sheets = [];\n  for (const media in styleRules) {\n    // omit media attribute if empty\n    const attrs = media ? {media} : {};\n    sheets.push({css: styleRules[media], attrs});\n  }\n  return sheets;\n}\n\nexport default StyletronServer;\n"],"names":["SequentialIDGenerator","prefix","count","offset","msb","power","next","id","increment","toString","Math","pow","MultiCache","idGenerator","onNewCache","onNewValue","caches","getCache","key","cache","Cache","addValue","value","cached","uppercasePattern","msPattern","hyphenateStyleName","prop","replace","toLowerCase","shorthandMap","validateNoMixedHand","style","hyphenatedProperties","Object","keys","reduce","acc","property","hyphenate","mixed","longhand","long","short","push","injectStylePrefixed","styleCache","styles","media","pseudo","classString","originalKey","originalVal","propValPair","cachedId","block","prefixed","prefixAll","prefixedKey","prefixedVal","prefixedValType","prefixedPair","Array","isArray","hyphenated","i","length","substring","substr","conflicts","forEach","shorthand","JSON","stringify","warn","slice","validateValueType","Error","atomicSelector","selector","keyframesToBlock","keyframes","result","thing","declarationsToBlock","css","val","keyframesBlockToRule","fontFaceBlockToRule","styleBlockToRule","STYLES_HYDRATOR","KEYFRAMES_HYRDATOR","FONT_FACE_HYDRATOR","hydrateStyles","hydrator","match","exec","fullKey","hydrate","StyletronClient","opts","styleElements","styleIdGenerator","onNewStyle","sheet","insertRule","cssRules","styleElement","document","createElement","container","appendChild","keyframesCache","fontFaceCache","parentElement","element","hydrateType","dataset","textContent","head","renderStyle","renderFontFace","fontFace","renderKeyframes","StyletronServer","styleRules","fontFaceRules","keyframesRules","getStylesheets","sheetify","getStylesheetsHtml","className","generateHtmlString","getCss","sheets","html","attrs","originalClassName","class","rest","attrsToString","attr","rules"],"mappings":"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"}