{"version":3,"file":"browser.es2017.es.js","sources":["../src/sequential-id-generator.js","../src/cache.js","../src/hyphenate-style-name.js","../src/validate-no-mixed-hand.js","../src/inject-style-prefixed.js","../src/css.js","../src/client/client.js","../src/server/server.js"],"sourcesContent":["// @flow strict\n\nexport default class SequentialIDGenerator {\n  prefix: string;\n  count: number;\n  offset: number;\n  msb: number;\n  power: number;\n\n  constructor(prefix: string = \"\") {\n    // ensure start with \"ae\" so \"ad\" is never produced\n    this.prefix = prefix;\n    this.count = 0;\n    this.offset = 374;\n    this.msb = 1295;\n    this.power = 2;\n  }\n\n  next() {\n    const id = this.increment().toString(36);\n    return this.prefix ? `${this.prefix}${id}` : id;\n  }\n\n  increment() {\n    const id = this.count + this.offset;\n    if (id === this.msb) {\n      this.offset += (this.msb + 1) * 9;\n      this.msb = Math.pow(36, ++this.power) - 1;\n    }\n    this.count++;\n    return id;\n  }\n}\n","// @flow strict\n\nimport SequentialIDGenerator from \"./sequential-id-generator.js\";\n\nexport class MultiCache<T> {\n  caches: {[string]: Cache<T>};\n  idGenerator: SequentialIDGenerator;\n  onNewCache: (string, Cache<T>) => any;\n  onNewValue: (cache: Cache<T>, id: string, value: T) => any;\n\n  constructor(\n    idGenerator: SequentialIDGenerator,\n    onNewCache: Function,\n    onNewValue: Function,\n  ) {\n    this.idGenerator = idGenerator;\n    this.onNewCache = onNewCache;\n    this.onNewValue = onNewValue;\n    this.caches = {};\n  }\n\n  getCache(key: string): Cache<T> {\n    if (!this.caches[key]) {\n      const cache = new Cache(this.idGenerator, this.onNewValue);\n      cache.key = key;\n      this.caches[key] = cache;\n      this.onNewCache(key, cache);\n    }\n    return this.caches[key];\n  }\n}\n\nexport class Cache<T> {\n  cache: {[string]: string};\n  idGenerator: SequentialIDGenerator;\n  key: string;\n  onNewValue: (cache: Cache<T>, id: string, value: any) => any;\n\n  constructor(\n    idGenerator: SequentialIDGenerator,\n    onNewValue: (cache: Cache<T>, id: string, value: any) => any,\n  ) {\n    this.cache = {};\n    this.idGenerator = idGenerator;\n    this.onNewValue = onNewValue;\n  }\n\n  addValue(key: string, value: T) {\n    const cached = this.cache[key];\n    if (cached) {\n      return cached;\n    }\n    const id = this.idGenerator.next();\n    this.cache[key] = id;\n    this.onNewValue(this, id, value);\n    return id;\n  }\n}\n","// @flow\n\nconst uppercasePattern = /[A-Z]/g;\nconst msPattern = /^ms-/;\nconst cache = {};\n\nexport default function hyphenateStyleName(prop: string): string {\n  return prop in cache\n    ? cache[prop]\n    : (cache[prop] = prop\n        .replace(uppercasePattern, \"-$&\")\n        .toLowerCase()\n        .replace(msPattern, \"-ms-\"));\n}\n","// @flow\n\n/**\n * Adapted from https://github.com/gilmoreorless/css-shorthand-properties\n */\n\nimport hyphenate from \"./hyphenate-style-name.js\";\n\nconst shorthandMap = {\n  // CSS 2.1: https://www.w3.org/TR/CSS2/propidx.html\n  \"list-style\": [\"list-style-type\", \"list-style-position\", \"list-style-image\"],\n  margin: [\"margin-top\", \"margin-right\", \"margin-bottom\", \"margin-left\"],\n  outline: [\"outline-width\", \"outline-style\", \"outline-color\"],\n  padding: [\"padding-top\", \"padding-right\", \"padding-bottom\", \"padding-left\"],\n\n  // CSS Backgrounds and Borders Module Level 3: https://www.w3.org/TR/css3-background/\n  background: [\n    \"background-image\",\n    \"background-position\",\n    \"background-size\",\n    \"background-repeat\",\n    \"background-origin\",\n    \"background-clip\",\n    \"background-attachment\",\n    \"background-color\",\n  ],\n  border: [\n    \"border-top-width\",\n    \"border-right-width\",\n    \"border-bottom-width\",\n    \"border-left-width\",\n    \"border-width\",\n    \"border-top-style\",\n    \"border-right-style\",\n    \"border-bottom-style\",\n    \"border-left-style\",\n    \"border-style\",\n    \"border-top-color\",\n    \"border-right-color\",\n    \"border-bottom-color\",\n    \"border-left-color\",\n    \"border-color\",\n  ],\n  \"border-color\": [\n    \"border-top-color\",\n    \"border-right-color\",\n    \"border-bottom-color\",\n    \"border-left-color\",\n  ],\n  \"border-style\": [\n    \"border-top-style\",\n    \"border-right-style\",\n    \"border-bottom-style\",\n    \"border-left-style\",\n  ],\n  \"border-width\": [\n    \"border-top-width\",\n    \"border-right-width\",\n    \"border-bottom-width\",\n    \"border-left-width\",\n  ],\n  \"border-top\": [\"border-top-width\", \"border-top-style\", \"border-top-color\"],\n  \"border-right\": [\n    \"border-right-width\",\n    \"border-right-style\",\n    \"border-right-color\",\n  ],\n  \"border-bottom\": [\n    \"border-bottom-width\",\n    \"border-bottom-style\",\n    \"border-bottom-color\",\n  ],\n  \"border-left\": [\n    \"border-left-width\",\n    \"border-left-style\",\n    \"border-left-color\",\n  ],\n  \"border-radius\": [\n    \"border-top-left-radius\",\n    \"border-top-right-radius\",\n    \"border-bottom-right-radius\",\n    \"border-bottom-left-radius\",\n  ],\n  \"border-image\": [\n    \"border-image-source\",\n    \"border-image-slice\",\n    \"border-image-width\",\n    \"border-image-outset\",\n    \"border-image-repeat\",\n  ],\n\n  // CSS Fonts Module Level 3: https://www.w3.org/TR/css3-fonts/\n  font: [\n    \"font-style\",\n    \"font-variant-ligatures\",\n    \"font-variant-alternates\",\n    \"font-variant-caps\",\n    \"font-variant-numeric\",\n    \"font-variant-east-asian\",\n    \"font-variant\",\n    \"font-weight\",\n    \"font-stretch\",\n    \"font-size\",\n    \"line-height\",\n    \"font-family\",\n  ],\n  \"font-variant\": [\n    \"font-variant-ligatures\",\n    \"font-variant-alternates\",\n    \"font-variant-caps\",\n    \"font-variant-numeric\",\n    \"font-variant-east-asian\",\n  ],\n\n  // CSS Flexible Box Layout Module Level 1: https://www.w3.org/TR/css3-flexbox-1/\n  flex: [\"flex-grow\", \"flex-shrink\", \"flex-basis\"],\n  \"flex-flow\": [\"flex-direction\", \"flex-wrap\"],\n\n  // CSS Grid Layout Module Level 1: https://www.w3.org/TR/css-grid-1/\n  grid: [\n    \"grid-template-rows\",\n    \"grid-template-columns\",\n    \"grid-template-areas\",\n    \"grid-auto-rows\",\n    \"grid-auto-columns\",\n    \"grid-auto-flow\",\n  ],\n  \"grid-template\": [\n    \"grid-template-rows\",\n    \"grid-template-columns\",\n    \"grid-template-areas\",\n  ],\n  \"grid-row\": [\"grid-row-start\", \"grid-row-end\"],\n  \"grid-column\": [\"grid-column-start\", \"grid-column-end\"],\n  \"grid-area\": [\n    \"grid-row-start\",\n    \"grid-column-start\",\n    \"grid-row-end\",\n    \"grid-column-end\",\n  ],\n  \"grid-gap\": [\"grid-row-gap\", \"grid-column-gap\"],\n\n  // CSS Masking Module Level 1: https://www.w3.org/TR/css-masking/\n  mask: [\n    \"mask-image\",\n    \"mask-mode\",\n    \"mask-position\",\n    \"mask-size\",\n    \"mask-repeat\",\n    \"mask-origin\",\n    \"mask-clip\",\n  ],\n  \"mask-border\": [\n    \"mask-border-source\",\n    \"mask-border-slice\",\n    \"mask-border-width\",\n    \"mask-border-outset\",\n    \"mask-border-repeat\",\n    \"mask-border-mode\",\n  ],\n\n  // CSS Multi-column Layout Module: https://www.w3.org/TR/css3-multicol/\n  columns: [\"column-width\", \"column-count\"],\n  \"column-rule\": [\n    \"column-rule-width\",\n    \"column-rule-style\",\n    \"column-rule-color\",\n  ],\n\n  // CSS Scroll Snap Module Level 1: https://www.w3.org/TR/css-scroll-snap-1/\n  \"scroll-padding\": [\n    \"scroll-padding-top\",\n    \"scroll-padding-right\",\n    \"scroll-padding-bottom\",\n    \"scroll-padding-left\",\n  ],\n  \"scroll-padding-block\": [\n    \"scroll-padding-block-start\",\n    \"scroll-padding-block-end\",\n  ],\n  \"scroll-padding-inline\": [\n    \"scroll-padding-inline-start\",\n    \"scroll-padding-inline-end\",\n  ],\n  \"scroll-snap-margin\": [\n    \"scroll-snap-margin-top\",\n    \"scroll-snap-margin-right\",\n    \"scroll-snap-margin-bottom\",\n    \"scroll-snap-margin-left\",\n  ],\n  \"scroll-snap-margin-block\": [\n    \"scroll-snap-margin-block-start\",\n    \"scroll-snap-margin-block-end\",\n  ],\n  \"scroll-snap-margin-inline\": [\n    \"scroll-snap-margin-inline-start\",\n    \"scroll-snap-margin-inline-end\",\n  ],\n\n  // CSS Speech Module: https://www.w3.org/TR/css3-speech/\n  cue: [\"cue-before\", \"cue-after\"],\n  pause: [\"pause-before\", \"pause-after\"],\n  rest: [\"rest-before\", \"rest-after\"],\n\n  // CSS Text Decoration Module Level 3: https://www.w3.org/TR/css-text-decor-3/\n  \"text-decoration\": [\n    \"text-decoration-line\",\n    \"text-decoration-style\",\n    \"text-decoration-color\",\n  ],\n  \"text-emphasis\": [\"text-emphasis-style\", \"text-emphasis-color\"],\n\n  // CSS Animations (WD): https://www.w3.org/TR/css3-animations\n  animation: [\n    \"animation-name\",\n    \"animation-duration\",\n    \"animation-timing-function\",\n    \"animation-delay\",\n    \"animation-iteration-count\",\n    \"animation-direction\",\n    \"animation-fill-mode\",\n    \"animation-play-state\",\n  ],\n\n  // CSS Transitions (WD): https://www.w3.org/TR/css3-transitions/\n  transition: [\n    \"transition-property\",\n    \"transition-duration\",\n    \"transition-timing-function\",\n    \"transition-delay\",\n  ],\n};\n\nexport function validateNoMixedHand(style: Object) {\n  const hyphenatedProperties = Object.keys(style).reduce((acc, property) => {\n    acc[hyphenate(property)] = property;\n    return acc;\n  }, {});\n\n  const mixed = [];\n  for (const property in hyphenatedProperties) {\n    if (property in shorthandMap) {\n      for (const longhand of shorthandMap[property]) {\n        if (longhand in hyphenatedProperties) {\n          const long = hyphenatedProperties[longhand];\n          const short = hyphenatedProperties[property];\n          mixed.push({\n            shorthand: {property: short, value: style[short]},\n            longhand: {property: long, value: style[long]},\n          });\n        }\n      }\n    }\n  }\n  return mixed;\n}\n","// @flow\n\ndeclare var __DEV__: boolean;\n\nimport hyphenate from \"./hyphenate-style-name.js\";\nimport {validateNoMixedHand} from \"./validate-no-mixed-hand.js\";\nimport prefixAll from \"inline-style-prefixer/static\";\n\nimport type {baseStyleT} from \"styletron-standard\";\n\nimport {MultiCache} from \"./cache.js\";\n\nexport default function injectStylePrefixed(\n  styleCache: MultiCache<{pseudo: string, block: string}>,\n  styles: baseStyleT,\n  media: string,\n  pseudo: string,\n) {\n  const cache = styleCache.getCache(media);\n  let classString = \"\";\n  for (const originalKey in styles) {\n    const originalVal = styles[originalKey];\n\n    if (typeof originalVal !== \"object\") {\n      // Primitive value\n      if (__DEV__) {\n        validateValueType(originalVal);\n      }\n\n      const propValPair = `${hyphenate(\n        originalKey,\n      )}:${((originalVal: any): string)}`;\n      const key = `${pseudo}${propValPair}`;\n      const cachedId = cache.cache[key];\n      if (cachedId !== void 0) {\n        // cache hit\n        classString += \" \" + cachedId;\n        continue;\n      } else {\n        // cache miss\n        let block = \"\";\n        const prefixed = prefixAll({[originalKey]: originalVal});\n        for (const prefixedKey in prefixed) {\n          const prefixedVal = prefixed[prefixedKey];\n          const prefixedValType = typeof prefixedVal;\n          if (prefixedValType === \"string\" || prefixedValType === \"number\") {\n            const prefixedPair = `${hyphenate(prefixedKey)}:${prefixedVal}`;\n            if (prefixedPair !== propValPair) {\n              block += `${prefixedPair};`;\n            }\n          } else if (Array.isArray(prefixedVal)) {\n            const hyphenated = hyphenate(prefixedKey);\n            for (let i = 0; i < prefixedVal.length; i++) {\n              const prefixedPair = `${hyphenated}:${prefixedVal[i]}`;\n              if (prefixedPair !== propValPair) {\n                block += `${prefixedPair};`;\n              }\n            }\n          }\n        }\n        block += propValPair; // ensure original prop/val is last (for hydration)\n        const id = cache.addValue(key, {pseudo, block});\n        classString += \" \" + id;\n      }\n    } else {\n      // Object value\n      if (originalKey[0] === \":\") {\n        classString +=\n          \" \" +\n          injectStylePrefixed(\n            styleCache,\n            originalVal,\n            media,\n            pseudo + originalKey,\n          );\n      } else if (originalKey.substring(0, 6) === \"@media\") {\n        classString +=\n          \" \" +\n          injectStylePrefixed(\n            styleCache,\n            originalVal,\n            originalKey.substr(7),\n            pseudo,\n          );\n      }\n    }\n  }\n\n  if (__DEV__) {\n    const conflicts = validateNoMixedHand(styles);\n    if (conflicts.length) {\n      conflicts.forEach(({shorthand, longhand}) => {\n        const short = JSON.stringify({[shorthand.property]: shorthand.value});\n        const long = JSON.stringify({[longhand.property]: longhand.value});\n        // eslint-disable-next-line no-console\n        console.warn(\n          `Styles \\`${short}\\` and \\`${long}\\` in object yielding class \"${classString.slice(\n            1,\n          )}\" may result in unexpected behavior. Mixing shorthand and longhand properties within the same style object is unsupported with atomic rendering.`,\n        );\n      });\n    }\n  }\n\n  // remove leading space\n  return classString.slice(1);\n}\n\nfunction validateValueType(value) {\n  if (\n    value === null ||\n    Array.isArray(value) ||\n    (typeof value !== \"number\" && typeof value !== \"string\")\n  ) {\n    throw new Error(`Unsupported style value: ${JSON.stringify(value)}`);\n  }\n}\n","// @flow strict\n\nimport hyphenate from \"./hyphenate-style-name.js\";\n\nexport function atomicSelector(id: string, pseudo: string): string {\n  let selector = `.${id}`;\n  if (pseudo) {\n    selector += pseudo;\n  }\n  return selector;\n}\n\nexport function keyframesToBlock(keyframes: Object): string {\n  let result = \"\";\n  for (const thing in keyframes) {\n    result += `${thing}{${declarationsToBlock(keyframes[thing])}}`;\n  }\n  return result;\n}\n\nexport function declarationsToBlock(style: Object): string {\n  let css = \"\";\n  for (const prop in style) {\n    const val = style[prop];\n    if (typeof val === \"string\" || typeof val === \"number\") {\n      css += `${hyphenate(prop)}:${val};`;\n    }\n  }\n  // trim trailing semicolon\n  return css.slice(0, -1);\n}\n\nexport function keyframesBlockToRule(id: string, block: string): string {\n  return `@keyframes ${id}{${block}}`;\n}\n\nexport function fontFaceBlockToRule(id: string, block: string): string {\n  return `@font-face{font-family:${id};${block}}`;\n}\n\nexport function styleBlockToRule(selector: string, block: string): string {\n  return `${selector}{${block}}`;\n}\n","/* eslint-env browser */\n\nconst STYLES_HYDRATOR = /\\.([^{:]+)(:[^{]+)?{(?:[^}]*;)?([^}]*?)}/g;\nconst KEYFRAMES_HYRDATOR = /@keyframes ([^{]+)\\{((?:[^{]+\\{[^}]*\\})*)\\}/g;\nconst FONT_FACE_HYDRATOR = /@font-face\\{font-family:([^;]+);([^}]*)\\}/g;\n\ntype hydratorT =\n  | typeof STYLES_HYDRATOR\n  | typeof KEYFRAMES_HYRDATOR\n  | typeof FONT_FACE_HYDRATOR;\n\nfunction hydrateStyles<T>(cache: Cache<T>, hydrator: hydratorT, css: string) {\n  let match;\n  while ((match = hydrator.exec(css))) {\n    const [, id, pseudo, key] = match;\n    const fullKey = pseudo ? `${pseudo}${key}` : key;\n    cache.cache[fullKey] = id; // set cache without triggering side effects\n    cache.idGenerator.increment(); // increment id\n  }\n}\n\nfunction hydrate<T>(cache: Cache<T>, hydrator: hydratorT, css: string) {\n  let match;\n  while ((match = hydrator.exec(css))) {\n    const [, id, key] = match;\n    cache.cache[key] = id; // set cache without triggering side effects\n    cache.idGenerator.increment(); // increment id\n  }\n}\n\nimport SequentialIDGenerator from \"../sequential-id-generator.js\";\n\nimport type {\n  StandardEngine,\n  keyframesT,\n  fontFaceT,\n  baseStyleT,\n} from \"styletron-standard\";\n\nimport {Cache, MultiCache} from \"../cache.js\";\n\nimport injectStylePrefixed from \"../inject-style-prefixed.js\";\n\nimport {\n  styleBlockToRule,\n  atomicSelector,\n  keyframesBlockToRule,\n  declarationsToBlock,\n  keyframesToBlock,\n  fontFaceBlockToRule,\n} from \"../css.js\";\n\ntype hydrateT =\n  | HTMLCollection<HTMLStyleElement>\n  | Array<HTMLStyleElement>\n  | NodeList<HTMLStyleElement>;\n\ntype optionsT = {\n  hydrate?: hydrateT,\n  container?: Element,\n  prefix?: string,\n};\n\nclass StyletronClient implements StandardEngine {\n  container: Element;\n  styleElements: {[string]: HTMLStyleElement};\n  fontFaceSheet: HTMLStyleElement;\n  keyframesSheet: HTMLStyleElement;\n\n  styleCache: MultiCache<{pseudo: string, block: string}>;\n  keyframesCache: Cache<keyframesT>;\n  fontFaceCache: Cache<fontFaceT>;\n\n  constructor(opts?: optionsT = {}) {\n    this.styleElements = {};\n\n    const styleIdGenerator = new SequentialIDGenerator(opts.prefix);\n    const onNewStyle = (cache, id, value) => {\n      const {pseudo, block} = value;\n      const sheet: CSSStyleSheet = (this.styleElements[cache.key].sheet: any);\n      sheet.insertRule(\n        styleBlockToRule(atomicSelector(id, pseudo), block),\n        sheet.cssRules.length,\n      );\n    };\n\n    // Setup style cache\n    this.styleCache = new MultiCache(\n      styleIdGenerator,\n      media => {\n        const styleElement = document.createElement(\"style\");\n        styleElement.media = media;\n        this.container.appendChild(styleElement);\n        this.styleElements[media] = styleElement;\n      },\n      onNewStyle,\n    );\n\n    this.keyframesCache = new Cache(\n      new SequentialIDGenerator(opts.prefix),\n      (cache, id, value) => {\n        this.styleCache.getCache(\"\");\n        const sheet: CSSStyleSheet = (this.styleElements[\"\"].sheet: any);\n        sheet.insertRule(\n          keyframesBlockToRule(id, keyframesToBlock(value)),\n          sheet.cssRules.length,\n        );\n      },\n    );\n\n    this.fontFaceCache = new Cache(\n      new SequentialIDGenerator(opts.prefix),\n      (cache, id, value) => {\n        this.styleCache.getCache(\"\");\n        const sheet: CSSStyleSheet = (this.styleElements[\"\"].sheet: any);\n        sheet.insertRule(\n          fontFaceBlockToRule(id, declarationsToBlock(value)),\n          sheet.cssRules.length,\n        );\n      },\n    );\n\n    if (opts.container) {\n      this.container = opts.container;\n    }\n\n    // Hydrate\n    if (opts.hydrate && opts.hydrate.length > 0) {\n      // infer container from parent element\n      if (!this.container) {\n        const parentElement = opts.hydrate[0].parentElement;\n        if (parentElement !== null && parentElement !== void 0) {\n          this.container = parentElement;\n        }\n      }\n\n      for (let i = 0; i < opts.hydrate.length; i++) {\n        const element = opts.hydrate[i];\n        const hydrateType = element.dataset.hydrate;\n        if (hydrateType === \"font-face\") {\n          hydrate(this.fontFaceCache, FONT_FACE_HYDRATOR, element.textContent);\n          continue;\n        }\n        if (hydrateType === \"keyframes\") {\n          hydrate(this.keyframesCache, KEYFRAMES_HYRDATOR, element.textContent);\n          continue;\n        }\n        const key = element.media ? element.media : \"\";\n        this.styleElements[key] = element;\n        const cache = new Cache(styleIdGenerator, onNewStyle);\n        cache.key = key;\n        hydrateStyles(cache, STYLES_HYDRATOR, element.textContent);\n        this.styleCache.caches[key] = cache;\n      }\n    }\n\n    if (!this.container) {\n      if (document.head === null) {\n        throw new Error(\"No container provided and `document.head` was null\");\n      }\n      this.container = document.head;\n    }\n  }\n\n  renderStyle(style: baseStyleT): string {\n    return injectStylePrefixed(this.styleCache, style, \"\", \"\");\n  }\n\n  renderFontFace(fontFace: fontFaceT): string {\n    const key = declarationsToBlock(fontFace);\n    return this.fontFaceCache.addValue(key, fontFace);\n  }\n\n  renderKeyframes(keyframes: keyframesT): string {\n    const key = keyframesToBlock(keyframes);\n    return this.keyframesCache.addValue(key, keyframes);\n  }\n}\n\nexport default StyletronClient;\n","// @flow\n\nimport SequentialIDGenerator from \"../sequential-id-generator.js\";\n\nimport type {StandardEngine} from \"styletron-standard\";\n\nimport {Cache, MultiCache} from \"../cache.js\";\n\nimport injectStylePrefixed from \"../inject-style-prefixed.js\";\n\nimport type {baseStyleT, fontFaceT, keyframesT} from \"styletron-standard\";\n\nimport {\n  styleBlockToRule,\n  atomicSelector,\n  keyframesBlockToRule,\n  declarationsToBlock,\n  keyframesToBlock,\n  fontFaceBlockToRule,\n} from \"../css.js\";\n\nexport type sheetT = {|\n  css: string,\n  attrs: {[string]: string},\n|};\n\ntype optionsT = {\n  prefix?: string,\n};\n\nclass StyletronServer implements StandardEngine {\n  styleCache: MultiCache<{pseudo: string, block: string}>;\n  keyframesCache: Cache<keyframesT>;\n  fontFaceCache: Cache<fontFaceT>;\n  styleRules: {[string]: string};\n  keyframesRules: string;\n  fontFaceRules: string;\n\n  constructor(opts?: optionsT = {}) {\n    this.styleRules = {\"\": \"\"};\n    this.styleCache = new MultiCache(\n      new SequentialIDGenerator(opts.prefix),\n      media => {\n        this.styleRules[media] = \"\";\n      },\n      (cache, id, value) => {\n        const {pseudo, block} = value;\n        this.styleRules[cache.key] += styleBlockToRule(\n          atomicSelector(id, pseudo),\n          block,\n        );\n      },\n    );\n\n    this.fontFaceRules = \"\";\n    this.fontFaceCache = new Cache(\n      new SequentialIDGenerator(opts.prefix),\n      (cache, id, value) => {\n        this.fontFaceRules += fontFaceBlockToRule(\n          id,\n          declarationsToBlock(value),\n        );\n      },\n    );\n\n    this.keyframesRules = \"\";\n    this.keyframesCache = new Cache(\n      new SequentialIDGenerator(opts.prefix),\n      (cache, id, value) => {\n        this.keyframesRules += keyframesBlockToRule(\n          id,\n          keyframesToBlock(value),\n        );\n      },\n    );\n  }\n\n  renderStyle(style: baseStyleT): string {\n    return injectStylePrefixed(this.styleCache, style, \"\", \"\");\n  }\n\n  renderFontFace(fontFace: fontFaceT): string {\n    const key = JSON.stringify(fontFace);\n    return this.fontFaceCache.addValue(key, fontFace);\n  }\n\n  renderKeyframes(keyframes: keyframesT): string {\n    const key = JSON.stringify(keyframes);\n    return this.keyframesCache.addValue(key, keyframes);\n  }\n\n  getStylesheets(): Array<sheetT> {\n    return [\n      ...(this.fontFaceRules.length\n        ? [\n            {\n              css: this.fontFaceRules,\n              attrs: {\"data-hydrate\": \"font-face\"},\n            },\n          ]\n        : []),\n      ...sheetify(this.styleRules),\n      ...(this.keyframesRules.length\n        ? [\n            {\n              css: this.keyframesRules,\n              attrs: {\"data-hydrate\": \"keyframes\"},\n            },\n          ]\n        : []),\n    ];\n  }\n\n  getStylesheetsHtml(className?: string = \"_styletron_hydrate_\") {\n    return generateHtmlString(this.getStylesheets(), className);\n  }\n\n  getCss() {\n    return (\n      this.fontFaceRules + stringify(this.styleRules) + this.keyframesRules\n    );\n  }\n}\n\nexport function generateHtmlString(sheets: Array<sheetT>, className: string) {\n  let html = \"\";\n  for (let i = 0; i < sheets.length; i++) {\n    const sheet = sheets[i];\n    const {class: originalClassName, ...rest} = sheet.attrs;\n    const attrs = {\n      class: originalClassName\n        ? `${className} ${originalClassName}`\n        : className,\n      ...rest,\n    };\n    html += `<style${attrsToString(attrs)}>${sheet.css}</style>`;\n  }\n  return html;\n}\n\nfunction attrsToString(attrs) {\n  let result = \"\";\n  for (const attr in attrs) {\n    const value = attrs[attr];\n    if (value === true) {\n      result += \" \" + attr;\n    } else if (value !== false) {\n      result += ` ${attr}=\"${value}\"`;\n    }\n  }\n  return result;\n}\n\nfunction stringify(styleRules) {\n  let result = \"\";\n  for (const media in styleRules) {\n    const rules = styleRules[media];\n    if (media) {\n      result += `@media ${media}{${rules}}`;\n    } else {\n      result += rules;\n    }\n  }\n  return result;\n}\n\nfunction sheetify(styleRules) {\n  const sheets = [];\n  for (const media in styleRules) {\n    // omit media attribute if empty\n    const attrs = media ? {media} : {};\n    sheets.push({css: styleRules[media], attrs});\n  }\n  return sheets;\n}\n\nexport default StyletronServer;\n"],"names":["SequentialIDGenerator","prefix","count","offset","msb","power","id","increment","toString","Math","pow","MultiCache","idGenerator","onNewCache","onNewValue","caches","key","cache","Cache","value","cached","next","uppercasePattern","msPattern","hyphenateStyleName","prop","replace","toLowerCase","shorthandMap","validateNoMixedHand","style","hyphenatedProperties","Object","keys","reduce","acc","property","hyphenate","mixed","longhand","long","short","push","injectStylePrefixed","styleCache","styles","media","pseudo","getCache","classString","originalKey","originalVal","propValPair","cachedId","block","prefixed","prefixAll","prefixedKey","prefixedVal","prefixedValType","prefixedPair","Array","isArray","hyphenated","i","length","addValue","substring","substr","conflicts","forEach","JSON","stringify","shorthand","warn","slice","validateValueType","Error","atomicSelector","selector","keyframesToBlock","keyframes","result","thing","declarationsToBlock","css","val","keyframesBlockToRule","fontFaceBlockToRule","styleBlockToRule","STYLES_HYDRATOR","KEYFRAMES_HYRDATOR","FONT_FACE_HYDRATOR","hydrateStyles","hydrator","match","exec","fullKey","hydrate","StyletronClient","opts","styleElements","styleIdGenerator","onNewStyle","sheet","insertRule","cssRules","styleElement","document","createElement","container","appendChild","keyframesCache","fontFaceCache","parentElement","element","hydrateType","dataset","textContent","head","fontFace","StyletronServer","styleRules","fontFaceRules","keyframesRules","sheetify","className","generateHtmlString","getStylesheets","sheets","html","attrs","originalClassName","rest","attrsToString","attr","rules"],"mappings":";;AAAA;AAEA,AAAe,MAAMA,qBAAN,CAA4B;cAO7BC,SAAiB,EAA7B,EAAiC;;SAE1BA,MAAL,GAAcA,MAAd;SACKC,KAAL,GAAa,CAAb;SACKC,MAAL,GAAc,GAAd;SACKC,GAAL,GAAW,IAAX;SACKC,KAAL,GAAa,CAAb;;;SAGK;UACCC,KAAK,KAAKC,SAAL,GAAiBC,QAAjB,CAA0B,EAA1B,CAAX;WACO,KAAKP,MAAL,GAAe,GAAE,KAAKA,MAAO,GAAEK,EAAG,EAAlC,GAAsCA,EAA7C;;;cAGU;UACJA,KAAK,KAAKJ,KAAL,GAAa,KAAKC,MAA7B;;QACIG,OAAO,KAAKF,GAAhB,EAAqB;WACdD,MAAL,IAAe,CAAC,KAAKC,GAAL,GAAW,CAAZ,IAAiB,CAAhC;WACKA,GAAL,GAAWK,KAAKC,GAAL,CAAS,EAAT,EAAa,EAAE,KAAKL,KAApB,IAA6B,CAAxC;;;SAEGH,KAAL;WACOI,EAAP;;;;;AC9BJ;AAEA,AAEO,MAAMK,UAAN,CAAoB;cAOvBC,WADF,EAEEC,UAFF,EAGEC,UAHF,EAIE;SACKF,WAAL,GAAmBA,WAAnB;SACKC,UAAL,GAAkBA,UAAlB;SACKC,UAAL,GAAkBA,UAAlB;SACKC,MAAL,GAAc,EAAd;;;WAGOC,GAAT,EAAgC;QAC1B,CAAC,KAAKD,MAAL,CAAYC,GAAZ,CAAL,EAAuB;YACfC,QAAQ,IAAIC,KAAJ,CAAU,KAAKN,WAAf,EAA4B,KAAKE,UAAjC,CAAd;YACME,GAAN,GAAYA,GAAZ;WACKD,MAAL,CAAYC,GAAZ,IAAmBC,KAAnB;WACKJ,UAAL,CAAgBG,GAAhB,EAAqBC,KAArB;;;WAEK,KAAKF,MAAL,CAAYC,GAAZ,CAAP;;;;AAIJ,AAAO,MAAME,KAAN,CAAe;cAOlBN,WADF,EAEEE,UAFF,EAGE;SACKG,KAAL,GAAa,EAAb;SACKL,WAAL,GAAmBA,WAAnB;SACKE,UAAL,GAAkBA,UAAlB;;;WAGOE,GAAT,EAAsBG,KAAtB,EAAgC;UACxBC,SAAS,KAAKH,KAAL,CAAWD,GAAX,CAAf;;QACII,MAAJ,EAAY;aACHA,MAAP;;;UAEId,KAAK,KAAKM,WAAL,CAAiBS,IAAjB,EAAX;SACKJ,KAAL,CAAWD,GAAX,IAAkBV,EAAlB;SACKQ,UAAL,CAAgB,IAAhB,EAAsBR,EAAtB,EAA0Ba,KAA1B;WACOb,EAAP;;;;;ACrDJ,MAAMgB,mBAAmB,QAAzB;AACA,MAAMC,YAAY,MAAlB;AACA,MAAMN,QAAQ,EAAd;AAEA,AAAe,SAASO,kBAAT,CAA4BC,IAA5B,EAAkD;SACxDA,QAAQR,KAAR,GACHA,MAAMQ,IAAN,CADG,GAEFR,MAAMQ,IAAN,IAAcA,KACZC,OADY,CACJJ,gBADI,EACc,KADd,EAEZK,WAFY,GAGZD,OAHY,CAGJH,SAHI,EAGO,MAHP,CAFnB;;;ACLF;;;AAIA,AAEA,MAAMK,eAAe;;gBAEL,CAAC,iBAAD,EAAoB,qBAApB,EAA2C,kBAA3C,CAFK;UAGX,CAAC,YAAD,EAAe,cAAf,EAA+B,eAA/B,EAAgD,aAAhD,CAHW;WAIV,CAAC,eAAD,EAAkB,eAAlB,EAAmC,eAAnC,CAJU;WAKV,CAAC,aAAD,EAAgB,eAAhB,EAAiC,gBAAjC,EAAmD,cAAnD,CALU;;cAQP,CACV,kBADU,EAEV,qBAFU,EAGV,iBAHU,EAIV,mBAJU,EAKV,mBALU,EAMV,iBANU,EAOV,uBAPU,EAQV,kBARU,CARO;UAkBX,CACN,kBADM,EAEN,oBAFM,EAGN,qBAHM,EAIN,mBAJM,EAKN,cALM,EAMN,kBANM,EAON,oBAPM,EAQN,qBARM,EASN,mBATM,EAUN,cAVM,EAWN,kBAXM,EAYN,oBAZM,EAaN,qBAbM,EAcN,mBAdM,EAeN,cAfM,CAlBW;kBAmCH,CACd,kBADc,EAEd,oBAFc,EAGd,qBAHc,EAId,mBAJc,CAnCG;kBAyCH,CACd,kBADc,EAEd,oBAFc,EAGd,qBAHc,EAId,mBAJc,CAzCG;kBA+CH,CACd,kBADc,EAEd,oBAFc,EAGd,qBAHc,EAId,mBAJc,CA/CG;gBAqDL,CAAC,kBAAD,EAAqB,kBAArB,EAAyC,kBAAzC,CArDK;kBAsDH,CACd,oBADc,EAEd,oBAFc,EAGd,oBAHc,CAtDG;mBA2DF,CACf,qBADe,EAEf,qBAFe,EAGf,qBAHe,CA3DE;iBAgEJ,CACb,mBADa,EAEb,mBAFa,EAGb,mBAHa,CAhEI;mBAqEF,CACf,wBADe,EAEf,yBAFe,EAGf,4BAHe,EAIf,2BAJe,CArEE;kBA2EH,CACd,qBADc,EAEd,oBAFc,EAGd,oBAHc,EAId,qBAJc,EAKd,qBALc,CA3EG;;QAoFb,CACJ,YADI,EAEJ,wBAFI,EAGJ,yBAHI,EAIJ,mBAJI,EAKJ,sBALI,EAMJ,yBANI,EAOJ,cAPI,EAQJ,aARI,EASJ,cATI,EAUJ,WAVI,EAWJ,aAXI,EAYJ,aAZI,CApFa;kBAkGH,CACd,wBADc,EAEd,yBAFc,EAGd,mBAHc,EAId,sBAJc,EAKd,yBALc,CAlGG;;QA2Gb,CAAC,WAAD,EAAc,aAAd,EAA6B,YAA7B,CA3Ga;eA4GN,CAAC,gBAAD,EAAmB,WAAnB,CA5GM;;QA+Gb,CACJ,oBADI,EAEJ,uBAFI,EAGJ,qBAHI,EAIJ,gBAJI,EAKJ,mBALI,EAMJ,gBANI,CA/Ga;mBAuHF,CACf,oBADe,EAEf,uBAFe,EAGf,qBAHe,CAvHE;cA4HP,CAAC,gBAAD,EAAmB,cAAnB,CA5HO;iBA6HJ,CAAC,mBAAD,EAAsB,iBAAtB,CA7HI;eA8HN,CACX,gBADW,EAEX,mBAFW,EAGX,cAHW,EAIX,iBAJW,CA9HM;cAoIP,CAAC,cAAD,EAAiB,iBAAjB,CApIO;;QAuIb,CACJ,YADI,EAEJ,WAFI,EAGJ,eAHI,EAIJ,WAJI,EAKJ,aALI,EAMJ,aANI,EAOJ,WAPI,CAvIa;iBAgJJ,CACb,oBADa,EAEb,mBAFa,EAGb,mBAHa,EAIb,oBAJa,EAKb,oBALa,EAMb,kBANa,CAhJI;;WA0JV,CAAC,cAAD,EAAiB,cAAjB,CA1JU;iBA2JJ,CACb,mBADa,EAEb,mBAFa,EAGb,mBAHa,CA3JI;;oBAkKD,CAChB,oBADgB,EAEhB,sBAFgB,EAGhB,uBAHgB,EAIhB,qBAJgB,CAlKC;0BAwKK,CACtB,4BADsB,EAEtB,0BAFsB,CAxKL;2BA4KM,CACvB,6BADuB,EAEvB,2BAFuB,CA5KN;wBAgLG,CACpB,wBADoB,EAEpB,0BAFoB,EAGpB,2BAHoB,EAIpB,yBAJoB,CAhLH;8BAsLS,CAC1B,gCAD0B,EAE1B,8BAF0B,CAtLT;+BA0LU,CAC3B,iCAD2B,EAE3B,+BAF2B,CA1LV;;OAgMd,CAAC,YAAD,EAAe,WAAf,CAhMc;SAiMZ,CAAC,cAAD,EAAiB,aAAjB,CAjMY;QAkMb,CAAC,aAAD,EAAgB,YAAhB,CAlMa;;qBAqMA,CACjB,sBADiB,EAEjB,uBAFiB,EAGjB,uBAHiB,CArMA;mBA0MF,CAAC,qBAAD,EAAwB,qBAAxB,CA1ME;;aA6MR,CACT,gBADS,EAET,oBAFS,EAGT,2BAHS,EAIT,iBAJS,EAKT,2BALS,EAMT,qBANS,EAOT,qBAPS,EAQT,sBARS,CA7MQ;;cAyNP,CACV,qBADU,EAEV,qBAFU,EAGV,4BAHU,EAIV,kBAJU;CAzNd;AAiOA,AAAO,SAASC,mBAAT,CAA6BC,KAA7B,EAA4C;QAC3CC,uBAAuBC,OAAOC,IAAP,CAAYH,KAAZ,EAAmBI,MAAnB,CAA0B,CAACC,GAAD,EAAMC,QAAN,KAAmB;QACpEC,mBAAUD,QAAV,CAAJ,IAA2BA,QAA3B;WACOD,GAAP;GAF2B,EAG1B,EAH0B,CAA7B;QAKMG,QAAQ,EAAd;;OACK,MAAMF,QAAX,IAAuBL,oBAAvB,EAA6C;QACvCK,YAAYR,YAAhB,EAA8B;WACvB,MAAMW,QAAX,IAAuBX,aAAaQ,QAAb,CAAvB,EAA+C;YACzCG,YAAYR,oBAAhB,EAAsC;gBAC9BS,OAAOT,qBAAqBQ,QAArB,CAAb;gBACME,QAAQV,qBAAqBK,QAArB,CAAd;gBACMM,IAAN,CAAW;uBACE;wBAAWD,KAAX;qBAAyBX,MAAMW,KAAN;aAD3B;sBAEC;wBAAWD,IAAX;qBAAwBV,MAAMU,IAAN;;WAFpC;;;;;;SAQDF,KAAP;;;AClPa,SAASK,mBAAT,CACbC,UADa,EAEbC,MAFa,EAGbC,KAHa,EAIbC,MAJa,EAKb;QACM9B,QAAQ2B,WAAWI,QAAX,CAAoBF,KAApB,CAAd;MACIG,cAAc,EAAlB;;OACK,MAAMC,WAAX,IAA0BL,MAA1B,EAAkC;UAC1BM,cAAcN,OAAOK,WAAP,CAApB;;QAEI,OAAOC,WAAP,KAAuB,QAA3B,EAAqC;;iDAEtB;0BACOA,WAAlB;;;YAGIC,cAAe,GAAEf,mBACrBa,WADqB,CAErB,IAAKC,WAA2B,EAFlC;YAGMnC,MAAO,GAAE+B,MAAO,GAAEK,WAAY,EAApC;YACMC,WAAWpC,MAAMA,KAAN,CAAYD,GAAZ,CAAjB;;UACIqC,aAAa,KAAK,CAAtB,EAAyB;;uBAER,MAAMA,QAArB;;OAFF,MAIO;;YAEDC,QAAQ,EAAZ;cACMC,WAAWC,UAAU;WAAEN,WAAD,GAAeC;SAA1B,CAAjB;;aACK,MAAMM,WAAX,IAA0BF,QAA1B,EAAoC;gBAC5BG,cAAcH,SAASE,WAAT,CAApB;gBACME,kBAAkB,OAAOD,WAA/B;;cACIC,oBAAoB,QAApB,IAAgCA,oBAAoB,QAAxD,EAAkE;kBAC1DC,eAAgB,GAAEvB,mBAAUoB,WAAV,CAAuB,IAAGC,WAAY,EAA9D;;gBACIE,iBAAiBR,WAArB,EAAkC;uBACtB,GAAEQ,YAAa,GAAzB;;WAHJ,MAKO,IAAIC,MAAMC,OAAN,CAAcJ,WAAd,CAAJ,EAAgC;kBAC/BK,aAAa1B,mBAAUoB,WAAV,CAAnB;;iBACK,IAAIO,IAAI,CAAb,EAAgBA,IAAIN,YAAYO,MAAhC,EAAwCD,GAAxC,EAA6C;oBACrCJ,eAAgB,GAAEG,UAAW,IAAGL,YAAYM,CAAZ,CAAe,EAArD;;kBACIJ,iBAAiBR,WAArB,EAAkC;yBACtB,GAAEQ,YAAa,GAAzB;;;;;;iBAKCR,WAAT,CAtBK;;cAuBC9C,KAAKW,MAAMiD,QAAN,CAAelD,GAAf,EAAoB;gBAAA;;SAApB,CAAX;uBACe,MAAMV,EAArB;;KAvCJ,MAyCO;;UAED4C,YAAY,CAAZ,MAAmB,GAAvB,EAA4B;uBAExB,MACAP,oBACEC,UADF,EAEEO,WAFF,EAGEL,KAHF,EAIEC,SAASG,WAJX,CAFF;OADF,MASO,IAAIA,YAAYiB,SAAZ,CAAsB,CAAtB,EAAyB,CAAzB,MAAgC,QAApC,EAA8C;uBAEjD,MACAxB,oBACEC,UADF,EAEEO,WAFF,EAGED,YAAYkB,MAAZ,CAAmB,CAAnB,CAHF,EAIErB,MAJF,CAFF;;;;;6CAYO;UACLsB,YAAYxC,oBAAoBgB,MAApB,CAAlB;;QACIwB,UAAUJ,MAAd,EAAsB;gBACVK,OAAV,CAAkB,CAAC;iBAAA;;OAAD,KAA2B;cACrC7B,QAAQ8B,KAAKC,SAAL,CAAe;WAAEC,UAAUrC,QAAX,GAAsBqC,UAAUtD;SAAhD,CAAd;cACMqB,OAAO+B,KAAKC,SAAL,CAAe;WAAEjC,SAASH,QAAV,GAAqBG,SAASpB;SAA9C,CAAb,CAF2C;;gBAInCuD,IAAR,CACG,YAAWjC,KAAM,YAAWD,IAAK,gCAA+BS,YAAY0B,KAAZ,CAC/D,CAD+D,CAE/D,kJAHJ;OAJF;;GA1EJ;;;SAwFO1B,YAAY0B,KAAZ,CAAkB,CAAlB,CAAP;;;AAGF,SAASC,iBAAT,CAA2BzD,KAA3B,EAAkC;MAE9BA,UAAU,IAAV,IACA0C,MAAMC,OAAN,CAAc3C,KAAd,CADA,IAEC,OAAOA,KAAP,KAAiB,QAAjB,IAA6B,OAAOA,KAAP,KAAiB,QAHjD,EAIE;UACM,IAAI0D,KAAJ,CAAW,4BAA2BN,KAAKC,SAAL,CAAerD,KAAf,CAAsB,EAA5D,CAAN;;;;AClHJ;AAEA,AAEO,SAAS2D,cAAT,CAAwBxE,EAAxB,EAAoCyC,MAApC,EAA4D;MAC7DgC,WAAY,IAAGzE,EAAG,EAAtB;;MACIyC,MAAJ,EAAY;gBACEA,MAAZ;;;SAEKgC,QAAP;;AAGF,AAAO,SAASC,gBAAT,CAA0BC,SAA1B,EAAqD;MACtDC,SAAS,EAAb;;OACK,MAAMC,KAAX,IAAoBF,SAApB,EAA+B;cAClB,GAAEE,KAAM,IAAGC,oBAAoBH,UAAUE,KAAV,CAApB,CAAsC,GAA5D;;;SAEKD,MAAP;;AAGF,AAAO,SAASE,mBAAT,CAA6BtD,KAA7B,EAAoD;MACrDuD,MAAM,EAAV;;OACK,MAAM5D,IAAX,IAAmBK,KAAnB,EAA0B;UAClBwD,MAAMxD,MAAML,IAAN,CAAZ;;QACI,OAAO6D,GAAP,KAAe,QAAf,IAA2B,OAAOA,GAAP,KAAe,QAA9C,EAAwD;aAC9C,GAAEjD,mBAAUZ,IAAV,CAAgB,IAAG6D,GAAI,GAAjC;;GALqD;;;SASlDD,IAAIV,KAAJ,CAAU,CAAV,EAAa,CAAC,CAAd,CAAP;;AAGF,AAAO,SAASY,oBAAT,CAA8BjF,EAA9B,EAA0CgD,KAA1C,EAAiE;SAC9D,cAAahD,EAAG,IAAGgD,KAAM,GAAjC;;AAGF,AAAO,SAASkC,mBAAT,CAA6BlF,EAA7B,EAAyCgD,KAAzC,EAAgE;SAC7D,0BAAyBhD,EAAG,IAAGgD,KAAM,GAA7C;;AAGF,AAAO,SAASmC,gBAAT,CAA0BV,QAA1B,EAA4CzB,KAA5C,EAAmE;SAChE,GAAEyB,QAAS,IAAGzB,KAAM,GAA5B;;;ACzCF;AAEA,MAAMoC,kBAAkB,2CAAxB;AACA,MAAMC,qBAAqB,8CAA3B;AACA,MAAMC,qBAAqB,4CAA3B;;AAOA,SAASC,aAAT,CAA0B5E,KAA1B,EAA2C6E,QAA3C,EAAgET,GAAhE,EAA6E;MACvEU,KAAJ;;SACQA,QAAQD,SAASE,IAAT,CAAcX,GAAd,CAAhB,EAAqC;UAC7B,GAAG/E,EAAH,EAAOyC,MAAP,EAAe/B,GAAf,IAAsB+E,KAA5B;UACME,UAAUlD,SAAU,GAAEA,MAAO,GAAE/B,GAAI,EAAzB,GAA6BA,GAA7C;UACMC,KAAN,CAAYgF,OAAZ,IAAuB3F,EAAvB,CAHmC;;UAI7BM,WAAN,CAAkBL,SAAlB,GAJmC;;;;AAQvC,SAAS2F,OAAT,CAAoBjF,KAApB,EAAqC6E,QAArC,EAA0DT,GAA1D,EAAuE;MACjEU,KAAJ;;SACQA,QAAQD,SAASE,IAAT,CAAcX,GAAd,CAAhB,EAAqC;UAC7B,GAAG/E,EAAH,EAAOU,GAAP,IAAc+E,KAApB;UACM9E,KAAN,CAAYD,GAAZ,IAAmBV,EAAnB,CAFmC;;UAG7BM,WAAN,CAAkBL,SAAlB,GAHmC;;;;AAOvC,AAiCA,MAAM4F,eAAN,CAAgD;cAUlCC,OAAkB,EAA9B,EAAkC;SAC3BC,aAAL,GAAqB,EAArB;UAEMC,mBAAmB,IAAItG,qBAAJ,CAA0BoG,KAAKnG,MAA/B,CAAzB;;UACMsG,aAAa,CAACtF,KAAD,EAAQX,EAAR,EAAYa,KAAZ,KAAsB;YACjC;cAAA;;UAAkBA,KAAxB;YACMqF,QAAwB,KAAKH,aAAL,CAAmBpF,MAAMD,GAAzB,EAA8BwF,KAA5D;YACMC,UAAN,CACEhB,iBAAiBX,eAAexE,EAAf,EAAmByC,MAAnB,CAAjB,EAA6CO,KAA7C,CADF,EAEEkD,MAAME,QAAN,CAAezC,MAFjB;KAHF,CAJgC;;;SAc3BrB,UAAL,GAAkB,IAAIjC,UAAJ,CAChB2F,gBADgB,EAEhBxD,SAAS;YACD6D,eAAeC,SAASC,aAAT,CAAuB,OAAvB,CAArB;mBACa/D,KAAb,GAAqBA,KAArB;WACKgE,SAAL,CAAeC,WAAf,CAA2BJ,YAA3B;WACKN,aAAL,CAAmBvD,KAAnB,IAA4B6D,YAA5B;KANc,EAQhBJ,UARgB,CAAlB;SAWKS,cAAL,GAAsB,IAAI9F,KAAJ,CACpB,IAAIlB,qBAAJ,CAA0BoG,KAAKnG,MAA/B,CADoB,EAEpB,CAACgB,KAAD,EAAQX,EAAR,EAAYa,KAAZ,KAAsB;WACfyB,UAAL,CAAgBI,QAAhB,CAAyB,EAAzB;YACMwD,QAAwB,KAAKH,aAAL,CAAmB,EAAnB,EAAuBG,KAArD;YACMC,UAAN,CACElB,qBAAqBjF,EAArB,EAAyB0E,iBAAiB7D,KAAjB,CAAzB,CADF,EAEEqF,MAAME,QAAN,CAAezC,MAFjB;KALkB,CAAtB;SAYKgD,aAAL,GAAqB,IAAI/F,KAAJ,CACnB,IAAIlB,qBAAJ,CAA0BoG,KAAKnG,MAA/B,CADmB,EAEnB,CAACgB,KAAD,EAAQX,EAAR,EAAYa,KAAZ,KAAsB;WACfyB,UAAL,CAAgBI,QAAhB,CAAyB,EAAzB;YACMwD,QAAwB,KAAKH,aAAL,CAAmB,EAAnB,EAAuBG,KAArD;YACMC,UAAN,CACEjB,oBAAoBlF,EAApB,EAAwB8E,oBAAoBjE,KAApB,CAAxB,CADF,EAEEqF,MAAME,QAAN,CAAezC,MAFjB;KALiB,CAArB;;QAYImC,KAAKU,SAAT,EAAoB;WACbA,SAAL,GAAiBV,KAAKU,SAAtB;KAlD8B;;;QAsD5BV,KAAKF,OAAL,IAAgBE,KAAKF,OAAL,CAAajC,MAAb,GAAsB,CAA1C,EAA6C;;UAEvC,CAAC,KAAK6C,SAAV,EAAqB;cACbI,gBAAgBd,KAAKF,OAAL,CAAa,CAAb,EAAgBgB,aAAtC;;YACIA,kBAAkB,IAAlB,IAA0BA,kBAAkB,KAAK,CAArD,EAAwD;eACjDJ,SAAL,GAAiBI,aAAjB;;;;WAIC,IAAIlD,IAAI,CAAb,EAAgBA,IAAIoC,KAAKF,OAAL,CAAajC,MAAjC,EAAyCD,GAAzC,EAA8C;cACtCmD,UAAUf,KAAKF,OAAL,CAAalC,CAAb,CAAhB;cACMoD,cAAcD,QAAQE,OAAR,CAAgBnB,OAApC;;YACIkB,gBAAgB,WAApB,EAAiC;kBACvB,KAAKH,aAAb,EAA4BrB,kBAA5B,EAAgDuB,QAAQG,WAAxD;;;;YAGEF,gBAAgB,WAApB,EAAiC;kBACvB,KAAKJ,cAAb,EAA6BrB,kBAA7B,EAAiDwB,QAAQG,WAAzD;;;;cAGItG,MAAMmG,QAAQrE,KAAR,GAAgBqE,QAAQrE,KAAxB,GAAgC,EAA5C;aACKuD,aAAL,CAAmBrF,GAAnB,IAA0BmG,OAA1B;cACMlG,QAAQ,IAAIC,KAAJ,CAAUoF,gBAAV,EAA4BC,UAA5B,CAAd;cACMvF,GAAN,GAAYA,GAAZ;sBACcC,KAAd,EAAqByE,eAArB,EAAsCyB,QAAQG,WAA9C;aACK1E,UAAL,CAAgB7B,MAAhB,CAAuBC,GAAvB,IAA8BC,KAA9B;;;;QAIA,CAAC,KAAK6F,SAAV,EAAqB;UACfF,SAASW,IAAT,KAAkB,IAAtB,EAA4B;cACpB,IAAI1C,KAAJ,CAAU,oDAAV,CAAN;;;WAEGiC,SAAL,GAAiBF,SAASW,IAA1B;;;;cAIQzF,KAAZ,EAAuC;WAC9Ba,oBAAoB,KAAKC,UAAzB,EAAqCd,KAArC,EAA4C,EAA5C,EAAgD,EAAhD,CAAP;;;iBAGa0F,QAAf,EAA4C;UACpCxG,MAAMoE,oBAAoBoC,QAApB,CAAZ;WACO,KAAKP,aAAL,CAAmB/C,QAAnB,CAA4BlD,GAA5B,EAAiCwG,QAAjC,CAAP;;;kBAGcvC,SAAhB,EAA+C;UACvCjE,MAAMgE,iBAAiBC,SAAjB,CAAZ;WACO,KAAK+B,cAAL,CAAoB9C,QAApB,CAA6BlD,GAA7B,EAAkCiE,SAAlC,CAAP;;;;;;;AC7KJ,AA4BA,MAAMwC,eAAN,CAAgD;cAQlCrB,OAAkB,EAA9B,EAAkC;SAC3BsB,UAAL,GAAkB;UAAK;KAAvB;SACK9E,UAAL,GAAkB,IAAIjC,UAAJ,CAChB,IAAIX,qBAAJ,CAA0BoG,KAAKnG,MAA/B,CADgB,EAEhB6C,SAAS;WACF4E,UAAL,CAAgB5E,KAAhB,IAAyB,EAAzB;KAHc,EAKhB,CAAC7B,KAAD,EAAQX,EAAR,EAAYa,KAAZ,KAAsB;YACd;cAAA;;UAAkBA,KAAxB;WACKuG,UAAL,CAAgBzG,MAAMD,GAAtB,KAA8ByE,iBAC5BX,eAAexE,EAAf,EAAmByC,MAAnB,CAD4B,EAE5BO,KAF4B,CAA9B;KAPc,CAAlB;SAcKqE,aAAL,GAAqB,EAArB;SACKV,aAAL,GAAqB,IAAI/F,KAAJ,CACnB,IAAIlB,qBAAJ,CAA0BoG,KAAKnG,MAA/B,CADmB,EAEnB,CAACgB,KAAD,EAAQX,EAAR,EAAYa,KAAZ,KAAsB;WACfwG,aAAL,IAAsBnC,oBACpBlF,EADoB,EAEpB8E,oBAAoBjE,KAApB,CAFoB,CAAtB;KAHiB,CAArB;SAUKyG,cAAL,GAAsB,EAAtB;SACKZ,cAAL,GAAsB,IAAI9F,KAAJ,CACpB,IAAIlB,qBAAJ,CAA0BoG,KAAKnG,MAA/B,CADoB,EAEpB,CAACgB,KAAD,EAAQX,EAAR,EAAYa,KAAZ,KAAsB;WACfyG,cAAL,IAAuBrC,qBACrBjF,EADqB,EAErB0E,iBAAiB7D,KAAjB,CAFqB,CAAvB;KAHkB,CAAtB;;;cAWUW,KAAZ,EAAuC;WAC9Ba,oBAAoB,KAAKC,UAAzB,EAAqCd,KAArC,EAA4C,EAA5C,EAAgD,EAAhD,CAAP;;;iBAGa0F,QAAf,EAA4C;UACpCxG,MAAMuD,KAAKC,SAAL,CAAegD,QAAf,CAAZ;WACO,KAAKP,aAAL,CAAmB/C,QAAnB,CAA4BlD,GAA5B,EAAiCwG,QAAjC,CAAP;;;kBAGcvC,SAAhB,EAA+C;UACvCjE,MAAMuD,KAAKC,SAAL,CAAeS,SAAf,CAAZ;WACO,KAAK+B,cAAL,CAAoB9C,QAApB,CAA6BlD,GAA7B,EAAkCiE,SAAlC,CAAP;;;mBAG8B;WACvB,CACL,IAAI,KAAK0C,aAAL,CAAmB1D,MAAnB,GACA,CACE;WACO,KAAK0D,aADZ;aAES;wBAAiB;;KAH5B,CADA,GAOA,EAPJ,CADK,EASL,GAAGE,SAAS,KAAKH,UAAd,CATE,EAUL,IAAI,KAAKE,cAAL,CAAoB3D,MAApB,GACA,CACE;WACO,KAAK2D,cADZ;aAES;wBAAiB;;KAH5B,CADA,GAOA,EAPJ,CAVK,CAAP;;;qBAqBiBE,YAAqB,qBAAxC,EAA+D;WACtDC,mBAAmB,KAAKC,cAAL,EAAnB,EAA0CF,SAA1C,CAAP;;;WAGO;WAEL,KAAKH,aAAL,GAAqBnD,UAAU,KAAKkD,UAAf,CAArB,GAAkD,KAAKE,cADzD;;;;;AAMJ,AAAO,SAASG,kBAAT,CAA4BE,MAA5B,EAAmDH,SAAnD,EAAsE;MACvEI,OAAO,EAAX;;OACK,IAAIlE,IAAI,CAAb,EAAgBA,IAAIiE,OAAOhE,MAA3B,EAAmCD,GAAnC,EAAwC;UAChCwC,QAAQyB,OAAOjE,CAAP,CAAd;;yBAC4CwC,MAAM2B,KAAlD;UAAM;aAAQC;KAAd;UAAoCC,IAApC;;UACMF;aACGC,oBACF,GAAEN,SAAU,IAAGM,iBAAkB,EAD/B,GAEHN;OACDO,IAJC,CAAN;YAMS,SAAQC,cAAcH,KAAd,CAAqB,IAAG3B,MAAMnB,GAAI,UAAnD;;;SAEK6C,IAAP;;;AAGF,SAASI,aAAT,CAAuBH,KAAvB,EAA8B;MACxBjD,SAAS,EAAb;;OACK,MAAMqD,IAAX,IAAmBJ,KAAnB,EAA0B;UAClBhH,QAAQgH,MAAMI,IAAN,CAAd;;QACIpH,UAAU,IAAd,EAAoB;gBACR,MAAMoH,IAAhB;KADF,MAEO,IAAIpH,UAAU,KAAd,EAAqB;gBACf,IAAGoH,IAAK,KAAIpH,KAAM,GAA7B;;;;SAGG+D,MAAP;;;AAGF,SAASV,SAAT,CAAmBkD,UAAnB,EAA+B;MACzBxC,SAAS,EAAb;;OACK,MAAMpC,KAAX,IAAoB4E,UAApB,EAAgC;UACxBc,QAAQd,WAAW5E,KAAX,CAAd;;QACIA,KAAJ,EAAW;gBACE,UAASA,KAAM,IAAG0F,KAAM,GAAnC;KADF,MAEO;gBACKA,KAAV;;;;SAGGtD,MAAP;;;AAGF,SAAS2C,QAAT,CAAkBH,UAAlB,EAA8B;QACtBO,SAAS,EAAf;;OACK,MAAMnF,KAAX,IAAoB4E,UAApB,EAAgC;;UAExBS,QAAQrF,QAAQ;;KAAR,GAAkB,EAAhC;WACOJ,IAAP,CAAY;WAAMgF,WAAW5E,KAAX,CAAN;;KAAZ;;;SAEKmF,MAAP;;;;;"}