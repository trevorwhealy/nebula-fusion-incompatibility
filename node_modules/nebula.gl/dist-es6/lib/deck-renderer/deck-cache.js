"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var DeckCache = function () {
  function DeckCache(getData, convert) {
    _classCallCheck(this, DeckCache);

    this.objects = [];
    this.originals = [];
    this.updateTrigger = 0;

    this._idToPosition = new Map();
    this._getData = getData;
    this._convert = convert;
  }

  _createClass(DeckCache, [{
    key: "updateAllDeckObjects",
    value: function updateAllDeckObjects() {
      var _this = this;

      if (!this._getData || !this._convert) return;

      this.originals.length = 0;
      this.objects.length = 0;
      this._idToPosition.clear();

      this._getData().forEach(function (d) {
        _this._idToPosition.set(d.id, _this.objects.length);
        _this.originals.push(d);
        _this.objects.push(_this._convert(d));
      });

      this.triggerUpdate();
    }
  }, {
    key: "updateDeckObjectsByIds",
    value: function updateDeckObjectsByIds(ids) {
      var _this2 = this;

      if (!this._getData || !this._convert) return;

      ids.forEach(function (id) {
        var p = _this2._idToPosition.get(id);
        if (p !== undefined) {
          _this2.objects[p] = _this2._convert(_this2.originals[p]);
        }
      });

      this.triggerUpdate();
    }
  }, {
    key: "triggerUpdate",
    value: function triggerUpdate() {
      this.updateTrigger++;
    }
  }, {
    key: "getDeckObjectById",
    value: function getDeckObjectById(id) {
      var p = this._idToPosition.get(id);
      return p !== undefined ? this.objects[p] : null;
    }
  }, {
    key: "getOriginalById",
    value: function getOriginalById(id) {
      var p = this._idToPosition.get(id);
      return p !== undefined ? this.originals[p] : null;
    }
  }]);

  return DeckCache;
}();

exports.default = DeckCache;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9saWIvZGVjay1yZW5kZXJlci9kZWNrLWNhY2hlLmpzIl0sIm5hbWVzIjpbIkRlY2tDYWNoZSIsImdldERhdGEiLCJjb252ZXJ0Iiwib2JqZWN0cyIsIm9yaWdpbmFscyIsInVwZGF0ZVRyaWdnZXIiLCJfaWRUb1Bvc2l0aW9uIiwiTWFwIiwiX2dldERhdGEiLCJfY29udmVydCIsImxlbmd0aCIsImNsZWFyIiwiZm9yRWFjaCIsInNldCIsImQiLCJpZCIsInB1c2giLCJ0cmlnZ2VyVXBkYXRlIiwiaWRzIiwicCIsImdldCIsInVuZGVmaW5lZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztJQUVxQkEsUztBQVFuQixxQkFBWUMsT0FBWixFQUFvQ0MsT0FBcEMsRUFBNkQ7QUFBQTs7QUFDM0QsU0FBS0MsT0FBTCxHQUFlLEVBQWY7QUFDQSxTQUFLQyxTQUFMLEdBQWlCLEVBQWpCO0FBQ0EsU0FBS0MsYUFBTCxHQUFxQixDQUFyQjs7QUFFQSxTQUFLQyxhQUFMLEdBQXFCLElBQUlDLEdBQUosRUFBckI7QUFDQSxTQUFLQyxRQUFMLEdBQWdCUCxPQUFoQjtBQUNBLFNBQUtRLFFBQUwsR0FBZ0JQLE9BQWhCO0FBQ0Q7Ozs7MkNBRXNCO0FBQUE7O0FBQ3JCLFVBQUksQ0FBQyxLQUFLTSxRQUFOLElBQWtCLENBQUMsS0FBS0MsUUFBNUIsRUFBc0M7O0FBRXRDLFdBQUtMLFNBQUwsQ0FBZU0sTUFBZixHQUF3QixDQUF4QjtBQUNBLFdBQUtQLE9BQUwsQ0FBYU8sTUFBYixHQUFzQixDQUF0QjtBQUNBLFdBQUtKLGFBQUwsQ0FBbUJLLEtBQW5COztBQUVBLFdBQUtILFFBQUwsR0FBZ0JJLE9BQWhCLENBQXdCLGFBQUs7QUFDM0IsY0FBS04sYUFBTCxDQUFtQk8sR0FBbkIsQ0FBd0JDLENBQUQsQ0FBU0MsRUFBaEMsRUFBb0MsTUFBS1osT0FBTCxDQUFhTyxNQUFqRDtBQUNBLGNBQUtOLFNBQUwsQ0FBZVksSUFBZixDQUFvQkYsQ0FBcEI7QUFDQSxjQUFLWCxPQUFMLENBQWFhLElBQWIsQ0FBa0IsTUFBS1AsUUFBTCxDQUFjSyxDQUFkLENBQWxCO0FBQ0QsT0FKRDs7QUFNQSxXQUFLRyxhQUFMO0FBQ0Q7OzsyQ0FFc0JDLEcsRUFBZTtBQUFBOztBQUNwQyxVQUFJLENBQUMsS0FBS1YsUUFBTixJQUFrQixDQUFDLEtBQUtDLFFBQTVCLEVBQXNDOztBQUV0Q1MsVUFBSU4sT0FBSixDQUFZLGNBQU07QUFDaEIsWUFBTU8sSUFBSSxPQUFLYixhQUFMLENBQW1CYyxHQUFuQixDQUF1QkwsRUFBdkIsQ0FBVjtBQUNBLFlBQUlJLE1BQU1FLFNBQVYsRUFBcUI7QUFDbkIsaUJBQUtsQixPQUFMLENBQWFnQixDQUFiLElBQWtCLE9BQUtWLFFBQUwsQ0FBYyxPQUFLTCxTQUFMLENBQWVlLENBQWYsQ0FBZCxDQUFsQjtBQUNEO0FBQ0YsT0FMRDs7QUFPQSxXQUFLRixhQUFMO0FBQ0Q7OztvQ0FFZTtBQUNkLFdBQUtaLGFBQUw7QUFDRDs7O3NDQUVpQlUsRSxFQUFvQjtBQUNwQyxVQUFNSSxJQUFJLEtBQUtiLGFBQUwsQ0FBbUJjLEdBQW5CLENBQXVCTCxFQUF2QixDQUFWO0FBQ0EsYUFBT0ksTUFBTUUsU0FBTixHQUFrQixLQUFLbEIsT0FBTCxDQUFhZ0IsQ0FBYixDQUFsQixHQUFvQyxJQUEzQztBQUNEOzs7b0NBRWVKLEUsRUFBb0I7QUFDbEMsVUFBTUksSUFBSSxLQUFLYixhQUFMLENBQW1CYyxHQUFuQixDQUF1QkwsRUFBdkIsQ0FBVjtBQUNBLGFBQU9JLE1BQU1FLFNBQU4sR0FBa0IsS0FBS2pCLFNBQUwsQ0FBZWUsQ0FBZixDQUFsQixHQUFzQyxJQUE3QztBQUNEOzs7Ozs7a0JBM0RrQm5CLFMiLCJmaWxlIjoiZGVjay1jYWNoZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEBmbG93XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIERlY2tDYWNoZTxUT1JJRywgVENPTlY+IHtcbiAgb2JqZWN0czogVENPTlZbXTtcbiAgb3JpZ2luYWxzOiBUT1JJR1tdO1xuICB1cGRhdGVUcmlnZ2VyOiBudW1iZXI7XG4gIF9pZFRvUG9zaXRpb246IE1hcDxzdHJpbmcsIG51bWJlcj47XG4gIF9nZXREYXRhOiAoKSA9PiBUT1JJR1tdO1xuICBfY29udmVydDogVE9SSUcgPT4gVENPTlY7XG5cbiAgY29uc3RydWN0b3IoZ2V0RGF0YTogKCkgPT4gVE9SSUdbXSwgY29udmVydDogVE9SSUcgPT4gVENPTlYpIHtcbiAgICB0aGlzLm9iamVjdHMgPSBbXTtcbiAgICB0aGlzLm9yaWdpbmFscyA9IFtdO1xuICAgIHRoaXMudXBkYXRlVHJpZ2dlciA9IDA7XG5cbiAgICB0aGlzLl9pZFRvUG9zaXRpb24gPSBuZXcgTWFwKCk7XG4gICAgdGhpcy5fZ2V0RGF0YSA9IGdldERhdGE7XG4gICAgdGhpcy5fY29udmVydCA9IGNvbnZlcnQ7XG4gIH1cblxuICB1cGRhdGVBbGxEZWNrT2JqZWN0cygpIHtcbiAgICBpZiAoIXRoaXMuX2dldERhdGEgfHwgIXRoaXMuX2NvbnZlcnQpIHJldHVybjtcblxuICAgIHRoaXMub3JpZ2luYWxzLmxlbmd0aCA9IDA7XG4gICAgdGhpcy5vYmplY3RzLmxlbmd0aCA9IDA7XG4gICAgdGhpcy5faWRUb1Bvc2l0aW9uLmNsZWFyKCk7XG5cbiAgICB0aGlzLl9nZXREYXRhKCkuZm9yRWFjaChkID0+IHtcbiAgICAgIHRoaXMuX2lkVG9Qb3NpdGlvbi5zZXQoKGQ6IGFueSkuaWQsIHRoaXMub2JqZWN0cy5sZW5ndGgpO1xuICAgICAgdGhpcy5vcmlnaW5hbHMucHVzaChkKTtcbiAgICAgIHRoaXMub2JqZWN0cy5wdXNoKHRoaXMuX2NvbnZlcnQoZCkpO1xuICAgIH0pO1xuXG4gICAgdGhpcy50cmlnZ2VyVXBkYXRlKCk7XG4gIH1cblxuICB1cGRhdGVEZWNrT2JqZWN0c0J5SWRzKGlkczogc3RyaW5nW10pIHtcbiAgICBpZiAoIXRoaXMuX2dldERhdGEgfHwgIXRoaXMuX2NvbnZlcnQpIHJldHVybjtcblxuICAgIGlkcy5mb3JFYWNoKGlkID0+IHtcbiAgICAgIGNvbnN0IHAgPSB0aGlzLl9pZFRvUG9zaXRpb24uZ2V0KGlkKTtcbiAgICAgIGlmIChwICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5vYmplY3RzW3BdID0gdGhpcy5fY29udmVydCh0aGlzLm9yaWdpbmFsc1twXSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLnRyaWdnZXJVcGRhdGUoKTtcbiAgfVxuXG4gIHRyaWdnZXJVcGRhdGUoKSB7XG4gICAgdGhpcy51cGRhdGVUcmlnZ2VyKys7XG4gIH1cblxuICBnZXREZWNrT2JqZWN0QnlJZChpZDogc3RyaW5nKTogP1RDT05WIHtcbiAgICBjb25zdCBwID0gdGhpcy5faWRUb1Bvc2l0aW9uLmdldChpZCk7XG4gICAgcmV0dXJuIHAgIT09IHVuZGVmaW5lZCA/IHRoaXMub2JqZWN0c1twXSA6IG51bGw7XG4gIH1cblxuICBnZXRPcmlnaW5hbEJ5SWQoaWQ6IHN0cmluZyk6ID9UT1JJRyB7XG4gICAgY29uc3QgcCA9IHRoaXMuX2lkVG9Qb3NpdGlvbi5nZXQoaWQpO1xuICAgIHJldHVybiBwICE9PSB1bmRlZmluZWQgPyB0aGlzLm9yaWdpbmFsc1twXSA6IG51bGw7XG4gIH1cbn1cbiJdfQ==