'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

var _deck = require('deck.gl');

var _bboxPolygon = require('@turf/bbox-polygon');

var _bboxPolygon2 = _interopRequireDefault(_bboxPolygon);

var _circle = require('@turf/circle');

var _circle2 = _interopRequireDefault(_circle);

var _distance = require('@turf/distance');

var _distance2 = _interopRequireDefault(_distance);

var _editableFeatureCollection = require('../editable-feature-collection');

var _editableLayer = require('./editable-layer');

var _editableLayer2 = _interopRequireDefault(_editableLayer);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }
/* eslint-env browser */

var DEFAULT_LINE_COLOR = [0x0, 0x0, 0x0, 0xff];
var DEFAULT_FILL_COLOR = [0x0, 0x0, 0x0, 0x90];
var DEFAULT_SELECTED_LINE_COLOR = [0x90, 0x90, 0x90, 0xff];
var DEFAULT_SELECTED_FILL_COLOR = [0x90, 0x90, 0x90, 0x90];
var DEFAULT_EDITING_EXISTING_POINT_COLOR = [0xc0, 0x0, 0x0, 0xff];
var DEFAULT_EDITING_INTERMEDIATE_POINT_COLOR = [0x0, 0x0, 0x0, 0x80];

var defaultProps = {
  mode: 'modify',

  // Edit and interaction events
  onEdit: function onEdit() {},

  pickable: true,
  fp64: false,
  filled: true,
  stroked: true,
  lineWidthScale: 1,
  lineWidthMinPixels: 1,
  lineWidthMaxPixels: Number.MAX_SAFE_INTEGER,
  lineJointRounded: false,
  lineMiterLimit: 4,
  pointRadiusScale: 1,
  pointRadiusMinPixels: 2,
  pointRadiusMaxPixels: Number.MAX_SAFE_INTEGER,
  lineDashJustified: false,
  getLineColor: function getLineColor(feature, isSelected, mode) {
    return isSelected ? DEFAULT_SELECTED_LINE_COLOR : DEFAULT_LINE_COLOR;
  },
  getFillColor: function getFillColor(feature, isSelected, mode) {
    return isSelected ? DEFAULT_SELECTED_FILL_COLOR : DEFAULT_FILL_COLOR;
  },
  getRadius: function getRadius(f) {
    return f && f.properties && f.properties.radius || f && f.properties && f.properties.size || 1;
  },
  getLineWidth: function getLineWidth(f) {
    return f && f.properties && f.properties.lineWidth || 1;
  },
  getLineDashArray: function getLineDashArray(feature, isSelected, mode) {
    return isSelected && mode !== 'view' ? [7, 4] : [0, 0];
  },

  // drawing line
  getDrawLineDashArray: function getDrawLineDashArray(f, mode) {
    return [7, 4];
  },
  getDrawLineColor: function getDrawLineColor(f, mode) {
    return DEFAULT_SELECTED_LINE_COLOR;
  },
  getDrawFillColor: function getDrawFillColor(f, mode) {
    return DEFAULT_SELECTED_FILL_COLOR;
  },
  getDrawLineWidth: function getDrawLineWidth(f, mode) {
    return f && f.properties && f.properties.lineWidth || 1;
  },

  editHandleType: 'point',

  // point handles
  editHandlePointRadiusScale: 1,
  editHandlePointOutline: false,
  editHandlePointStrokeWidth: 1,
  editHandlePointRadiusMinPixels: 4,
  editHandlePointRadiusMaxPixels: Number.MAX_SAFE_INTEGER,
  getEditHandlePointColor: function getEditHandlePointColor(handle) {
    return handle.type === 'existing' ? DEFAULT_EDITING_EXISTING_POINT_COLOR : DEFAULT_EDITING_INTERMEDIATE_POINT_COLOR;
  },
  getEditHandlePointRadius: function getEditHandlePointRadius(handle) {
    return handle.type === 'existing' ? 5 : 3;
  },

  // icon handles
  editHandleIconAtlas: null,
  editHandleIconMapping: null,
  editHandleIconSizeScale: 1,
  getEditHandleIcon: function getEditHandleIcon(handle) {
    return handle.type;
  },
  getEditHandleIconSize: 10,
  getEditHandleIconColor: function getEditHandleIconColor(handle) {
    return handle.type === 'existing' ? DEFAULT_EDITING_EXISTING_POINT_COLOR : DEFAULT_EDITING_INTERMEDIATE_POINT_COLOR;
  },
  getEditHandleIconAngle: 0
};

var EditableGeoJsonLayer = function (_EditableLayer) {
  _inherits(EditableGeoJsonLayer, _EditableLayer);

  function EditableGeoJsonLayer() {
    _classCallCheck(this, EditableGeoJsonLayer);

    return _possibleConstructorReturn(this, (EditableGeoJsonLayer.__proto__ || Object.getPrototypeOf(EditableGeoJsonLayer)).apply(this, arguments));
  }

  _createClass(EditableGeoJsonLayer, [{
    key: 'renderLayers',
    value: function renderLayers() {
      var subLayerProps = this.getSubLayerProps({
        id: 'geojson',

        // Proxy most GeoJsonLayer props as-is
        data: this.props.data,
        fp64: this.props.fp64,
        filled: this.props.filled,
        stroked: this.props.stroked,
        lineWidthScale: this.props.lineWidthScale,
        lineWidthMinPixels: this.props.lineWidthMinPixels,
        lineWidthMaxPixels: this.props.lineWidthMaxPixels,
        lineJointRounded: this.props.lineJointRounded,
        lineMiterLimit: this.props.lineMiterLimit,
        pointRadiusScale: this.props.pointRadiusScale,
        pointRadiusMinPixels: this.props.pointRadiusMinPixels,
        pointRadiusMaxPixels: this.props.pointRadiusMaxPixels,
        lineDashJustified: this.props.lineDashJustified,
        getLineColor: this.selectionAwareAccessor(this.props.getLineColor),
        getFillColor: this.selectionAwareAccessor(this.props.getFillColor),
        getRadius: this.selectionAwareAccessor(this.props.getRadius),
        getLineWidth: this.selectionAwareAccessor(this.props.getLineWidth),
        getLineDashArray: this.selectionAwareAccessor(this.props.getLineDashArray),

        updateTriggers: {
          getLineColor: [this.props.selectedFeatureIndexes, this.props.mode],
          getFillColor: [this.props.selectedFeatureIndexes, this.props.mode],
          getRadius: [this.props.selectedFeatureIndexes, this.props.mode],
          getLineWidth: [this.props.selectedFeatureIndexes, this.props.mode],
          getLineDashArray: [this.props.selectedFeatureIndexes, this.props.mode]
        }
      });

      var layers = [new _deck.GeoJsonLayer(subLayerProps)];

      layers = layers.concat(this.createPointLayers());
      layers = layers.concat(this.createDrawLayers());

      return layers;
    }
  }, {
    key: 'initializeState',
    value: function initializeState() {
      _get(EditableGeoJsonLayer.prototype.__proto__ || Object.getPrototypeOf(EditableGeoJsonLayer.prototype), 'initializeState', this).call(this);

      this.setState({
        editableFeatureCollection: null,
        selectedFeatures: [],
        editHandles: [],
        drawFeature: null
      });
    }

    // TODO: figure out how to properly update state from an outside event handler

  }, {
    key: 'shouldUpdateState',
    value: function shouldUpdateState(_ref) {
      var props = _ref.props,
          oldProps = _ref.oldProps,
          context = _ref.context,
          oldContext = _ref.oldContext,
          changeFlags = _ref.changeFlags;

      return true;
    }
  }, {
    key: 'updateState',
    value: function updateState(_ref2) {
      var props = _ref2.props,
          oldProps = _ref2.oldProps,
          changeFlags = _ref2.changeFlags;

      _get(EditableGeoJsonLayer.prototype.__proto__ || Object.getPrototypeOf(EditableGeoJsonLayer.prototype), 'updateState', this).call(this, { props: props, changeFlags: changeFlags });

      var editableFeatureCollection = this.state.editableFeatureCollection;
      if (changeFlags.dataChanged) {
        editableFeatureCollection = new _editableFeatureCollection.EditableFeatureCollection(props.data);
      }

      var selectedFeatures = [];
      if (Array.isArray(props.selectedFeatureIndexes)) {
        // TODO: needs improved testing, i.e. checking for duplicates, NaNs, out of range numbers, ...
        selectedFeatures = props.selectedFeatureIndexes.map(function (elem) {
          return props.data.features[elem];
        });
      }

      var editHandles = [];
      if (selectedFeatures.length && props.mode !== 'view') {
        props.selectedFeatureIndexes.forEach(function (index) {
          editHandles = editHandles.concat(editableFeatureCollection.getEditHandles(index));
        });
      }

      var drawFeature = this.state.drawFeature;
      if (props !== oldProps) {
        // If the props are different, recalculate the draw feature
        var selectedFeature = selectedFeatures.length === 1 ? selectedFeatures[0] : null;
        drawFeature = this.getDrawFeature(selectedFeature, props.mode, null);
      }

      this.setState({
        editableFeatureCollection: editableFeatureCollection,
        selectedFeatures: selectedFeatures,
        editHandles: editHandles,
        drawFeature: drawFeature
      });
    }
  }, {
    key: 'selectionAwareAccessor',
    value: function selectionAwareAccessor(accessor) {
      var _this2 = this;

      if (typeof accessor !== 'function') {
        return accessor;
      }
      return function (feature) {
        return accessor(feature, _this2.isFeatureSelected(feature), _this2.props.mode);
      };
    }
  }, {
    key: 'isFeatureSelected',
    value: function isFeatureSelected(feature) {
      if (!this.props.data || !this.props.selectedFeatureIndexes) {
        return false;
      }
      if (!this.props.selectedFeatureIndexes.length) {
        return false;
      }
      var featureIndex = this.props.data.features.indexOf(feature);
      return this.props.selectedFeatureIndexes.includes(featureIndex);
    }
  }, {
    key: 'getPickingInfo',
    value: function getPickingInfo(_ref3) {
      var info = _ref3.info,
          sourceLayer = _ref3.sourceLayer;

      if (sourceLayer.id.endsWith('-edit-handles')) {
        // If user is picking an editing handle, add additional data to the info
        info.isEditingHandle = true;
      }

      return info;
    }
  }, {
    key: 'createPointLayers',
    value: function createPointLayers() {
      if (!this.state.editHandles.length) {
        return [];
      }

      var sharedProps = {
        id: this.props.editHandleType + '-edit-handles',
        data: this.state.editHandles,
        fp64: this.props.fp64
      };

      var layer = this.props.editHandleType === 'icon' ? new _deck.IconLayer(this.getSubLayerProps(_extends({}, sharedProps, {
        iconAtlas: this.props.editHandleIconAtlas,
        iconMapping: this.props.editHandleIconMapping,
        sizeScale: this.props.editHandleIconSizeScale,
        getIcon: this.props.getEditHandleIcon,
        getSize: this.props.getEditHandleIconSize,
        getColor: this.props.getEditHandleIconColor,
        getAngle: this.props.getEditHandleIconAngle,

        getPosition: function getPosition(d) {
          return d.position;
        }
      }))) : this.props.editHandleType === 'point' ? new _deck.ScatterplotLayer(this.getSubLayerProps(_extends({}, sharedProps, {

        // Proxy editing point props
        radiusScale: this.props.editHandlePointRadiusScale,
        outline: this.props.editHandlePointOutline,
        strokeWidth: this.props.editHandlePointStrokeWidth,
        radiusMinPixels: this.props.editHandlePointRadiusMinPixels,
        radiusMaxPixels: this.props.editHandlePointRadiusMaxPixels,
        getRadius: this.props.getEditHandlePointRadius,
        getColor: this.props.getEditHandlePointColor
      }))) : null;

      return [layer];
    }
  }, {
    key: 'createDrawLayers',
    value: function createDrawLayers() {
      var _this3 = this;

      if (!this.state.drawFeature) {
        return [];
      }

      var layer = new _deck.GeoJsonLayer(this.getSubLayerProps({
        id: 'draw',
        data: this.state.drawFeature,
        fp64: this.props.fp64,
        pickable: false,
        stroked: this.props.mode !== 'drawPolygon',
        autoHighlight: false,
        lineWidthScale: this.props.lineWidthScale,
        lineWidthMinPixels: this.props.lineWidthMinPixels,
        lineWidthMaxPixels: this.props.lineWidthMaxPixels,
        lineJointRounded: this.props.lineJointRounded,
        lineMiterLimit: this.props.lineMiterLimit,
        pointRadiusScale: this.props.editHandlePointRadiusScale,
        outline: this.props.editHandlePointOutline,
        strokeWidth: this.props.editHandlePointStrokeWidth,
        pointRadiusMinPixels: this.props.editHandlePointRadiusMinPixels,
        pointRadiusMaxPixels: this.props.editHandlePointRadiusMaxPixels,
        getRadius: this.props.getEditHandlePointRadius,
        getLineColor: function getLineColor(feature) {
          return _this3.props.getDrawLineColor(feature, _this3.state.selectedFeatures[0], _this3.props.mode);
        },
        getLineWidth: function getLineWidth(feature) {
          return _this3.props.getDrawLineWidth(feature, _this3.state.selectedFeatures[0], _this3.props.mode);
        },
        getFillColor: function getFillColor(feature) {
          return _this3.props.getDrawFillColor(feature, _this3.state.selectedFeatures[0], _this3.props.mode);
        },
        getLineDashArray: function getLineDashArray(feature) {
          return _this3.props.getDrawLineDashArray(feature, _this3.state.selectedFeatures[0], _this3.props.mode);
        }
      }));

      return [layer];
    }
  }, {
    key: 'onClick',
    value: function onClick(_ref4) {
      var picks = _ref4.picks,
          screenCoords = _ref4.screenCoords,
          groundCoords = _ref4.groundCoords;
      var selectedFeatures = this.state.selectedFeatures;
      var selectedFeatureIndexes = this.props.selectedFeatureIndexes;

      var editHandleInfo = this.getPickedEditHandle(picks);

      if (this.props.mode === 'modify') {
        if (editHandleInfo && editHandleInfo.object.type === 'existing') {
          this.handleRemovePosition(this.props.data.features[editHandleInfo.object.featureIndex], editHandleInfo.object.featureIndex, editHandleInfo.object.positionIndexes);
        }
      } else if (this.props.mode === 'drawLineString' || this.props.mode === 'drawPolygon' || this.props.mode === 'drawRectangle' || this.props.mode === 'drawCircle') {
        if (!selectedFeatures.length) {
          this.handleDrawNewPoint(groundCoords);
        } else if (selectedFeatures.length === 1) {
          // can only draw feature while one is selected
          if (this.props.mode === 'drawLineString') {
            this.handleDrawLineString(selectedFeatures[0], selectedFeatureIndexes[0], groundCoords, picks);
          }
          if (this.props.mode === 'drawPolygon') {
            this.handleDrawPolygon(selectedFeatures[0], selectedFeatureIndexes[0], groundCoords, picks);
          }
          if (this.props.mode === 'drawRectangle') {
            this.handleDrawRectangle(selectedFeatures[0], selectedFeatureIndexes[0], groundCoords, picks);
          }
          if (this.props.mode === 'drawCircle') {
            this.handleDrawCircle(selectedFeatures[0], selectedFeatureIndexes[0], groundCoords, picks);
          }
        }
      }
    }
  }, {
    key: 'onStartDragging',
    value: function onStartDragging(_ref5) {
      var picks = _ref5.picks,
          screenCoords = _ref5.screenCoords,
          groundCoords = _ref5.groundCoords,
          dragStartScreenCoords = _ref5.dragStartScreenCoords,
          dragStartGroundCoords = _ref5.dragStartGroundCoords;
      var selectedFeatures = this.state.selectedFeatures;

      var editHandleInfo = this.getPickedEditHandle(picks);

      if (!selectedFeatures.length) {
        return;
      }

      if (editHandleInfo) {
        if (editHandleInfo.object.type === 'intermediate') {
          this.handleAddIntermediatePosition(editHandleInfo.object.featureIndex, editHandleInfo.object.positionIndexes, groundCoords);
        }
      }
    }
  }, {
    key: 'onDragging',
    value: function onDragging(_ref6) {
      var picks = _ref6.picks,
          screenCoords = _ref6.screenCoords,
          groundCoords = _ref6.groundCoords,
          dragStartScreenCoords = _ref6.dragStartScreenCoords,
          dragStartGroundCoords = _ref6.dragStartGroundCoords;
      var selectedFeatures = this.state.selectedFeatures;


      if (!selectedFeatures.length) {
        return;
      }

      var editHandleInfo = this.getPickedEditHandle(picks);
      if (editHandleInfo) {
        this.handleMovePosition(editHandleInfo.object.featureIndex, editHandleInfo.object.positionIndexes, groundCoords);
      }
    }
  }, {
    key: 'onStopDragging',
    value: function onStopDragging(_ref7) {
      var picks = _ref7.picks,
          screenCoords = _ref7.screenCoords,
          groundCoords = _ref7.groundCoords,
          dragStartScreenCoords = _ref7.dragStartScreenCoords,
          dragStartGroundCoords = _ref7.dragStartGroundCoords;
      var selectedFeatures = this.state.selectedFeatures;


      if (!selectedFeatures.length) {
        return;
      }

      var editHandleInfo = this.getPickedEditHandle(picks);

      if (editHandleInfo) {
        this.handleFinishMovePosition(editHandleInfo.object.featureIndex, editHandleInfo.object.positionIndexes, groundCoords);
      }
    }
  }, {
    key: 'onPointerMove',
    value: function onPointerMove(_ref8) {
      var screenCoords = _ref8.screenCoords,
          groundCoords = _ref8.groundCoords,
          isDragging = _ref8.isDragging,
          pointerDownPicks = _ref8.pointerDownPicks,
          sourceEvent = _ref8.sourceEvent;

      if (this.props.mode === 'drawLineString' || this.props.mode === 'drawPolygon' || this.props.mode === 'drawRectangle' || this.props.mode === 'drawCircle') {
        var selectedFeature = this.state.selectedFeatures.length === 1 ? this.state.selectedFeatures[0] : null;
        var drawFeature = this.getDrawFeature(selectedFeature, this.props.mode, groundCoords);

        this.setState({ drawFeature: drawFeature });

        // TODO: figure out how to properly update state from a pointer event handler
        this.setLayerNeedsUpdate();
      }

      if (pointerDownPicks && pointerDownPicks.length > 0) {
        var editHandleInfo = this.getPickedEditHandle(pointerDownPicks);
        if (editHandleInfo) {
          // TODO: find a less hacky way to prevent map panning
          // Stop propagation to prevent map panning while dragging an edit handle
          sourceEvent.stopPropagation();
        }
      }
    }
  }, {
    key: 'getDrawFeature',
    value: function getDrawFeature(selectedFeature, mode, groundCoords) {
      var drawFeature = null;

      if (!selectedFeature && !groundCoords) {
        // Need a mouse position in order to draw a single point
        return null;
      }

      if (!selectedFeature) {
        // Start with a point
        drawFeature = {
          type: 'Feature',
          geometry: {
            type: 'Point',
            coordinates: groundCoords
          }
        };
      } else if (selectedFeature.geometry.type === 'Point') {
        if (mode === 'drawLineString' || mode === 'drawPolygon') {
          // Draw an extension line starting from the point
          var startPosition = selectedFeature.geometry.coordinates;
          var endPosition = groundCoords || startPosition;

          drawFeature = {
            type: 'Feature',
            geometry: {
              type: 'LineString',
              coordinates: [startPosition, endPosition]
            }
          };
        } else if (mode === 'drawRectangle') {
          var corner1 = selectedFeature.geometry.coordinates;
          var corner2 = groundCoords || corner1;
          var minX = Math.min(corner1[0], corner2[0]);
          var minY = Math.min(corner1[1], corner2[1]);
          var maxX = Math.max(corner1[0], corner2[0]);
          var maxY = Math.max(corner1[1], corner2[1]);

          drawFeature = (0, _bboxPolygon2.default)([minX, minY, maxX, maxY]);
        } else if (mode === 'drawCircle') {
          var center = selectedFeature.geometry.coordinates;
          var radius = Math.max((0, _distance2.default)(selectedFeature, groundCoords || center), 0.001);
          drawFeature = (0, _circle2.default)(center, radius);
        }
      } else if (selectedFeature.geometry.type === 'LineString') {
        var lastPositionOfLineString = selectedFeature.geometry.coordinates[selectedFeature.geometry.coordinates.length - 1];
        var currentPosition = groundCoords || lastPositionOfLineString;

        if (mode === 'drawLineString') {
          // Draw a single line extending beyond the last point

          drawFeature = {
            type: 'Feature',
            geometry: {
              type: 'LineString',
              coordinates: [lastPositionOfLineString, currentPosition]
            }
          };
        } else if (mode === 'drawPolygon') {
          // Requires two features, a non-stroked polygon for fill and a
          // line string for the drawing feature
          drawFeature = {
            type: 'FeatureCollection',
            features: [{
              type: 'Feature',
              geometry: {
                type: 'Polygon',
                coordinates: [[].concat(_toConsumableArray(selectedFeature.geometry.coordinates), [currentPosition, selectedFeature.geometry.coordinates[0]])]
              }
            }, {
              type: 'Feature',
              geometry: {
                type: 'LineString',
                coordinates: [selectedFeature.geometry.coordinates[selectedFeature.geometry.coordinates.length - 1], currentPosition, selectedFeature.geometry.coordinates[0]]
              }
            }]
          };
        }
      }
      return drawFeature;
    }
  }, {
    key: 'handleMovePosition',
    value: function handleMovePosition(featureIndex, positionIndexes, groundCoords) {
      var updatedData = this.state.editableFeatureCollection.replacePosition(featureIndex, positionIndexes, groundCoords).getObject();

      this.props.onEdit({
        updatedData: updatedData,
        updatedMode: this.props.mode,
        updatedSelectedFeatureIndexes: this.props.selectedFeatureIndexes,
        editType: 'movePosition',
        featureIndex: featureIndex,
        positionIndexes: positionIndexes,
        position: groundCoords
      });
    }
  }, {
    key: 'handleFinishMovePosition',
    value: function handleFinishMovePosition(featureIndex, positionIndexes, groundCoords) {
      var updatedData = this.state.editableFeatureCollection.replacePosition(featureIndex, positionIndexes, groundCoords).getObject();

      this.props.onEdit({
        updatedData: updatedData,
        updatedMode: this.props.mode,
        updatedSelectedFeatureIndexes: this.props.selectedFeatureIndexes,
        editType: 'finishMovePosition',
        featureIndex: featureIndex,
        positionIndexes: positionIndexes,
        position: groundCoords
      });
    }
  }, {
    key: 'handleAddIntermediatePosition',
    value: function handleAddIntermediatePosition(featureIndex, positionIndexes, groundCoords) {
      var updatedData = this.state.editableFeatureCollection.addPosition(featureIndex, positionIndexes, groundCoords).getObject();

      this.props.onEdit({
        updatedData: updatedData,
        updatedMode: this.props.mode,
        updatedSelectedFeatureIndexes: this.props.selectedFeatureIndexes,
        editType: 'addPosition',
        featureIndex: featureIndex,
        positionIndexes: positionIndexes,
        position: groundCoords
      });
    }
  }, {
    key: 'handleRemovePosition',
    value: function handleRemovePosition(selectedFeature, featureIndex, positionIndexes) {
      var updatedData = void 0;
      try {
        updatedData = this.state.editableFeatureCollection.removePosition(featureIndex, positionIndexes).getObject();
      } catch (error) {
        // This happens if user attempts to remove the last point
      }

      if (updatedData) {
        this.props.onEdit({
          updatedData: updatedData,
          updatedMode: this.props.mode,
          updatedSelectedFeatureIndexes: this.props.selectedFeatureIndexes,
          editType: 'removePosition',
          featureIndex: featureIndex,
          positionIndexes: positionIndexes
        });
      }
    }
  }, {
    key: 'handleDrawLineString',
    value: function handleDrawLineString(selectedFeature, featureIndex, groundCoords, picks) {
      var featureCollection = this.state.editableFeatureCollection;
      var positionIndexes = void 0;

      if (selectedFeature.geometry.type === 'Point') {
        positionIndexes = [1];

        // Upgrade from Point to LineString
        featureCollection = featureCollection.replaceGeometry(featureIndex, {
          type: 'LineString',
          coordinates: [selectedFeature.geometry.coordinates, groundCoords]
        });
      } else if (selectedFeature.geometry.type === 'LineString') {
        positionIndexes = [selectedFeature.geometry.coordinates.length];
        featureCollection = featureCollection.addPosition(featureIndex, positionIndexes, groundCoords);
      } else {
        console.warn('Unsupported geometry type: ' + selectedFeature.geometry.type); // eslint-disable-line
        return;
      }

      var updatedData = featureCollection.getObject();

      this.props.onEdit({
        updatedData: updatedData,
        updatedMode: this.props.mode,
        updatedSelectedFeatureIndexes: this.props.selectedFeatureIndexes,
        editType: 'addPosition',
        featureIndex: featureIndex,
        positionIndexes: positionIndexes,
        position: groundCoords
      });
    }
  }, {
    key: 'handleDrawPolygon',
    value: function handleDrawPolygon(selectedFeature, featureIndex, groundCoords, picks) {
      var featureCollection = this.state.editableFeatureCollection;
      var positionIndexes = void 0;

      var updatedMode = this.props.mode;

      if (selectedFeature.geometry.type === 'Point') {
        positionIndexes = [1];
        // Upgrade from Point to LineString
        featureCollection = featureCollection.replaceGeometry(featureIndex, {
          type: 'LineString',
          coordinates: [selectedFeature.geometry.coordinates, groundCoords]
        });
      } else if (selectedFeature.geometry.type === 'LineString') {
        var pickedHandleInfo = this.getPickedEditHandle(picks);
        if (pickedHandleInfo && pickedHandleInfo.object.positionIndexes[0] === 0 && selectedFeature.geometry.coordinates.length > 2) {
          // They clicked the first position of the LineString, so close the polygon
          featureCollection = featureCollection.replaceGeometry(featureIndex, {
            type: 'Polygon',
            coordinates: [[].concat(_toConsumableArray(selectedFeature.geometry.coordinates), [selectedFeature.geometry.coordinates[0]])]
          });
          updatedMode = 'modify';
        } else {
          // Add another point along the LineString
          positionIndexes = [selectedFeature.geometry.coordinates.length];
          featureCollection = featureCollection.addPosition(featureIndex, positionIndexes, groundCoords);
        }
      } else {
        console.warn('Unsupported geometry type: ' + selectedFeature.geometry.type); // eslint-disable-line
        return;
      }

      var updatedData = featureCollection.getObject();

      this.props.onEdit({
        updatedData: updatedData,
        updatedMode: updatedMode,
        updatedSelectedFeatureIndexes: this.props.selectedFeatureIndexes,
        editType: 'addPosition',
        featureIndex: featureIndex,
        positionIndexes: positionIndexes,
        position: groundCoords
      });
    }
  }, {
    key: 'handleDrawRectangle',
    value: function handleDrawRectangle(selectedFeature, featureIndex, groundCoords, picks) {
      var featureCollection = this.state.editableFeatureCollection;
      var positionIndexes = void 0;

      var updatedMode = this.props.mode;

      if (selectedFeature.geometry.type === 'Point') {
        positionIndexes = null;
        featureCollection = featureCollection.replaceGeometry(featureIndex, this.state.drawFeature.geometry);
        updatedMode = 'modify';
      } else {
        console.warn('Unsupported geometry type: ' + selectedFeature.geometry.type); // eslint-disable-line
        return;
      }

      var updatedData = featureCollection.getObject();

      this.props.onEdit({
        updatedData: updatedData,
        updatedMode: updatedMode,
        updatedSelectedFeatureIndexes: this.props.selectedFeatureIndexes,
        editType: 'addPosition',
        featureIndex: featureIndex,
        positionIndexes: positionIndexes,
        position: groundCoords
      });
    }
  }, {
    key: 'handleDrawCircle',
    value: function handleDrawCircle(selectedFeature, featureIndex, groundCoords, picks) {
      var featureCollection = this.state.editableFeatureCollection;
      var positionIndexes = void 0;

      var updatedMode = this.props.mode;

      if (selectedFeature.geometry.type === 'Point') {
        positionIndexes = null;
        featureCollection = featureCollection.replaceGeometry(featureIndex, this.state.drawFeature.geometry);
        updatedMode = 'modify';
      } else {
        console.warn('Unsupported geometry type: ' + selectedFeature.geometry.type); // eslint-disable-line
        return;
      }

      var updatedData = featureCollection.getObject();

      this.props.onEdit({
        updatedData: updatedData,
        updatedMode: updatedMode,
        updatedSelectedFeatureIndexes: this.props.selectedFeatureIndexes,
        editType: 'addPosition',
        featureIndex: featureIndex,
        positionIndexes: positionIndexes,
        position: groundCoords
      });
    }
  }, {
    key: 'handleDrawNewPoint',
    value: function handleDrawNewPoint(groundCoords) {
      // Starts off as a point (since LineString requires at least 2 positions)
      var newFeature = {
        type: 'Feature',
        geometry: {
          type: 'Point',
          coordinates: groundCoords
        }
      };

      var updatedData = this.state.editableFeatureCollection.addFeature(newFeature).getObject();
      var featureIndex = this.props.data.features.length;

      this.props.onEdit({
        updatedData: updatedData,
        updatedMode: this.props.mode,
        updatedSelectedFeatureIndexes: [featureIndex],
        editType: 'addFeature',
        featureIndex: featureIndex,
        positionIndexes: [0],
        position: groundCoords
      });
    }
  }, {
    key: 'getPickedEditHandle',
    value: function getPickedEditHandle(picks) {
      return picks.find(function (pick) {
        return pick.isEditingHandle;
      });
    }
  }]);

  return EditableGeoJsonLayer;
}(_editableLayer2.default);

exports.default = EditableGeoJsonLayer;


EditableGeoJsonLayer.layerName = 'EditableGeoJsonLayer';
EditableGeoJsonLayer.defaultProps = defaultProps;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9saWIvbGF5ZXJzL2VkaXRhYmxlLWdlb2pzb24tbGF5ZXIuanMiXSwibmFtZXMiOlsiREVGQVVMVF9MSU5FX0NPTE9SIiwiREVGQVVMVF9GSUxMX0NPTE9SIiwiREVGQVVMVF9TRUxFQ1RFRF9MSU5FX0NPTE9SIiwiREVGQVVMVF9TRUxFQ1RFRF9GSUxMX0NPTE9SIiwiREVGQVVMVF9FRElUSU5HX0VYSVNUSU5HX1BPSU5UX0NPTE9SIiwiREVGQVVMVF9FRElUSU5HX0lOVEVSTUVESUFURV9QT0lOVF9DT0xPUiIsImRlZmF1bHRQcm9wcyIsIm1vZGUiLCJvbkVkaXQiLCJwaWNrYWJsZSIsImZwNjQiLCJmaWxsZWQiLCJzdHJva2VkIiwibGluZVdpZHRoU2NhbGUiLCJsaW5lV2lkdGhNaW5QaXhlbHMiLCJsaW5lV2lkdGhNYXhQaXhlbHMiLCJOdW1iZXIiLCJNQVhfU0FGRV9JTlRFR0VSIiwibGluZUpvaW50Um91bmRlZCIsImxpbmVNaXRlckxpbWl0IiwicG9pbnRSYWRpdXNTY2FsZSIsInBvaW50UmFkaXVzTWluUGl4ZWxzIiwicG9pbnRSYWRpdXNNYXhQaXhlbHMiLCJsaW5lRGFzaEp1c3RpZmllZCIsImdldExpbmVDb2xvciIsImZlYXR1cmUiLCJpc1NlbGVjdGVkIiwiZ2V0RmlsbENvbG9yIiwiZ2V0UmFkaXVzIiwiZiIsInByb3BlcnRpZXMiLCJyYWRpdXMiLCJzaXplIiwiZ2V0TGluZVdpZHRoIiwibGluZVdpZHRoIiwiZ2V0TGluZURhc2hBcnJheSIsImdldERyYXdMaW5lRGFzaEFycmF5IiwiZ2V0RHJhd0xpbmVDb2xvciIsImdldERyYXdGaWxsQ29sb3IiLCJnZXREcmF3TGluZVdpZHRoIiwiZWRpdEhhbmRsZVR5cGUiLCJlZGl0SGFuZGxlUG9pbnRSYWRpdXNTY2FsZSIsImVkaXRIYW5kbGVQb2ludE91dGxpbmUiLCJlZGl0SGFuZGxlUG9pbnRTdHJva2VXaWR0aCIsImVkaXRIYW5kbGVQb2ludFJhZGl1c01pblBpeGVscyIsImVkaXRIYW5kbGVQb2ludFJhZGl1c01heFBpeGVscyIsImdldEVkaXRIYW5kbGVQb2ludENvbG9yIiwiaGFuZGxlIiwidHlwZSIsImdldEVkaXRIYW5kbGVQb2ludFJhZGl1cyIsImVkaXRIYW5kbGVJY29uQXRsYXMiLCJlZGl0SGFuZGxlSWNvbk1hcHBpbmciLCJlZGl0SGFuZGxlSWNvblNpemVTY2FsZSIsImdldEVkaXRIYW5kbGVJY29uIiwiZ2V0RWRpdEhhbmRsZUljb25TaXplIiwiZ2V0RWRpdEhhbmRsZUljb25Db2xvciIsImdldEVkaXRIYW5kbGVJY29uQW5nbGUiLCJFZGl0YWJsZUdlb0pzb25MYXllciIsInN1YkxheWVyUHJvcHMiLCJnZXRTdWJMYXllclByb3BzIiwiaWQiLCJkYXRhIiwicHJvcHMiLCJzZWxlY3Rpb25Bd2FyZUFjY2Vzc29yIiwidXBkYXRlVHJpZ2dlcnMiLCJzZWxlY3RlZEZlYXR1cmVJbmRleGVzIiwibGF5ZXJzIiwiY29uY2F0IiwiY3JlYXRlUG9pbnRMYXllcnMiLCJjcmVhdGVEcmF3TGF5ZXJzIiwic2V0U3RhdGUiLCJlZGl0YWJsZUZlYXR1cmVDb2xsZWN0aW9uIiwic2VsZWN0ZWRGZWF0dXJlcyIsImVkaXRIYW5kbGVzIiwiZHJhd0ZlYXR1cmUiLCJvbGRQcm9wcyIsImNvbnRleHQiLCJvbGRDb250ZXh0IiwiY2hhbmdlRmxhZ3MiLCJzdGF0ZSIsImRhdGFDaGFuZ2VkIiwiQXJyYXkiLCJpc0FycmF5IiwibWFwIiwiZmVhdHVyZXMiLCJlbGVtIiwibGVuZ3RoIiwiZm9yRWFjaCIsImdldEVkaXRIYW5kbGVzIiwiaW5kZXgiLCJzZWxlY3RlZEZlYXR1cmUiLCJnZXREcmF3RmVhdHVyZSIsImFjY2Vzc29yIiwiaXNGZWF0dXJlU2VsZWN0ZWQiLCJmZWF0dXJlSW5kZXgiLCJpbmRleE9mIiwiaW5jbHVkZXMiLCJpbmZvIiwic291cmNlTGF5ZXIiLCJlbmRzV2l0aCIsImlzRWRpdGluZ0hhbmRsZSIsInNoYXJlZFByb3BzIiwibGF5ZXIiLCJpY29uQXRsYXMiLCJpY29uTWFwcGluZyIsInNpemVTY2FsZSIsImdldEljb24iLCJnZXRTaXplIiwiZ2V0Q29sb3IiLCJnZXRBbmdsZSIsImdldFBvc2l0aW9uIiwiZCIsInBvc2l0aW9uIiwicmFkaXVzU2NhbGUiLCJvdXRsaW5lIiwic3Ryb2tlV2lkdGgiLCJyYWRpdXNNaW5QaXhlbHMiLCJyYWRpdXNNYXhQaXhlbHMiLCJhdXRvSGlnaGxpZ2h0IiwicGlja3MiLCJzY3JlZW5Db29yZHMiLCJncm91bmRDb29yZHMiLCJlZGl0SGFuZGxlSW5mbyIsImdldFBpY2tlZEVkaXRIYW5kbGUiLCJvYmplY3QiLCJoYW5kbGVSZW1vdmVQb3NpdGlvbiIsInBvc2l0aW9uSW5kZXhlcyIsImhhbmRsZURyYXdOZXdQb2ludCIsImhhbmRsZURyYXdMaW5lU3RyaW5nIiwiaGFuZGxlRHJhd1BvbHlnb24iLCJoYW5kbGVEcmF3UmVjdGFuZ2xlIiwiaGFuZGxlRHJhd0NpcmNsZSIsImRyYWdTdGFydFNjcmVlbkNvb3JkcyIsImRyYWdTdGFydEdyb3VuZENvb3JkcyIsImhhbmRsZUFkZEludGVybWVkaWF0ZVBvc2l0aW9uIiwiaGFuZGxlTW92ZVBvc2l0aW9uIiwiaGFuZGxlRmluaXNoTW92ZVBvc2l0aW9uIiwiaXNEcmFnZ2luZyIsInBvaW50ZXJEb3duUGlja3MiLCJzb3VyY2VFdmVudCIsInNldExheWVyTmVlZHNVcGRhdGUiLCJzdG9wUHJvcGFnYXRpb24iLCJnZW9tZXRyeSIsImNvb3JkaW5hdGVzIiwic3RhcnRQb3NpdGlvbiIsImVuZFBvc2l0aW9uIiwiY29ybmVyMSIsImNvcm5lcjIiLCJtaW5YIiwiTWF0aCIsIm1pbiIsIm1pblkiLCJtYXhYIiwibWF4IiwibWF4WSIsImNlbnRlciIsImxhc3RQb3NpdGlvbk9mTGluZVN0cmluZyIsImN1cnJlbnRQb3NpdGlvbiIsInVwZGF0ZWREYXRhIiwicmVwbGFjZVBvc2l0aW9uIiwiZ2V0T2JqZWN0IiwidXBkYXRlZE1vZGUiLCJ1cGRhdGVkU2VsZWN0ZWRGZWF0dXJlSW5kZXhlcyIsImVkaXRUeXBlIiwiYWRkUG9zaXRpb24iLCJyZW1vdmVQb3NpdGlvbiIsImVycm9yIiwiZmVhdHVyZUNvbGxlY3Rpb24iLCJyZXBsYWNlR2VvbWV0cnkiLCJjb25zb2xlIiwid2FybiIsInBpY2tlZEhhbmRsZUluZm8iLCJuZXdGZWF0dXJlIiwiYWRkRmVhdHVyZSIsImZpbmQiLCJwaWNrIiwibGF5ZXJOYW1lIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFHQTs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFFQTs7QUFDQTs7Ozs7Ozs7Ozs7OztBQVJBOztBQVVBLElBQU1BLHFCQUFxQixDQUFDLEdBQUQsRUFBTSxHQUFOLEVBQVcsR0FBWCxFQUFnQixJQUFoQixDQUEzQjtBQUNBLElBQU1DLHFCQUFxQixDQUFDLEdBQUQsRUFBTSxHQUFOLEVBQVcsR0FBWCxFQUFnQixJQUFoQixDQUEzQjtBQUNBLElBQU1DLDhCQUE4QixDQUFDLElBQUQsRUFBTyxJQUFQLEVBQWEsSUFBYixFQUFtQixJQUFuQixDQUFwQztBQUNBLElBQU1DLDhCQUE4QixDQUFDLElBQUQsRUFBTyxJQUFQLEVBQWEsSUFBYixFQUFtQixJQUFuQixDQUFwQztBQUNBLElBQU1DLHVDQUF1QyxDQUFDLElBQUQsRUFBTyxHQUFQLEVBQVksR0FBWixFQUFpQixJQUFqQixDQUE3QztBQUNBLElBQU1DLDJDQUEyQyxDQUFDLEdBQUQsRUFBTSxHQUFOLEVBQVcsR0FBWCxFQUFnQixJQUFoQixDQUFqRDs7QUFFQSxJQUFNQyxlQUFlO0FBQ25CQyxRQUFNLFFBRGE7O0FBR25CO0FBQ0FDLFVBQVEsa0JBQU0sQ0FBRSxDQUpHOztBQU1uQkMsWUFBVSxJQU5TO0FBT25CQyxRQUFNLEtBUGE7QUFRbkJDLFVBQVEsSUFSVztBQVNuQkMsV0FBUyxJQVRVO0FBVW5CQyxrQkFBZ0IsQ0FWRztBQVduQkMsc0JBQW9CLENBWEQ7QUFZbkJDLHNCQUFvQkMsT0FBT0MsZ0JBWlI7QUFhbkJDLG9CQUFrQixLQWJDO0FBY25CQyxrQkFBZ0IsQ0FkRztBQWVu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RyxLQUFMLENBQVd2RCxJQUZSO0FBR2hCMkosdUNBQStCLENBQUNwRSxZQUFELENBSGY7QUFJaEJxRSxrQkFBVSxZQUpNO0FBS2hCckUsa0NBTGdCO0FBTWhCZ0MseUJBQWlCLENBQUMsQ0FBRCxDQU5EO0FBT2hCZCxrQkFBVVM7QUFQTSxPQUFsQjtBQVNEOzs7d0NBRW1CRixLLEVBQWlCO0FBQ25DLGFBQU9BLE1BQU11RCxJQUFOLENBQVc7QUFBQSxlQUFRQyxLQUFLM0UsZUFBYjtBQUFBLE9BQVgsQ0FBUDtBQUNEOzs7Ozs7a0JBdnVCa0IzQyxvQjs7O0FBMHVCckJBLHFCQUFxQnVILFNBQXJCLEdBQWlDLHNCQUFqQztBQUNBdkgscUJBQXFCbkQsWUFBckIsR0FBb0NBLFlBQXBDIiwiZmlsZSI6ImVkaXRhYmxlLWdlb2pzb24tbGF5ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xuLyogZXNsaW50LWVudiBicm93c2VyICovXG5cbmltcG9ydCB7IEdlb0pzb25MYXllciwgU2NhdHRlcnBsb3RMYXllciwgSWNvbkxheWVyIH0gZnJvbSAnZGVjay5nbCc7XG5pbXBvcnQgYmJveFBvbHlnb24gZnJvbSAnQHR1cmYvYmJveC1wb2x5Z29uJztcbmltcG9ydCBjaXJjbGUgZnJvbSAnQHR1cmYvY2lyY2xlJztcbmltcG9ydCBkaXN0YW5jZSBmcm9tICdAdHVyZi9kaXN0YW5jZSc7XG5pbXBvcnQgdHlwZSB7IEdlb0pzb25GZWF0dXJlIH0gZnJvbSAnLi4vLi4vdHlwZXMnO1xuaW1wb3J0IHsgRWRpdGFibGVGZWF0dXJlQ29sbGVjdGlvbiB9IGZyb20gJy4uL2VkaXRhYmxlLWZlYXR1cmUtY29sbGVjdGlvbic7XG5pbXBvcnQgRWRpdGFibGVMYXllciBmcm9tICcuL2VkaXRhYmxlLWxheWVyJztcblxuY29uc3QgREVGQVVMVF9MSU5FX0NPTE9SID0gWzB4MCwgMHgwLCAweDAsIDB4ZmZdO1xuY29uc3QgREVGQVVMVF9GSUxMX0NPTE9SID0gWzB4MCwgMHgwLCAweDAsIDB4OTBdO1xuY29uc3QgREVGQVVMVF9TRUxFQ1RFRF9MSU5FX0NPTE9SID0gWzB4OTAsIDB4OTAsIDB4OTAsIDB4ZmZdO1xuY29uc3QgREVGQVVMVF9TRUxFQ1RFRF9GSUxMX0NPTE9SID0gWzB4OTAsIDB4OTAsIDB4OTAsIDB4OTBdO1xuY29uc3QgREVGQVVMVF9FRElUSU5HX0VYSVNUSU5HX1BPSU5UX0NPTE9SID0gWzB4YzAsIDB4MCwgMHgwLCAweGZmXTtcbmNvbnN0IERFRkFVTFRfRURJVElOR19JTlRFUk1FRElBVEVfUE9JTlRfQ09MT1IgPSBbMHgwLCAweDAsIDB4MCwgMHg4MF07XG5cbmNvbnN0IGRlZmF1bHRQcm9wcyA9IHtcbiAgbW9kZTogJ21vZGlmeScsXG5cbiAgLy8gRWRpdCBhbmQgaW50ZXJhY3Rpb24gZXZlbnRzXG4gIG9uRWRpdDogKCkgPT4ge30sXG5cbiAgcGlja2FibGU6IHRydWUsXG4gIGZwNjQ6IGZhbHNlLFxuICBmaWxsZWQ6IHRydWUsXG4gIHN0cm9rZWQ6IHRydWUsXG4gIGxpbmVXaWR0aFNjYWxlOiAxLFxuICBsaW5lV2lkdGhNaW5QaXhlbHM6IDEsXG4gIGxpbmVXaWR0aE1heFBpeGVsczogTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIsXG4gIGxpbmVKb2ludFJvdW5kZWQ6IGZhbHNlLFxuICBsaW5lTWl0ZXJMaW1pdDogNCxcbiAgcG9pbnRSYWRpdXNTY2FsZTogMSxcbiAgcG9pbnRSYWRpdXNNaW5QaXhlbHM6IDIsXG4gIHBvaW50UmFkaXVzTWF4UGl4ZWxzOiBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUixcbiAgbGluZURhc2hKdXN0aWZpZWQ6IGZhbHNlLFxuICBnZXRMaW5lQ29sb3I6IChmZWF0dXJlLCBpc1NlbGVjdGVkLCBtb2RlKSA9PlxuICAgIGlzU2VsZWN0ZWQgPyBERUZBVUxUX1NFTEVDVEVEX0xJTkVfQ09MT1IgOiBERUZBVUxUX0xJTkVfQ09MT1IsXG4gIGdldEZpbGxDb2xvcjogKGZlYXR1cmUsIGlzU2VsZWN0ZWQsIG1vZGUpID0+XG4gICAgaXNTZWxlY3RlZCA/IERFRkFVTFRfU0VMRUNURURfRklMTF9DT0xPUiA6IERFRkFVTFRfRklMTF9DT0xPUixcbiAgZ2V0UmFkaXVzOiBmID0+XG4gICAgKGYgJiYgZi5wcm9wZXJ0aWVzICYmIGYucHJvcGVydGllcy5yYWRpdXMpIHx8IChmICYmIGYucHJvcGVydGllcyAmJiBmLnByb3BlcnRpZXMuc2l6ZSkgfHwgMSxcbiAgZ2V0TGluZVdpZHRoOiBmID0+IChmICYmIGYucHJvcGVydGllcyAmJiBmLnByb3BlcnRpZXMubGluZVdpZHRoKSB8fCAxLFxuICBnZXRMaW5lRGFzaEFycmF5OiAoZmVhdHVyZSwgaXNTZWxlY3RlZCwgbW9kZSkgPT5cbiAgICBpc1NlbGVjdGVkICYmIG1vZGUgIT09ICd2aWV3JyA/IFs3LCA0XSA6IFswLCAwXSxcblxuICAvLyBkcmF3aW5nIGxpbmVcbiAgZ2V0RHJhd0xpbmVEYXNoQXJyYXk6IChmLCBtb2RlKSA9PiBbNywgNF0sXG4gIGdldERyYXdMaW5lQ29sb3I6IChmLCBtb2RlKSA9PiBERUZBVUxUX1NFTEVDVEVEX0xJTkVfQ09MT1IsXG4gIGdldERyYXdGaWxsQ29sb3I6IChmLCBtb2RlKSA9PiBERUZBVUxUX1NFTEVDVEVEX0ZJTExfQ09MT1IsXG4gIGdldERyYXdMaW5lV2lkdGg6IChmLCBtb2RlKSA9PiAoZiAmJiBmLnByb3BlcnRpZXMgJiYgZi5wcm9wZXJ0aWVzLmxpbmVXaWR0aCkgfHwgMSxcblxuICBlZGl0SGFuZGxlVHlwZTogJ3BvaW50JyxcblxuICAvLyBwb2ludCBoYW5kbGVzXG4gIGVkaXRIYW5kbGVQb2ludFJhZGl1c1NjYWxlOiAxLFxuICBlZGl0SGFuZGxlUG9pbnRPdXRsaW5lOiBmYWxzZSxcbiAgZWRpdEhhbmRsZVBvaW50U3Ryb2tlV2lkdGg6IDEsXG4gIGVkaXRIYW5kbGVQb2ludFJhZGl1c01pblBpeGVsczogNCxcbiAgZWRpdEhhbmRsZVBvaW50UmFkaXVzTWF4UGl4ZWxzOiBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUixcbiAgZ2V0RWRpdEhhbmRsZVBvaW50Q29sb3I6IGhhbmRsZSA9PlxuICAgIGhhbmRsZS50eXBlID09PSAnZXhpc3RpbmcnXG4gICAgICA/IERFRkFVTFRfRURJVElOR19FWElTVElOR19QT0lOVF9DT0xPUlxuICAgICAgOiBERUZBVUxUX0VESVRJTkdfSU5URVJNRURJQVRFX1BPSU5UX0NPTE9SLFxuICBnZXRFZGl0SGFuZGxlUG9pbnRSYWRpdXM6IGhhbmRsZSA9PiAoaGFuZGxlLnR5cGUgPT09ICdleGlzdGluZycgPyA1IDogMyksXG5cbiAgLy8gaWNvbiBoYW5kbGVzXG4gIGVkaXRIYW5kbGVJY29uQXRsYXM6IG51bGwsXG4gIGVkaXRIYW5kbGVJY29uTWFwcGluZzogbnVsbCxcbiAgZWRpdEhhbmRsZUljb25TaXplU2NhbGU6IDEsXG4gIGdldEVkaXRIYW5kbGVJY29uOiBoYW5kbGUgPT4gaGFuZGxlLnR5cGUsXG4gIGdldEVkaXRIYW5kbGVJY29uU2l6ZTogMTAsXG4gIGdldEVkaXRIYW5kbGVJY29uQ29sb3I6IGhhbmRsZSA9PlxuICAgIGhhbmRsZS50eXBlID09PSAnZXhpc3RpbmcnXG4gICAgICA/IERFRkFVTFRfRURJVElOR19FWElTVElOR19QT0lOVF9DT0xPUlxuICAgICAgOiBERUZBVUxUX0VESVRJTkdfSU5URVJNRURJQVRFX1BPSU5UX0NPTE9SLFxuICBnZXRFZGl0SGFuZGxlSWNvbkFuZ2xlOiAwXG59O1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBFZGl0YWJsZUdlb0pzb25MYXllciBleHRlbmRzIEVkaXRhYmxlTGF5ZXIge1xuICByZW5kZXJMYXllcnMoKSB7XG4gICAgY29uc3Qgc3ViTGF5ZXJQcm9wcyA9IHRoaXMuZ2V0U3ViTGF5ZXJQcm9wcyh7XG4gICAgICBpZDogJ2dlb2pzb24nLFxuXG4gICAgICAvLyBQcm94eSBtb3N0IEdlb0pzb25MYXllciBwcm9wcyBhcy1pc1xuICAgICAgZGF0YTogdGhpcy5wcm9wcy5kYXRhLFxuICAgICAgZnA2NDogdGhpcy5wcm9wcy5mcDY0LFxuICAgICAgZmlsbGVkOiB0aGlzLnByb3BzLmZpbGxlZCxcbiAgICAgIHN0cm9rZWQ6IHRoaXMucHJvcHMuc3Ryb2tlZCxcbiAgICAgIGxpbmVXaWR0aFNjYWxlOiB0aGlzLnByb3BzLmxpbmVXaWR0aFNjYWxlLFxuICAgICAgbGluZVdpZHRoTWluUGl4ZWxzOiB0aGlzLnByb3BzLmxpbmVXaWR0aE1pblBpeGVscyxcbiAgICAgIGxpbmVXaWR0aE1heFBpeGVsczogdGhpcy5wcm9wcy5saW5lV2lkdGhNYXhQaXhlbHMsXG4gICAgICBsaW5lSm9pbnRSb3VuZGVkOiB0aGlzLnByb3BzLmxpbmVKb2ludFJvdW5kZWQsXG4gICAgICBsaW5lTWl0ZXJMaW1pdDogdGhpcy5wcm9wcy5saW5lTWl0ZXJMaW1pdCxcbiAgICAgIHBvaW50UmFkaXVzU2NhbGU6IHRoaXMucHJvcHMucG9pbnRSYWRpdXNTY2FsZSxcbiAgICAgIHBvaW50UmFkaXVzTWluUGl4ZWxzOiB0aGlzLnByb3BzLnBvaW50UmFkaXVzTWluUGl4ZWxzLFxuICAgICAgcG9pbnRSYWRpdXNNYXhQaXhlbHM6IHRoaXMucHJvcHMucG9pbnRSYWRpdXNNYXhQaXhlbHMsXG4gICAgICBsaW5lRGFzaEp1c3RpZmllZDogdGhpcy5wcm9wcy5saW5lRGFzaEp1c3RpZmllZCxcbiAgICAgIGdldExpbmVDb2xvcjogdGhpcy5zZWxlY3Rpb25Bd2FyZUFjY2Vzc29yKHRoaXMucHJvcHMuZ2V0TGluZUNvbG9yKSxcbiAgICAgIGdldEZpbGxDb2xvcjogdGhpcy5zZWxlY3Rpb25Bd2FyZUFjY2Vzc29yKHRoaXMucHJvcHMuZ2V0RmlsbENvbG9yKSxcbiAgICAgIGdldFJhZGl1czogdGhpcy5zZWxlY3Rpb25Bd2FyZUFjY2Vzc29yKHRoaXMucHJvcHMuZ2V0UmFkaXVzKSxcbiAgICAgIGdldExpbmVXaWR0aDogdGhpcy5zZWxlY3Rpb25Bd2FyZUFjY2Vzc29yKHRoaXMucHJvcHMuZ2V0TGluZVdpZHRoKSxcbiAgICAgIGdldExpbmVEYXNoQXJyYXk6IHRoaXMuc2VsZWN0aW9uQXdhcmVBY2Nlc3Nvcih0aGlzLnByb3BzLmdldExpbmVEYXNoQXJyYXkpLFxuXG4gICAgICB1cGRhdGVUcmlnZ2Vyczoge1xuICAgICAgICBnZXRMaW5lQ29sb3I6IFt0aGlzLnByb3BzLnNlbGVjdGVkRmVhdHVyZUluZGV4ZXMsIHRoaXMucHJvcHMubW9kZV0sXG4gICAgICAgIGdldEZpbGxDb2xvcjogW3RoaXMucHJvcHMuc2VsZWN0ZWRGZWF0dXJlSW5kZXhlcywgdGhpcy5wcm9wcy5tb2RlXSxcbiAgICAgICAgZ2V0UmFkaXVzOiBbdGhpcy5wcm9wcy5zZWxlY3RlZEZlYXR1cmVJbmRleGVzLCB0aGlzLnByb3BzLm1vZGVdLFxuICAgICAgICBnZXRMaW5lV2lkdGg6IFt0aGlzLnByb3BzLnNlbGVjdGVkRmVhdHVyZUluZGV4ZXMsIHRoaXMucHJvcHMubW9kZV0sXG4gICAgICAgIGdldExpbmVEYXNoQXJyYXk6IFt0aGlzLnByb3BzLnNlbGVjdGVkRmVhdHVyZUluZGV4ZXMsIHRoaXMucHJvcHMubW9kZV1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGxldCBsYXllcnMgPSBbbmV3IEdlb0pzb25MYXllcihzdWJMYXllclByb3BzKV07XG5cbiAgICBsYXllcnMgPSBsYXllcnMuY29uY2F0KHRoaXMuY3JlYXRlUG9pbnRMYXllcnMoKSk7XG4gICAgbGF5ZXJzID0gbGF5ZXJzLmNvbmNhdCh0aGlzLmNyZWF0ZURyYXdMYXllcnMoKSk7XG5cbiAgICByZXR1cm4gbGF5ZXJzO1xuICB9XG5cbiAgaW5pdGlhbGl6ZVN0YXRlKCkge1xuICAgIHN1cGVyLmluaXRpYWxpemVTdGF0ZSgpO1xuXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBlZGl0YWJsZUZlYXR1cmVDb2xsZWN0aW9uOiBudWxsLFxuICAgICAgc2VsZWN0ZWRGZWF0dXJlczogW10sXG4gICAgICBlZGl0SGFuZGxlczogW10sXG4gICAgICBkcmF3RmVhdHVyZTogbnVsbFxuICAgIH0pO1xuICB9XG5cbiAgLy8gVE9ETzogZmlndXJlIG91dCBob3cgdG8gcHJvcGVybHkgdXBkYXRlIHN0YXRlIGZyb20gYW4gb3V0c2lkZSBldmVudCBoYW5kbGVyXG4gIHNob3VsZFVwZGF0ZVN0YXRlKHsgcHJvcHMsIG9sZFByb3BzLCBjb250ZXh0LCBvbGRDb250ZXh0LCBjaGFuZ2VGbGFncyB9OiBPYmplY3QpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHVwZGF0ZVN0YXRlKHsgcHJvcHMsIG9sZFByb3BzLCBjaGFuZ2VGbGFncyB9OiBPYmplY3QpIHtcbiAgICBzdXBlci51cGRhdGVTdGF0ZSh7IHByb3BzLCBjaGFuZ2VGbGFncyB9KTtcblxuICAgIGxldCBlZGl0YWJsZUZlYXR1cmVDb2xsZWN0aW9uID0gdGhpcy5zdGF0ZS5lZGl0YWJsZUZlYXR1cmVDb2xsZWN0aW9uO1xuICAgIGlmIChjaGFuZ2VGbGFncy5kYXRhQ2hhbmdlZCkge1xuICAgICAgZWRpdGFibGVGZWF0dXJlQ29sbGVjdGlvbiA9IG5ldyBFZGl0YWJsZUZlYXR1cmVDb2xsZWN0aW9uKHByb3BzLmRhdGEpO1xuICAgIH1cblxuICAgIGxldCBzZWxlY3RlZEZlYXR1cmVzID0gW107XG4gICAgaWYgKEFycmF5LmlzQXJyYXkocHJvcHMuc2VsZWN0ZWRGZWF0dXJlSW5kZXhlcykpIHtcbiAgICAgIC8vIFRPRE86IG5lZWRzIGltcHJvdmVkIHRlc3RpbmcsIGkuZS4gY2hlY2tpbmcgZm9yIGR1cGxpY2F0ZXMsIE5hTnMsIG91dCBvZiByYW5nZSBudW1iZXJzLCAuLi5cbiAgICAgIHNlbGVjdGVkRmVhdHVyZXMgPSBwcm9wcy5zZWxlY3RlZEZlYXR1cmVJbmRleGVzLm1hcChlbGVtID0+IHByb3BzLmRhdGEuZmVhdHVyZXNbZWxlbV0pO1xuICAgIH1cblxuICAgIGxldCBlZGl0SGFuZGxlcyA9IFtdO1xuICAgIGlmIChzZWxlY3RlZEZlYXR1cmVzLmxlbmd0aCAmJiBwcm9wcy5tb2RlICE9PSAndmlldycpIHtcbiAgICAgIHByb3BzLnNlbGVjdGVkRmVhdHVyZUluZGV4ZXMuZm9yRWFjaChpbmRleCA9PiB7XG4gICAgICAgIGVkaXRIYW5kbGVzID0gZWRpdEhhbmRsZXMuY29uY2F0KGVkaXRhYmxlRmVhdHVyZUNvbGxlY3Rpb24uZ2V0RWRpdEhhbmRsZXMoaW5kZXgpKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGxldCBkcmF3RmVhdHVyZSA9IHRoaXMuc3RhdGUuZHJhd0ZlYXR1cmU7XG4gICAgaWYgKHByb3BzICE9PSBvbGRQcm9wcykge1xuICAgICAgLy8gSWYgdGhlIHByb3BzIGFyZSBkaWZmZXJlbnQsIHJlY2FsY3VsYXRlIHRoZSBkcmF3IGZlYXR1cmVcbiAgICAgIGNvbnN0IHNlbGVjdGVkRmVhdHVyZSA9IHNlbGVjdGVkRmVhdHVyZXMubGVuZ3RoID09PSAxID8gc2VsZWN0ZWRGZWF0dXJlc1swXSA6IG51bGw7XG4gICAgICBkcmF3RmVhdHVyZSA9IHRoaXMuZ2V0RHJhd0ZlYXR1cmUoc2VsZWN0ZWRGZWF0dXJlLCBwcm9wcy5tb2RlLCBudWxsKTtcbiAgICB9XG5cbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIGVkaXRhYmxlRmVhdHVyZUNvbGxlY3Rpb24sXG4gICAgICBzZWxlY3RlZEZlYXR1cmVzLFxuICAgICAgZWRpdEhhbmRsZXMsXG4gICAgICBkcmF3RmVhdHVyZVxuICAgIH0pO1xuICB9XG5cbiAgc2VsZWN0aW9uQXdhcmVBY2Nlc3NvcihhY2Nlc3NvcjogYW55KSB7XG4gICAgaWYgKHR5cGVvZiBhY2Nlc3NvciAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgcmV0dXJuIGFjY2Vzc29yO1xuICAgIH1cbiAgICByZXR1cm4gKGZlYXR1cmU6IE9iamVjdCkgPT4gYWNjZXNzb3IoZmVhdHVyZSwgdGhpcy5pc0ZlYXR1cmVTZWxlY3RlZChmZWF0dXJlKSwgdGhpcy5wcm9wcy5tb2RlKTtcbiAgfVxuXG4gIGlzRmVhdHVyZVNlbGVjdGVkKGZlYXR1cmU6IE9iamVjdCkge1xuICAgIGlmICghdGhpcy5wcm9wcy5kYXRhIHx8ICF0aGlzLnByb3BzLnNlbGVjdGVkRmVhdHVyZUluZGV4ZXMpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLnByb3BzLnNlbGVjdGVkRmVhdHVyZUluZGV4ZXMubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IGZlYXR1cmVJbmRleCA9IHRoaXMucHJvcHMuZGF0YS5mZWF0dXJlcy5pbmRleE9mKGZlYXR1cmUpO1xuICAgIHJldHVybiB0aGlzLnByb3BzLnNlbGVjdGVkRmVhdHVyZUluZGV4ZXMuaW5jbHVkZXMoZmVhdHVyZUluZGV4KTtcbiAgfVxuXG4gIGdldFBpY2tpbmdJbmZvKHsgaW5mbywgc291cmNlTGF5ZXIgfTogT2JqZWN0KSB7XG4gICAgaWYgKHNvdXJjZUxheWVyLmlkLmVuZHNXaXRoKCctZWRpdC1oYW5kbGVzJykpIHtcbiAgICAgIC8vIElmIHVzZXIgaXMgcGlja2luZyBhbiBlZGl0aW5nIGhhbmRsZSwgYWRkIGFkZGl0aW9uYWwgZGF0YSB0byB0aGUgaW5mb1xuICAgICAgaW5mby5pc0VkaXRpbmdIYW5kbGUgPSB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiBpbmZvO1xuICB9XG5cbiAgY3JlYXRlUG9pbnRMYXllcnMoKSB7XG4gICAgaWYgKCF0aGlzLnN0YXRlLmVkaXRIYW5kbGVzLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIGNvbnN0IHNoYXJlZFByb3BzID0ge1xuICAgICAgaWQ6IGAke3RoaXMucHJvcHMuZWRpdEhhbmRsZVR5cGV9LWVkaXQtaGFuZGxlc2AsXG4gICAgICBkYXRhOiB0aGlzLnN0YXRlLmVkaXRIYW5kbGVzLFxuICAgICAgZnA2NDogdGhpcy5wcm9wcy5mcDY0XG4gICAgfTtcblxuICAgIGNvbnN0IGxheWVyID1cbiAgICAgIHRoaXMucHJvcHMuZWRpdEhhbmRsZVR5cGUgPT09ICdpY29uJ1xuICAgICAgICA/IG5ldyBJY29uTGF5ZXIoXG4gICAgICAgICAgICB0aGlzLmdldFN1YkxheWVyUHJvcHMoe1xuICAgICAgICAgICAgICAuLi5zaGFyZWRQcm9wcyxcbiAgICAgICAgICAgICAgaWNvbkF0bGFzOiB0aGlzLnByb3BzLmVkaXRIYW5kbGVJY29uQXRsYXMsXG4gICAgICAgICAgICAgIGljb25NYXBwaW5nOiB0aGlzLnByb3BzLmVkaXRIYW5kbGVJY29uTWFwcGluZyxcbiAgICAgICAgICAgICAgc2l6ZVNjYWxlOiB0aGlzLnByb3BzLmVkaXRIYW5kbGVJY29uU2l6ZVNjYWxlLFxuICAgICAgICAgICAgICBnZXRJY29uOiB0aGlzLnByb3BzLmdldEVkaXRIYW5kbGVJY29uLFxuICAgICAgICAgICAgICBnZXRTaXplOiB0aGlzLnByb3BzLmdldEVkaXRIYW5kbGVJY29uU2l6ZSxcbiAgICAgICAgICAgICAgZ2V0Q29sb3I6IHRoaXMucHJvcHMuZ2V0RWRpdEhhbmRsZUljb25Db2xvcixcbiAgICAgICAgICAgICAgZ2V0QW5nbGU6IHRoaXMucHJvcHMuZ2V0RWRpdEhhbmRsZUljb25BbmdsZSxcblxuICAgICAgICAgICAgICBnZXRQb3NpdGlvbjogZCA9PiBkLnBvc2l0aW9uXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIClcbiAgICAgICAgOiB0aGlzLnByb3BzLmVkaXRIYW5kbGVUeXBlID09PSAncG9pbnQnXG4gICAgICAgICAgPyBuZXcgU2NhdHRlcnBsb3RMYXllcihcbiAgICAgICAgICAgICAgdGhpcy5nZXRTdWJMYXllclByb3BzKHtcbiAgICAgICAgICAgICAgICAuLi5zaGFyZWRQcm9wcyxcblxuICAgICAgICAgICAgICAgIC8vIFByb3h5IGVkaXRpbmcgcG9pbnQgcHJvcHNcbiAgICAgICAgICAgICAgICByYWRpdXNTY2FsZTogdGhpcy5wcm9wcy5lZGl0SGFuZGxlUG9pbnRSYWRpdXNTY2FsZSxcbiAgICAgICAgICAgICAgICBvdXRsaW5lOiB0aGlzLnByb3BzLmVkaXRIYW5kbGVQb2ludE91dGxpbmUsXG4gICAgICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IHRoaXMucHJvcHMuZWRpdEhhbmRsZVBvaW50U3Ryb2tlV2lkdGgsXG4gICAgICAgICAgICAgICAgcmFkaXVzTWluUGl4ZWxzOiB0aGlzLnByb3BzLmVkaXRIYW5kbGVQb2ludFJhZGl1c01pblBpeGVscyxcbiAgICAgICAgICAgICAgICByYWRpdXNNYXhQaXhlbHM6IHRoaXMucHJvcHMuZWRpdEhhbmRsZVBvaW50UmFkaXVzTWF4UGl4ZWxzLFxuICAgICAgICAgICAgICAgIGdldFJhZGl1czogdGhpcy5wcm9wcy5nZXRFZGl0SGFuZGxlUG9pbnRSYWRpdXMsXG4gICAgICAgICAgICAgICAgZ2V0Q29sb3I6IHRoaXMucHJvcHMuZ2V0RWRpdEhhbmRsZVBvaW50Q29sb3JcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICA6IG51bGw7XG5cbiAgICByZXR1cm4gW2xheWVyXTtcbiAgfVxuXG4gIGNyZWF0ZURyYXdMYXllcnMoKSB7XG4gICAgaWYgKCF0aGlzLnN0YXRlLmRyYXdGZWF0dXJlKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgY29uc3QgbGF5ZXIgPSBuZXcgR2VvSnNvbkxheWVyKFxuICAgICAgdGhpcy5nZXRTdWJMYXllclByb3BzKHtcbiAgICAgICAgaWQ6ICdkcmF3JyxcbiAgICAgICAgZGF0YTogdGhpcy5zdGF0ZS5kcmF3RmVhdHVyZSxcbiAgICAgICAgZnA2NDogdGhpcy5wcm9wcy5mcDY0LFxuICAgICAgICBwaWNrYWJsZTogZmFsc2UsXG4gICAgICAgIHN0cm9rZWQ6IHRoaXMucHJvcHMubW9kZSAhPT0gJ2RyYXdQb2x5Z29uJyxcbiAgICAgICAgYXV0b0hpZ2hsaWdodDogZmFsc2UsXG4gICAgICAgIGxpbmVXaWR0aFNjYWxlOiB0aGlzLnByb3BzLmxpbmVXaWR0aFNjYWxlLFxuICAgICAgICBsaW5lV2lkdGhNaW5QaXhlbHM6IHRoaXMucHJvcHMubGluZVdpZHRoTWluUGl4ZWxzLFxuICAgICAgICBsaW5lV2lkdGhNYXhQaXhlbHM6IHRoaXMucHJvcHMubGluZVdpZHRoTWF4UGl4ZWxzLFxuICAgICAgICBsaW5lSm9pbnRSb3VuZGVkOiB0aGlzLnByb3BzLmxpbmVKb2ludFJvdW5kZWQsXG4gICAgICAgIGxpbmVNaXRlckxpbWl0OiB0aGlzLnByb3BzLmxpbmVNaXRlckxpbWl0LFxuICAgICAgICBwb2ludFJhZGl1c1NjYWxlOiB0aGlzLnByb3BzLmVkaXRIYW5kbGVQb2ludFJhZGl1c1NjYWxlLFxuICAgICAgICBvdXRsaW5lOiB0aGlzLnByb3BzLmVkaXRIYW5kbGVQb2ludE91dGxpbmUsXG4gICAgICAgIHN0cm9rZVdpZHRoOiB0aGlzLnByb3BzLmVkaXRIYW5kbGVQb2ludFN0cm9rZVdpZHRoLFxuICAgICAgICBwb2ludFJhZGl1c01pblBpeGVsczogdGhpcy5wcm9wcy5lZGl0SGFuZGxlUG9pbnRSYWRpdXNNaW5QaXhlbHMsXG4gICAgICAgIHBvaW50UmFkaXVzTWF4UGl4ZWxzOiB0aGlzLnByb3BzLmVkaXRIYW5kbGVQb2ludFJhZGl1c01heFBpeGVscyxcbiAgICAgICAgZ2V0UmFkaXVzOiB0aGlzLnByb3BzLmdldEVkaXRIYW5kbGVQb2ludFJhZGl1cyxcbiAgICAgICAgZ2V0TGluZUNvbG9yOiBmZWF0dXJlID0+XG4gICAgICAgICAgdGhpcy5wcm9wcy5nZXREcmF3TGluZUNvbG9yKGZlYXR1cmUsIHRoaXMuc3RhdGUuc2VsZWN0ZWRGZWF0dXJlc1swXSwgdGhpcy5wcm9wcy5tb2RlKSxcbiAgICAgICAgZ2V0TGluZVdpZHRoOiBmZWF0dXJlID0+XG4gICAgICAgICAgdGhpcy5wcm9wcy5nZXREcmF3TGluZVdpZHRoKGZlYXR1cmUsIHRoaXMuc3RhdGUuc2VsZWN0ZWRGZWF0dXJlc1swXSwgdGhpcy5wcm9wcy5tb2RlKSxcbiAgICAgICAgZ2V0RmlsbENvbG9yOiBmZWF0dXJlID0+XG4gICAgICAgICAgdGhpcy5wcm9wcy5nZXREcmF3RmlsbENvbG9yKGZlYXR1cmUsIHRoaXMuc3RhdGUuc2VsZWN0ZWRGZWF0dXJlc1swXSwgdGhpcy5wcm9wcy5tb2RlKSxcbiAgICAgICAgZ2V0TGluZURhc2hBcnJheTogZmVhdHVyZSA9PlxuICAgICAgICAgIHRoaXMucHJvcHMuZ2V0RHJhd0xpbmVEYXNoQXJyYXkoZmVhdHVyZSwgdGhpcy5zdGF0ZS5zZWxlY3RlZEZlYXR1cmVzWzBdLCB0aGlzLnByb3BzLm1vZGUpXG4gICAgICB9KVxuICAgICk7XG5cbiAgICByZXR1cm4gW2xheWVyXTtcbiAgfVxuXG4gIG9uQ2xpY2soeyBwaWNrcywgc2NyZWVuQ29vcmRzLCBncm91bmRDb29yZHMgfTogT2JqZWN0KSB7XG4gICAgY29uc3QgeyBzZWxlY3RlZEZlYXR1cmVzIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IHsgc2VsZWN0ZWRGZWF0dXJlSW5kZXhlcyB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBlZGl0SGFuZGxlSW5mbyA9IHRoaXMuZ2V0UGlja2VkRWRpdEhhbmRsZShwaWNrcyk7XG5cbiAgICBpZiAodGhpcy5wcm9wcy5tb2RlID09PSAnbW9kaWZ5Jykge1xuICAgICAgaWYgKGVkaXRIYW5kbGVJbmZvICYmIGVkaXRIYW5kbGVJbmZvLm9iamVjdC50eXBlID09PSAnZXhpc3RpbmcnKSB7XG4gICAgICAgIHRoaXMuaGFuZGxlUmVtb3ZlUG9zaXRpb24oXG4gICAgICAgICAgdGhpcy5wcm9wcy5kYXRhLmZlYXR1cmVzW2VkaXRIYW5kbGVJbmZvLm9iamVjdC5mZWF0dXJlSW5kZXhdLFxuICAgICAgICAgIGVkaXRIYW5kbGVJbmZvLm9iamVjdC5mZWF0dXJlSW5kZXgsXG4gICAgICAgICAgZWRpdEhhbmRsZUluZm8ub2JqZWN0LnBvc2l0aW9uSW5kZXhlc1xuICAgICAgICApO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoXG4gICAgICB0aGlzLnByb3BzLm1vZGUgPT09ICdkcmF3TGluZVN0cmluZycgfHxcbiAgICAgIHRoaXMucHJvcHMubW9kZSA9PT0gJ2RyYXdQb2x5Z29uJyB8fFxuICAgICAgdGhpcy5wcm9wcy5tb2RlID09PSAnZHJhd1JlY3RhbmdsZScgfHxcbiAgICAgIHRoaXMucHJvcHMubW9kZSA9PT0gJ2RyYXdDaXJjbGUnXG4gICAgKSB7XG4gICAgICBpZiAoIXNlbGVjdGVkRmVhdHVyZXMubGVuZ3RoKSB7XG4gICAgICAgIHRoaXMuaGFuZGxlRHJhd05ld1BvaW50KGdyb3VuZENvb3Jkcyk7XG4gICAgICB9IGVsc2UgaWYgKHNlbGVjdGVkRmVhdHVyZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIC8vIGNhbiBvbmx5IGRyYXcgZmVhdHVyZSB3aGlsZSBvbmUgaXMgc2VsZWN0ZWRcbiAgICAgICAgaWYgKHRoaXMucHJvcHMubW9kZSA9PT0gJ2RyYXdMaW5lU3RyaW5nJykge1xuICAgICAgICAgIHRoaXMuaGFuZGxlRHJhd0xpbmVTdHJpbmcoXG4gICAgICAgICAgICBzZWxlY3RlZEZlYXR1cmVzWzBdLFxuICAgICAgICAgICAgc2VsZWN0ZWRGZWF0dXJlSW5kZXhlc1swXSxcbiAgICAgICAgICAgIGdyb3VuZENvb3JkcyxcbiAgICAgICAgICAgIHBpY2tzXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5wcm9wcy5tb2RlID09PSAnZHJhd1BvbHlnb24nKSB7XG4gICAgICAgICAgdGhpcy5oYW5kbGVEcmF3UG9seWdvbihcbiAgICAgICAgICAgIHNlbGVjdGVkRmVhdHVyZXNbMF0sXG4gICAgICAgICAgICBzZWxlY3RlZEZlYXR1cmVJbmRleGVzWzBdLFxuICAgICAgICAgICAgZ3JvdW5kQ29vcmRzLFxuICAgICAgICAgICAgcGlja3NcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnByb3BzLm1vZGUgPT09ICdkcmF3UmVjdGFuZ2xlJykge1xuICAgICAgICAgIHRoaXMuaGFuZGxlRHJhd1JlY3RhbmdsZShcbiAgICAgICAgICAgIHNlbGVjdGVkRmVhdHVyZXNbMF0sXG4gICAgICAgICAgICBzZWxlY3RlZEZlYXR1cmVJbmRleGVzWzBdLFxuICAgICAgICAgICAgZ3JvdW5kQ29vcmRzLFxuICAgICAgICAgICAgcGlja3NcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnByb3BzLm1vZGUgPT09ICdkcmF3Q2lyY2xlJykge1xuICAgICAgICAgIHRoaXMuaGFuZGxlRHJhd0NpcmNsZShcbiAgICAgICAgICAgIHNlbGVjdGVkRmVhdHVyZXNbMF0sXG4gICAgICAgICAgICBzZWxlY3RlZEZlYXR1cmVJbmRleGVzWzBdLFxuICAgICAgICAgICAgZ3JvdW5kQ29vcmRzLFxuICAgICAgICAgICAgcGlja3NcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgb25TdGFydERyYWdnaW5nKHtcbiAgICBwaWNrcyxcbiAgICBzY3JlZW5Db29yZHMsXG4gICAgZ3JvdW5kQ29vcmRzLFxuICAgIGRyYWdTdGFydFNjcmVlbkNvb3JkcyxcbiAgICBkcmFnU3RhcnRHcm91bmRDb29yZHNcbiAgfTogT2JqZWN0KSB7XG4gICAgY29uc3QgeyBzZWxlY3RlZEZlYXR1cmVzIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IGVkaXRIYW5kbGVJbmZvID0gdGhpcy5nZXRQaWNrZWRFZGl0SGFuZGxlKHBpY2tzKTtcblxuICAgIGlmICghc2VsZWN0ZWRGZWF0dXJlcy5sZW5ndGgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoZWRpdEhhbmRsZUluZm8pIHtcbiAgICAgIGlmIChlZGl0SGFuZGxlSW5mby5vYmplY3QudHlwZSA9PT0gJ2ludGVybWVkaWF0ZScpIHtcbiAgICAgICAgdGhpcy5oYW5kbGVBZGRJbnRlcm1lZGlhdGVQb3NpdGlvbihcbiAgICAgICAgICBlZGl0SGFuZGxlSW5mby5vYmplY3QuZmVhdHVyZUluZGV4LFxuICAgICAgICAgIGVkaXRIYW5kbGVJbmZvLm9iamVjdC5wb3NpdGlvbkluZGV4ZXMsXG4gICAgICAgICAgZ3JvdW5kQ29vcmRzXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgb25EcmFnZ2luZyh7XG4gICAgcGlja3MsXG4gICAgc2NyZWVuQ29vcmRzLFxuICAgIGdyb3VuZENvb3JkcyxcbiAgICBkcmFnU3RhcnRTY3JlZW5Db29yZHMsXG4gICAgZHJhZ1N0YXJ0R3JvdW5kQ29vcmRzXG4gIH06IE9iamVjdCkge1xuICAgIGNvbnN0IHsgc2VsZWN0ZWRGZWF0dXJlcyB9ID0gdGhpcy5zdGF0ZTtcblxuICAgIGlmICghc2VsZWN0ZWRGZWF0dXJlcy5sZW5ndGgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBlZGl0SGFuZGxlSW5mbyA9IHRoaXMuZ2V0UGlja2VkRWRpdEhhbmRsZShwaWNrcyk7XG4gICAgaWYgKGVkaXRIYW5kbGVJbmZvKSB7XG4gICAgICB0aGlzLmhhbmRsZU1vdmVQb3NpdGlvbihcbiAgICAgICAgZWRpdEhhbmRsZUluZm8ub2JqZWN0LmZlYXR1cmVJbmRleCxcbiAgICAgICAgZWRpdEhhbmRsZUluZm8ub2JqZWN0LnBvc2l0aW9uSW5kZXhlcyxcbiAgICAgICAgZ3JvdW5kQ29vcmRzXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIG9uU3RvcERyYWdnaW5nKHtcbiAgICBwaWNrcyxcbiAgICBzY3JlZW5Db29yZHMsXG4gICAgZ3JvdW5kQ29vcmRzLFxuICAgIGRyYWdTdGFydFNjcmVlbkNvb3JkcyxcbiAgICBkcmFnU3RhcnRHcm91bmRDb29yZHNcbiAgfTogT2JqZWN0KSB7XG4gICAgY29uc3QgeyBzZWxlY3RlZEZlYXR1cmVzIH0gPSB0aGlzLnN0YXRlO1xuXG4gICAgaWYgKCFzZWxlY3RlZEZlYXR1cmVzLmxlbmd0aCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGVkaXRIYW5kbGVJbmZvID0gdGhpcy5nZXRQaWNrZWRFZGl0SGFuZGxlKHBpY2tzKTtcblxuICAgIGlmIChlZGl0SGFuZGxlSW5mbykge1xuICAgICAgdGhpcy5oYW5kbGVGaW5pc2hNb3ZlUG9zaXRpb24oXG4gICAgICAgIGVkaXRIYW5kbGVJbmZvLm9iamVjdC5mZWF0dXJlSW5kZXgsXG4gICAgICAgIGVkaXRIYW5kbGVJbmZvLm9iamVjdC5wb3NpdGlvbkluZGV4ZXMsXG4gICAgICAgIGdyb3VuZENvb3Jkc1xuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBvblBvaW50ZXJNb3ZlKHsgc2NyZWVuQ29vcmRzLCBncm91bmRDb29yZHMsIGlzRHJhZ2dpbmcsIHBvaW50ZXJEb3duUGlja3MsIHNvdXJjZUV2ZW50IH06IE9iamVjdCkge1xuICAgIGlmIChcbiAgICAgIHRoaXMucHJvcHMubW9kZSA9PT0gJ2RyYXdMaW5lU3RyaW5nJyB8fFxuICAgICAgdGhpcy5wcm9wcy5tb2RlID09PSAnZHJhd1BvbHlnb24nIHx8XG4gICAgICB0aGlzLnByb3BzLm1vZGUgPT09ICdkcmF3UmVjdGFuZ2xlJyB8fFxuICAgICAgdGhpcy5wcm9wcy5tb2RlID09PSAnZHJhd0NpcmNsZSdcbiAgICApIHtcbiAgICAgIGNvbnN0IHNlbGVjdGVkRmVhdHVyZSA9XG4gICAgICAgIHRoaXMuc3RhdGUuc2VsZWN0ZWRGZWF0dXJlcy5sZW5ndGggPT09IDEgPyB0aGlzLnN0YXRlLnNlbGVjdGVkRmVhdHVyZXNbMF0gOiBudWxsO1xuICAgICAgY29uc3QgZHJhd0ZlYXR1cmUgPSB0aGlzLmdldERyYXdGZWF0dXJlKHNlbGVjdGVkRmVhdHVyZSwgdGhpcy5wcm9wcy5tb2RlLCBncm91bmRDb29yZHMpO1xuXG4gICAgICB0aGlzLnNldFN0YXRlKHsgZHJhd0ZlYXR1cmUgfSk7XG5cbiAgICAgIC8vIFRPRE86IGZpZ3VyZSBvdXQgaG93IHRvIHByb3Blcmx5IHVwZGF0ZSBzdGF0ZSBmcm9tIGEgcG9pbnRlciBldmVudCBoYW5kbGVyXG4gICAgICB0aGlzLnNldExheWVyTmVlZHNVcGRhdGUoKTtcbiAgICB9XG5cbiAgICBpZiAocG9pbnRlckRvd25QaWNrcyAmJiBwb2ludGVyRG93blBpY2tzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IGVkaXRIYW5kbGVJbmZvID0gdGhpcy5nZXRQaWNrZWRFZGl0SGFuZGxlKHBvaW50ZXJEb3duUGlja3MpO1xuICAgICAgaWYgKGVkaXRIYW5kbGVJbmZvKSB7XG4gICAgICAgIC8vIFRPRE86IGZpbmQgYSBsZXNzIGhhY2t5IHdheSB0byBwcmV2ZW50IG1hcCBwYW5uaW5nXG4gICAgICAgIC8vIFN0b3AgcHJvcGFnYXRpb24gdG8gcHJldmVudCBtYXAgcGFubmluZyB3aGlsZSBkcmFnZ2luZyBhbiBlZGl0IGhhbmRsZVxuICAgICAgICBzb3VyY2VFdmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBnZXREcmF3RmVhdHVyZShzZWxlY3RlZEZlYXR1cmU6ID9HZW9Kc29uRmVhdHVyZSwgbW9kZTogc3RyaW5nLCBncm91bmRDb29yZHM6ID8obnVtYmVyW10pKSB7XG4gICAgbGV0IGRyYXdGZWF0dXJlID0gbnVsbDtcblxuICAgIGlmICghc2VsZWN0ZWRGZWF0dXJlICYmICFncm91bmRDb29yZHMpIHtcbiAgICAgIC8vIE5lZWQgYSBtb3VzZSBwb3NpdGlvbiBpbiBvcmRlciB0byBkcmF3IGEgc2luZ2xlIHBvaW50XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBpZiAoIXNlbGVjdGVkRmVhdHVyZSkge1xuICAgICAgLy8gU3RhcnQgd2l0aCBhIHBvaW50XG4gICAgICBkcmF3RmVhdHVyZSA9IHtcbiAgICAgICAgdHlwZTogJ0ZlYXR1cmUnLFxuICAgICAgICBnZW9tZXRyeToge1xuICAgICAgICAgIHR5cGU6ICdQb2ludCcsXG4gICAgICAgICAgY29vcmRpbmF0ZXM6IGdyb3VuZENvb3Jkc1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH0gZWxzZSBpZiAoc2VsZWN0ZWRGZWF0dXJlLmdlb21ldHJ5LnR5cGUgPT09ICdQb2ludCcpIHtcbiAgICAgIGlmIChtb2RlID09PSAnZHJhd0xpbmVTdHJpbmcnIHx8IG1vZGUgPT09ICdkcmF3UG9seWdvbicpIHtcbiAgICAgICAgLy8gRHJhdyBhbiBleHRlbnNpb24gbGluZSBzdGFydGluZyBmcm9tIHRoZSBwb2ludFxuICAgICAgICBjb25zdCBzdGFydFBvc2l0aW9uID0gc2VsZWN0ZWRGZWF0dXJlLmdlb21ldHJ5LmNvb3JkaW5hdGVzO1xuICAgICAgICBjb25zdCBlbmRQb3NpdGlvbiA9IGdyb3VuZENvb3JkcyB8fCBzdGFydFBvc2l0aW9uO1xuXG4gICAgICAgIGRyYXdGZWF0dXJlID0ge1xuICAgICAgICAgIHR5cGU6ICdGZWF0dXJlJyxcbiAgICAgICAgICBnZW9tZXRyeToge1xuICAgICAgICAgICAgdHlwZTogJ0xpbmVTdHJpbmcnLFxuICAgICAgICAgICAgY29vcmRpbmF0ZXM6IFtzdGFydFBvc2l0aW9uLCBlbmRQb3NpdGlvbl1cbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9IGVsc2UgaWYgKG1vZGUgPT09ICdkcmF3UmVjdGFuZ2xlJykge1xuICAgICAgICBjb25zdCBjb3JuZXIxID0gKChzZWxlY3RlZEZlYXR1cmUuZ2VvbWV0cnkuY29vcmRpbmF0ZXM6IGFueSk6IEFycmF5PG51bWJlcj4pO1xuICAgICAgICBjb25zdCBjb3JuZXIyID0gZ3JvdW5kQ29vcmRzIHx8IGNvcm5lcjE7XG4gICAgICAgIGNvbnN0IG1pblggPSBNYXRoLm1pbihjb3JuZXIxWzBdLCBjb3JuZXIyWzBdKTtcbiAgICAgICAgY29uc3QgbWluWSA9IE1hdGgubWluKGNvcm5lcjFbMV0sIGNvcm5lcjJbMV0pO1xuICAgICAgICBjb25zdCBtYXhYID0gTWF0aC5tYXgoY29ybmVyMVswXSwgY29ybmVyMlswXSk7XG4gICAgICAgIGNvbnN0IG1heFkgPSBNYXRoLm1heChjb3JuZXIxWzFdLCBjb3JuZXIyWzFdKTtcblxuICAgICAgICBkcmF3RmVhdHVyZSA9IGJib3hQb2x5Z29uKFttaW5YLCBtaW5ZLCBtYXhYLCBtYXhZXSk7XG4gICAgICB9IGVsc2UgaWYgKG1vZGUgPT09ICdkcmF3Q2lyY2xlJykge1xuICAgICAgICBjb25zdCBjZW50ZXIgPSAoKHNlbGVjdGVkRmVhdHVyZS5nZW9tZXRyeS5jb29yZGluYXRlczogYW55KTogQXJyYXk8bnVtYmVyPik7XG4gICAgICAgIGNvbnN0IHJhZGl1cyA9IE1hdGgubWF4KGRpc3RhbmNlKHNlbGVjdGVkRmVhdHVyZSwgZ3JvdW5kQ29vcmRzIHx8IGNlbnRlciksIDAuMDAxKTtcbiAgICAgICAgZHJhd0ZlYXR1cmUgPSBjaXJjbGUoY2VudGVyLCByYWRpdXMpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoc2VsZWN0ZWRGZWF0dXJlLmdlb21ldHJ5LnR5cGUgPT09ICdMaW5lU3RyaW5nJykge1xuICAgICAgY29uc3QgbGFzdFBvc2l0aW9uT2ZMaW5lU3RyaW5nID1cbiAgICAgICAgc2VsZWN0ZWRGZWF0dXJlLmdlb21ldHJ5LmNvb3JkaW5hdGVzW3NlbGVjdGVkRmVhdHVyZS5nZW9tZXRyeS5jb29yZGluYXRlcy5sZW5ndGggLSAxXTtcbiAgICAgIGNvbnN0IGN1cnJlbnRQb3NpdGlvbiA9IGdyb3VuZENvb3JkcyB8fCBsYXN0UG9zaXRpb25PZkxpbmVTdHJpbmc7XG5cbiAgICAgIGlmIChtb2RlID09PSAnZHJhd0xpbmVTdHJpbmcnKSB7XG4gICAgICAgIC8vIERyYXcgYSBzaW5nbGUgbGluZSBleHRlbmRpbmcgYmV5b25kIHRoZSBsYXN0IHBvaW50XG5cbiAgICAgICAgZHJhd0ZlYXR1cmUgPSB7XG4gICAgICAgICAgdHlwZTogJ0ZlYXR1cmUnLFxuICAgICAgICAgIGdlb21ldHJ5OiB7XG4gICAgICAgICAgICB0eXBlOiAnTGluZVN0cmluZycsXG4gICAgICAgICAgICBjb29yZGluYXRlczogW2xhc3RQb3NpdGlvbk9mTGluZVN0cmluZywgY3VycmVudFBvc2l0aW9uXVxuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSBpZiAobW9kZSA9PT0gJ2RyYXdQb2x5Z29uJykge1xuICAgICAgICAvLyBSZXF1aXJlcyB0d28gZmVhdHVyZXMsIGEgbm9uLXN0cm9rZWQgcG9seWdvbiBmb3IgZmlsbCBhbmQgYVxuICAgICAgICAvLyBsaW5lIHN0cmluZyBmb3IgdGhlIGRyYXdpbmcgZmVhdHVyZVxuICAgICAgICBkcmF3RmVhdHVyZSA9IHtcbiAgICAgICAgICB0eXBlOiAnRmVhdHVyZUNvbGxlY3Rpb24nLFxuICAgICAgICAgIGZlYXR1cmVzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHR5cGU6ICdGZWF0dXJlJyxcbiAgICAgICAgICAgICAgZ2VvbWV0cnk6IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnUG9seWdvbicsXG4gICAgICAgICAgICAgICAgY29vcmRpbmF0ZXM6IFtcbiAgICAgICAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICAgICAgLy8gRHJhdyBhIHBvbHlnb24gY29udGFpbmluZyBhbGwgdGhlIHBvaW50cyBvZiB0aGUgTGluZVN0cmluZyxcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhlbiB0aGUgbW91c2UgcG9zaXRpb24sXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoZW4gYmFjayB0byB0aGUgc3RhcnRpbmcgcG9zaXRpb25cbiAgICAgICAgICAgICAgICAgICAgLi4uc2VsZWN0ZWRGZWF0dXJlLmdlb21ldHJ5LmNvb3JkaW5hdGVzLFxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50UG9zaXRpb24sXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkRmVhdHVyZS5nZW9tZXRyeS5jb29yZGluYXRlc1swXVxuICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdHlwZTogJ0ZlYXR1cmUnLFxuICAgICAgICAgICAgICBnZW9tZXRyeToge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdMaW5lU3RyaW5nJyxcbiAgICAgICAgICAgICAgICBjb29yZGluYXRlczogW1xuICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRGZWF0dXJlLmdlb21ldHJ5LmNvb3JkaW5hdGVzW1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEZlYXR1cmUuZ2VvbWV0cnkuY29vcmRpbmF0ZXMubGVuZ3RoIC0gMVxuICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgIGN1cnJlbnRQb3NpdGlvbixcbiAgICAgICAgICAgICAgICAgIHNlbGVjdGVkRmVhdHVyZS5nZW9tZXRyeS5jb29yZGluYXRlc1swXVxuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIF1cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGRyYXdGZWF0dXJlO1xuICB9XG5cbiAgaGFuZGxlTW92ZVBvc2l0aW9uKGZlYXR1cmVJbmRleDogbnVtYmVyLCBwb3NpdGlvbkluZGV4ZXM6IG51bWJlciwgZ3JvdW5kQ29vcmRzOiBudW1iZXJbXSkge1xuICAgIGNvbnN0IHVwZGF0ZWREYXRhID0gdGhpcy5zdGF0ZS5lZGl0YWJsZUZlYXR1cmVDb2xsZWN0aW9uXG4gICAgICAucmVwbGFjZVBvc2l0aW9uKGZlYXR1cmVJbmRleCwgcG9zaXRpb25JbmRleGVzLCBncm91bmRDb29yZHMpXG4gICAgICAuZ2V0T2JqZWN0KCk7XG5cbiAgICB0aGlzLnByb3BzLm9uRWRpdCh7XG4gICAgICB1cGRhdGVkRGF0YSxcbiAgICAgIHVwZGF0ZWRNb2RlOiB0aGlzLnByb3BzLm1vZGUsXG4gICAgICB1cGRhdGVkU2VsZWN0ZWRGZWF0dXJlSW5kZXhlczogdGhpcy5wcm9wcy5zZWxlY3RlZEZlYXR1cmVJbmRleGVzLFxuICAgICAgZWRpdFR5cGU6ICdtb3ZlUG9zaXRpb24nLFxuICAgICAgZmVhdHVyZUluZGV4LFxuICAgICAgcG9zaXRpb25JbmRleGVzLFxuICAgICAgcG9zaXRpb246IGdyb3VuZENvb3Jkc1xuICAgIH0pO1xuICB9XG5cbiAgaGFuZGxlRmluaXNoTW92ZVBvc2l0aW9uKGZlYXR1cmVJbmRleDogbnVtYmVyLCBwb3NpdGlvbkluZGV4ZXM6IG51bWJlciwgZ3JvdW5kQ29vcmRzOiBudW1iZXJbXSkge1xuICAgIGNvbnN0IHVwZGF0ZWREYXRhID0gdGhpcy5zdGF0ZS5lZGl0YWJsZUZlYXR1cmVDb2xsZWN0aW9uXG4gICAgICAucmVwbGFjZVBvc2l0aW9uKGZlYXR1cmVJbmRleCwgcG9zaXRpb25JbmRleGVzLCBncm91bmRDb29yZHMpXG4gICAgICAuZ2V0T2JqZWN0KCk7XG5cbiAgICB0aGlzLnByb3BzLm9uRWRpdCh7XG4gICAgICB1cGRhdGVkRGF0YSxcbiAgICAgIHVwZGF0ZWRNb2RlOiB0aGlzLnByb3BzLm1vZGUsXG4gICAgICB1cGRhdGVkU2VsZWN0ZWRGZWF0dXJlSW5kZXhlczogdGhpcy5wcm9wcy5zZWxlY3RlZEZlYXR1cmVJbmRleGVzLFxuICAgICAgZWRpdFR5cGU6ICdmaW5pc2hNb3ZlUG9zaXRpb24nLFxuICAgICAgZmVhdHVyZUluZGV4LFxuICAgICAgcG9zaXRpb25JbmRleGVzLFxuICAgICAgcG9zaXRpb246IGdyb3VuZENvb3Jkc1xuICAgIH0pO1xuICB9XG5cbiAgaGFuZGxlQWRkSW50ZXJtZWRpYXRlUG9zaXRpb24oXG4gICAgZmVhdHVyZUluZGV4OiBudW1iZXIsXG4gICAgcG9zaXRpb25JbmRleGVzOiBudW1iZXIsXG4gICAgZ3JvdW5kQ29vcmRzOiBudW1iZXJbXVxuICApIHtcbiAgICBjb25zdCB1cGRhdGVkRGF0YSA9IHRoaXMuc3RhdGUuZWRpdGFibGVGZWF0dXJlQ29sbGVjdGlvblxuICAgICAgLmFkZFBvc2l0aW9uKGZlYXR1cmVJbmRleCwgcG9zaXRpb25JbmRleGVzLCBncm91bmRDb29yZHMpXG4gICAgICAuZ2V0T2JqZWN0KCk7XG5cbiAgICB0aGlzLnByb3BzLm9uRWRpdCh7XG4gICAgICB1cGRhdGVkRGF0YSxcbiAgICAgIHVwZGF0ZWRNb2RlOiB0aGlzLnByb3BzLm1vZGUsXG4gICAgICB1cGRhdGVkU2VsZWN0ZWRGZWF0dXJlSW5kZXhlczogdGhpcy5wcm9wcy5zZWxlY3RlZEZlYXR1cmVJbmRleGVzLFxuICAgICAgZWRpdFR5cGU6ICdhZGRQb3NpdGlvbicsXG4gICAgICBmZWF0dXJlSW5kZXgsXG4gICAgICBwb3NpdGlvbkluZGV4ZXMsXG4gICAgICBwb3NpdGlvbjogZ3JvdW5kQ29vcmRzXG4gICAgfSk7XG4gIH1cblxuICBoYW5kbGVSZW1vdmVQb3NpdGlvbihcbiAgICBzZWxlY3RlZEZlYXR1cmU6IEdlb0pzb25GZWF0dXJlLFxuICAgIGZlYXR1cmVJbmRleDogbnVtYmVyLFxuICAgIHBvc2l0aW9uSW5kZXhlczogbnVtYmVyXG4gICkge1xuICAgIGxldCB1cGRhdGVkRGF0YTtcbiAgICB0cnkge1xuICAgICAgdXBkYXRlZERhdGEgPSB0aGlzLnN0YXRlLmVkaXRhYmxlRmVhdHVyZUNvbGxlY3Rpb25cbiAgICAgICAgLnJlbW92ZVBvc2l0aW9uKGZlYXR1cmVJbmRleCwgcG9zaXRpb25JbmRleGVzKVxuICAgICAgICAuZ2V0T2JqZWN0KCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIC8vIFRoaXMgaGFwcGVucyBpZiB1c2VyIGF0dGVtcHRzIHRvIHJlbW92ZSB0aGUgbGFzdCBwb2ludFxuICAgIH1cblxuICAgIGlmICh1cGRhdGVkRGF0YSkge1xuICAgICAgdGhpcy5wcm9wcy5vbkVkaXQoe1xuICAgICAgICB1cGRhdGVkRGF0YSxcbiAgICAgICAgdXBkYXRlZE1vZGU6IHRoaXMucHJvcHMubW9kZSxcbiAgICAgICAgdXBkYXRlZFNlbGVjdGVkRmVhdHVyZUluZGV4ZXM6IHRoaXMucHJvcHMuc2VsZWN0ZWRGZWF0dXJlSW5kZXhlcyxcbiAgICAgICAgZWRpdFR5cGU6ICdyZW1vdmVQb3NpdGlvbicsXG4gICAgICAgIGZlYXR1cmVJbmRleCxcbiAgICAgICAgcG9zaXRpb25JbmRleGVzXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBoYW5kbGVEcmF3TGluZVN0cmluZyhcbiAgICBzZWxlY3RlZEZlYXR1cmU6IEdlb0pzb25GZWF0dXJlLFxuICAgIGZlYXR1cmVJbmRleDogbnVtYmVyLFxuICAgIGdyb3VuZENvb3JkczogbnVtYmVyW10sXG4gICAgcGlja3M6IE9iamVjdFtdXG4gICkge1xuICAgIGxldCBmZWF0dXJlQ29sbGVjdGlvbiA9IHRoaXMuc3RhdGUuZWRpdGFibGVGZWF0dXJlQ29sbGVjdGlvbjtcbiAgICBsZXQgcG9zaXRpb25JbmRleGVzO1xuXG4gICAgaWYgKHNlbGVjdGVkRmVhdHVyZS5nZW9tZXRyeS50eXBlID09PSAnUG9pbnQnKSB7XG4gICAgICBwb3NpdGlvbkluZGV4ZXMgPSBbMV07XG5cbiAgICAgIC8vIFVwZ3JhZGUgZnJvbSBQb2ludCB0byBMaW5lU3RyaW5nXG4gICAgICBmZWF0dXJlQ29sbGVjdGlvbiA9IGZlYXR1cmVDb2xsZWN0aW9uLnJlcGxhY2VHZW9tZXRyeShmZWF0dXJlSW5kZXgsIHtcbiAgICAgICAgdHlwZTogJ0xpbmVTdHJpbmcnLFxuICAgICAgICBjb29yZGluYXRlczogW3NlbGVjdGVkRmVhdHVyZS5nZW9tZXRyeS5jb29yZGluYXRlcywgZ3JvdW5kQ29vcmRzXVxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChzZWxlY3RlZEZlYXR1cmUuZ2VvbWV0cnkudHlwZSA9PT0gJ0xpbmVTdHJpbmcnKSB7XG4gICAgICBwb3NpdGlvbkluZGV4ZXMgPSBbc2VsZWN0ZWRGZWF0dXJlLmdlb21ldHJ5LmNvb3JkaW5hdGVzLmxlbmd0aF07XG4gICAgICBmZWF0dXJlQ29sbGVjdGlvbiA9IGZlYXR1cmVDb2xsZWN0aW9uLmFkZFBvc2l0aW9uKFxuICAgICAgICBmZWF0dXJlSW5kZXgsXG4gICAgICAgIHBvc2l0aW9uSW5kZXhlcyxcbiAgICAgICAgZ3JvdW5kQ29vcmRzXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLndhcm4oYFVuc3VwcG9ydGVkIGdlb21ldHJ5IHR5cGU6ICR7c2VsZWN0ZWRGZWF0dXJlLmdlb21ldHJ5LnR5cGV9YCk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCB1cGRhdGVkRGF0YSA9IGZlYXR1cmVDb2xsZWN0aW9uLmdldE9iamVjdCgpO1xuXG4gICAgdGhpcy5wcm9wcy5vbkVkaXQoe1xuICAgICAgdXBkYXRlZERhdGEsXG4gICAgICB1cGRhdGVkTW9kZTogdGhpcy5wcm9wcy5tb2RlLFxuICAgICAgdXBkYXRlZFNlbGVjdGVkRmVhdHVyZUluZGV4ZXM6IHRoaXMucHJvcHMuc2VsZWN0ZWRGZWF0dXJlSW5kZXhlcyxcbiAgICAgIGVkaXRUeXBlOiAnYWRkUG9zaXRpb24nLFxuICAgICAgZmVhdHVyZUluZGV4LFxuICAgICAgcG9zaXRpb25JbmRleGVzLFxuICAgICAgcG9zaXRpb246IGdyb3VuZENvb3Jkc1xuICAgIH0pO1xuICB9XG5cbiAgaGFuZGxlRHJhd1BvbHlnb24oXG4gICAgc2VsZWN0ZWRGZWF0dXJlOiBHZW9Kc29uRmVhdHVyZSxcbiAgICBmZWF0dXJlSW5kZXg6IG51bWJlcixcbiAgICBncm91bmRDb29yZHM6IG51bWJlcltdLFxuICAgIHBpY2tzOiBPYmplY3RbXVxuICApIHtcbiAgICBsZXQgZmVhdHVyZUNvbGxlY3Rpb24gPSB0aGlzLnN0YXRlLmVkaXRhYmxlRmVhdHVyZUNvbGxlY3Rpb247XG4gICAgbGV0IHBvc2l0aW9uSW5kZXhlcztcblxuICAgIGxldCB1cGRhdGVkTW9kZSA9IHRoaXMucHJvcHMubW9kZTtcblxuICAgIGlmIChzZWxlY3RlZEZlYXR1cmUuZ2VvbWV0cnkudHlwZSA9PT0gJ1BvaW50Jykge1xuICAgICAgcG9zaXRpb25JbmRleGVzID0gWzFdO1xuICAgICAgLy8gVXBncmFkZSBmcm9tIFBvaW50IHRvIExpbmVTdHJpbmdcbiAgICAgIGZlYXR1cmVDb2xsZWN0aW9uID0gZmVhdHVyZUNvbGxlY3Rpb24ucmVwbGFjZUdlb21ldHJ5KGZlYXR1cmVJbmRleCwge1xuICAgICAgICB0eXBlOiAnTGluZVN0cmluZycsXG4gICAgICAgIGNvb3JkaW5hdGVzOiBbc2VsZWN0ZWRGZWF0dXJlLmdlb21ldHJ5LmNvb3JkaW5hdGVzLCBncm91bmRDb29yZHNdXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKHNlbGVjdGVkRmVhdHVyZS5nZW9tZXRyeS50eXBlID09PSAnTGluZVN0cmluZycpIHtcbiAgICAgIGNvbnN0IHBpY2tlZEhhbmRsZUluZm8gPSB0aGlzLmdldFBpY2tlZEVkaXRIYW5kbGUocGlja3MpO1xuICAgICAgaWYgKFxuICAgICAgICBwaWNrZWRIYW5kbGVJbmZvICYmXG4gICAgICAgIHBpY2tlZEhhbmRsZUluZm8ub2JqZWN0LnBvc2l0aW9uSW5kZXhlc1swXSA9PT0gMCAmJlxuICAgICAgICBzZWxlY3RlZEZlYXR1cmUuZ2VvbWV0cnkuY29vcmRpbmF0ZXMubGVuZ3RoID4gMlxuICAgICAgKSB7XG4gICAgICAgIC8vIFRoZXkgY2xpY2tlZCB0aGUgZmlyc3QgcG9zaXRpb24gb2YgdGhlIExpbmVTdHJpbmcsIHNvIGNsb3NlIHRoZSBwb2x5Z29uXG4gICAgICAgIGZlYXR1cmVDb2xsZWN0aW9uID0gZmVhdHVyZUNvbGxlY3Rpb24ucmVwbGFjZUdlb21ldHJ5KGZlYXR1cmVJbmRleCwge1xuICAgICAgICAgIHR5cGU6ICdQb2x5Z29uJyxcbiAgICAgICAgICBjb29yZGluYXRlczogW1xuICAgICAgICAgICAgWy4uLnNlbGVjdGVkRmVhdHVyZS5nZW9tZXRyeS5jb29yZGluYXRlcywgc2VsZWN0ZWRGZWF0dXJlLmdlb21ldHJ5LmNvb3JkaW5hdGVzWzBdXVxuICAgICAgICAgIF1cbiAgICAgICAgfSk7XG4gICAgICAgIHVwZGF0ZWRNb2RlID0gJ21vZGlmeSc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBBZGQgYW5vdGhlciBwb2ludCBhbG9uZyB0aGUgTGluZVN0cmluZ1xuICAgICAgICBwb3NpdGlvbkluZGV4ZXMgPSBbc2VsZWN0ZWRGZWF0dXJlLmdlb21ldHJ5LmNvb3JkaW5hdGVzLmxlbmd0aF07XG4gICAgICAgIGZlYXR1cmVDb2xsZWN0aW9uID0gZmVhdHVyZUNvbGxlY3Rpb24uYWRkUG9zaXRpb24oXG4gICAgICAgICAgZmVhdHVyZUluZGV4LFxuICAgICAgICAgIHBvc2l0aW9uSW5kZXhlcyxcbiAgICAgICAgICBncm91bmRDb29yZHNcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKGBVbnN1cHBvcnRlZCBnZW9tZXRyeSB0eXBlOiAke3NlbGVjdGVkRmVhdHVyZS5nZW9tZXRyeS50eXBlfWApOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgdXBkYXRlZERhdGEgPSBmZWF0dXJlQ29sbGVjdGlvbi5nZXRPYmplY3QoKTtcblxuICAgIHRoaXMucHJvcHMub25FZGl0KHtcbiAgICAgIHVwZGF0ZWREYXRhLFxuICAgICAgdXBkYXRlZE1vZGUsXG4gICAgICB1cGRhdGVkU2VsZWN0ZWRGZWF0dXJlSW5kZXhlczogdGhpcy5wcm9wcy5zZWxlY3RlZEZlYXR1cmVJbmRleGVzLFxuICAgICAgZWRpdFR5cGU6ICdhZGRQb3NpdGlvbicsXG4gICAgICBmZWF0dXJlSW5kZXgsXG4gICAgICBwb3NpdGlvbkluZGV4ZXMsXG4gICAgICBwb3NpdGlvbjogZ3JvdW5kQ29vcmRzXG4gICAgfSk7XG4gIH1cblxuICBoYW5kbGVEcmF3UmVjdGFuZ2xlKFxuICAgIHNlbGVjdGVkRmVhdHVyZTogR2VvSnNvbkZlYXR1cmUsXG4gICAgZmVhdHVyZUluZGV4OiBudW1iZXIsXG4gICAgZ3JvdW5kQ29vcmRzOiBudW1iZXJbXSxcbiAgICBwaWNrczogT2JqZWN0W11cbiAgKSB7XG4gICAgbGV0IGZlYXR1cmVDb2xsZWN0aW9uID0gdGhpcy5zdGF0ZS5lZGl0YWJsZUZlYXR1cmVDb2xsZWN0aW9uO1xuICAgIGxldCBwb3NpdGlvbkluZGV4ZXM7XG5cbiAgICBsZXQgdXBkYXRlZE1vZGUgPSB0aGlzLnByb3BzLm1vZGU7XG5cbiAgICBpZiAoc2VsZWN0ZWRGZWF0dXJlLmdlb21ldHJ5LnR5cGUgPT09ICdQb2ludCcpIHtcbiAgICAgIHBvc2l0aW9uSW5kZXhlcyA9IG51bGw7XG4gICAgICBmZWF0dXJlQ29sbGVjdGlvbiA9IGZlYXR1cmVDb2xsZWN0aW9uLnJlcGxhY2VHZW9tZXRyeShcbiAgICAgICAgZmVhdHVyZUluZGV4LFxuICAgICAgICB0aGlzLnN0YXRlLmRyYXdGZWF0dXJlLmdlb21ldHJ5XG4gICAgICApO1xuICAgICAgdXBkYXRlZE1vZGUgPSAnbW9kaWZ5JztcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKGBVbnN1cHBvcnRlZCBnZW9tZXRyeSB0eXBlOiAke3NlbGVjdGVkRmVhdHVyZS5nZW9tZXRyeS50eXBlfWApOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgdXBkYXRlZERhdGEgPSBmZWF0dXJlQ29sbGVjdGlvbi5nZXRPYmplY3QoKTtcblxuICAgIHRoaXMucHJvcHMub25FZGl0KHtcbiAgICAgIHVwZGF0ZWREYXRhLFxuICAgICAgdXBkYXRlZE1vZGUsXG4gICAgICB1cGRhdGVkU2VsZWN0ZWRGZWF0dXJlSW5kZXhlczogdGhpcy5wcm9wcy5zZWxlY3RlZEZlYXR1cmVJbmRleGVzLFxuICAgICAgZWRpdFR5cGU6ICdhZGRQb3NpdGlvbicsXG4gICAgICBmZWF0dXJlSW5kZXgsXG4gICAgICBwb3NpdGlvbkluZGV4ZXMsXG4gICAgICBwb3NpdGlvbjogZ3JvdW5kQ29vcmRzXG4gICAgfSk7XG4gIH1cblxuICBoYW5kbGVEcmF3Q2lyY2xlKFxuICAgIHNlbGVjdGVkRmVhdHVyZTogR2VvSnNvbkZlYXR1cmUsXG4gICAgZmVhdHVyZUluZGV4OiBudW1iZXIsXG4gICAgZ3JvdW5kQ29vcmRzOiBudW1iZXJbXSxcbiAgICBwaWNrczogT2JqZWN0W11cbiAgKSB7XG4gICAgbGV0IGZlYXR1cmVDb2xsZWN0aW9uID0gdGhpcy5zdGF0ZS5lZGl0YWJsZUZlYXR1cmVDb2xsZWN0aW9uO1xuICAgIGxldCBwb3NpdGlvbkluZGV4ZXM7XG5cbiAgICBsZXQgdXBkYXRlZE1vZGUgPSB0aGlzLnByb3BzLm1vZGU7XG5cbiAgICBpZiAoc2VsZWN0ZWRGZWF0dXJlLmdlb21ldHJ5LnR5cGUgPT09ICdQb2ludCcpIHtcbiAgICAgIHBvc2l0aW9uSW5kZXhlcyA9IG51bGw7XG4gICAgICBmZWF0dXJlQ29sbGVjdGlvbiA9IGZlYXR1cmVDb2xsZWN0aW9uLnJlcGxhY2VHZW9tZXRyeShcbiAgICAgICAgZmVhdHVyZUluZGV4LFxuICAgICAgICB0aGlzLnN0YXRlLmRyYXdGZWF0dXJlLmdlb21ldHJ5XG4gICAgICApO1xuICAgICAgdXBkYXRlZE1vZGUgPSAnbW9kaWZ5JztcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKGBVbnN1cHBvcnRlZCBnZW9tZXRyeSB0eXBlOiAke3NlbGVjdGVkRmVhdHVyZS5nZW9tZXRyeS50eXBlfWApOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgdXBkYXRlZERhdGEgPSBmZWF0dXJlQ29sbGVjdGlvbi5nZXRPYmplY3QoKTtcblxuICAgIHRoaXMucHJvcHMub25FZGl0KHtcbiAgICAgIHVwZGF0ZWREYXRhLFxuICAgICAgdXBkYXRlZE1vZGUsXG4gICAgICB1cGRhdGVkU2VsZWN0ZWRGZWF0dXJlSW5kZXhlczogdGhpcy5wcm9wcy5zZWxlY3RlZEZlYXR1cmVJbmRleGVzLFxuICAgICAgZWRpdFR5cGU6ICdhZGRQb3NpdGlvbicsXG4gICAgICBmZWF0dXJlSW5kZXgsXG4gICAgICBwb3NpdGlvbkluZGV4ZXMsXG4gICAgICBwb3NpdGlvbjogZ3JvdW5kQ29vcmRzXG4gICAgfSk7XG4gIH1cblxuICBoYW5kbGVEcmF3TmV3UG9pbnQoZ3JvdW5kQ29vcmRzOiBudW1iZXJbXSkge1xuICAgIC8vIFN0YXJ0cyBvZmYgYXMgYSBwb2ludCAoc2luY2UgTGluZVN0cmluZyByZXF1aXJlcyBhdCBsZWFzdCAyIHBvc2l0aW9ucylcbiAgICBjb25zdCBuZXdGZWF0dXJlID0ge1xuICAgICAgdHlwZTogJ0ZlYXR1cmUnLFxuICAgICAgZ2VvbWV0cnk6IHtcbiAgICAgICAgdHlwZTogJ1BvaW50JyxcbiAgICAgICAgY29vcmRpbmF0ZXM6IGdyb3VuZENvb3Jkc1xuICAgICAgfVxuICAgIH07XG5cbiAgICBjb25zdCB1cGRhdGVkRGF0YSA9IHRoaXMuc3RhdGUuZWRpdGFibGVGZWF0dXJlQ29sbGVjdGlvbi5hZGRGZWF0dXJlKG5ld0ZlYXR1cmUpLmdldE9iamVjdCgpO1xuICAgIGNvbnN0IGZlYXR1cmVJbmRleCA9IHRoaXMucHJvcHMuZGF0YS5mZWF0dXJlcy5sZW5ndGg7XG5cbiAgICB0aGlzLnByb3BzLm9uRWRpdCh7XG4gICAgICB1cGRhdGVkRGF0YSxcbiAgICAgIHVwZGF0ZWRNb2RlOiB0aGlzLnByb3BzLm1vZGUsXG4gICAgICB1cGRhdGVkU2VsZWN0ZWRGZWF0dXJlSW5kZXhlczogW2ZlYXR1cmVJbmRleF0sXG4gICAgICBlZGl0VHlwZTogJ2FkZEZlYXR1cmUnLFxuICAgICAgZmVhdHVyZUluZGV4LFxuICAgICAgcG9zaXRpb25JbmRleGVzOiBbMF0sXG4gICAgICBwb3NpdGlvbjogZ3JvdW5kQ29vcmRzXG4gICAgfSk7XG4gIH1cblxuICBnZXRQaWNrZWRFZGl0SGFuZGxlKHBpY2tzOiBPYmplY3RbXSkge1xuICAgIHJldHVybiBwaWNrcy5maW5kKHBpY2sgPT4gcGljay5pc0VkaXRpbmdIYW5kbGUpO1xuICB9XG59XG5cbkVkaXRhYmxlR2VvSnNvbkxheWVyLmxheWVyTmFtZSA9ICdFZGl0YWJsZUdlb0pzb25MYXllcic7XG5FZGl0YWJsZUdlb0pzb25MYXllci5kZWZhdWx0UHJvcHMgPSBkZWZhdWx0UHJvcHM7XG4iXX0=