{"version":3,"file":"browser.es5.es.js","sources":["../src/legacy-provider.js","../src/inject-declaration-compat-mixin.js","../src/constants.js","../src/server.js","../src/browser.js","../src/index.js"],"sourcesContent":["/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport React from 'react';\n\n/**\n * Provides styletron instance via old context API\n */\n\nclass LegacyStyletronProvider extends React.Component<*, *> {\n  styletron: any;\n\n  getChildContext() {\n    return {styletron: this.styletron};\n  }\n  // $FlowFixMe\n  constructor(props, context) {\n    super(props, context);\n    this.styletron = props.value;\n  }\n  render() {\n    return React.Children.only(this.props.children);\n  }\n}\n\nLegacyStyletronProvider.childContextTypes = {\n  styletron: noop,\n};\n\nexport default LegacyStyletronProvider;\n\nfunction noop() {}\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n// $FlowFixMe\nexport const injectDeclarationCompatMixin = Base =>\n  class extends Base {\n    // $FlowFixMe\n    injectDeclaration({prop, val, media, pseudo}) {\n      let style = {[prop]: val};\n      if (pseudo) {\n        style = {\n          [pseudo]: style,\n        };\n      }\n      if (media) {\n        style = {\n          [media]: style,\n        };\n      }\n      return this.renderStyle(style);\n    }\n  };\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nexport const workerRoute = '/__styletron_debugger_worker.js';\nexport const wasmRoute = '/__styletron_debugger_mappings.wasm';\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env node */\n\nimport path from 'path';\nimport fs from 'fs';\n\nimport React from 'react';\nimport {createPlugin, dangerouslySetHTML} from 'fusion-core';\nimport type {FusionPlugin} from 'fusion-core';\n\nimport {Provider as StyletronProvider} from 'styletron-react';\nimport {Server as Styletron} from 'styletron-engine-atomic';\n\nimport LegacyProvider from './legacy-provider.js';\nimport {injectDeclarationCompatMixin} from './inject-declaration-compat-mixin.js';\nimport {workerRoute, wasmRoute} from './constants.js';\n\nlet workerPath;\nlet wasmPath;\n\nif (__DEV__ && __NODE__) {\n  const base = path.dirname(require.resolve('css-to-js-sourcemap-worker'));\n  workerPath = path.resolve(base, 'worker.js');\n  wasmPath = path.resolve(base, 'mappings.wasm');\n}\n\nconst StyletronCompat = injectDeclarationCompatMixin(Styletron);\n\nconst plugin =\n  __NODE__ &&\n  createPlugin({\n    middleware: () => (ctx, next) => {\n      if (__DEV__) {\n        if (ctx.url === workerRoute) {\n          ctx.body = fs.createReadStream(workerPath);\n          return next();\n        }\n        if (ctx.url === wasmRoute) {\n          ctx.body = fs.createReadStream(wasmPath);\n          return next();\n        }\n      }\n\n      if (ctx.element) {\n        const engine = new StyletronCompat();\n\n        ctx.element = (\n          <StyletronProvider value={engine}>\n            <LegacyProvider value={engine}>{ctx.element}</LegacyProvider>\n          </StyletronProvider>\n        );\n\n        return next().then(() => {\n          const stylesForHead = engine.getStylesheetsHtml();\n          ctx.template.head.push(dangerouslySetHTML(stylesForHead));\n        });\n      } else {\n        return next();\n      }\n    },\n  });\n\nexport default ((plugin: any): FusionPlugin<*, *>);\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env browser */\n/* global module */\nimport React from 'react';\nimport {createPlugin} from 'fusion-core';\nimport type {FusionPlugin} from 'fusion-core';\n\nimport {Provider as StyletronProvider, DebugEngine} from 'styletron-react';\nimport {Client as Styletron} from 'styletron-engine-atomic';\nimport {workerRoute, wasmRoute} from './constants.js';\n\nimport LegacyProvider from './legacy-provider.js';\nimport {injectDeclarationCompatMixin} from './inject-declaration-compat-mixin.js';\n\nconst StyletronCompat = injectDeclarationCompatMixin(Styletron);\n\nlet debugEngine;\nlet engine;\n\nconst plugin =\n  __BROWSER__ &&\n  createPlugin({\n    middleware: () => (ctx, next) => {\n      if (ctx.element) {\n        if (!engine) {\n          engine = new StyletronCompat({\n            hydrate: document.getElementsByClassName('_styletron_hydrate_'),\n          });\n        }\n        if (__DEV__ && !debugEngine && typeof Worker !== 'undefined') {\n          const worker = new Worker(workerRoute);\n          worker.postMessage({\n            id: 'init_wasm',\n            url: wasmRoute,\n          });\n          worker.postMessage({\n            id: 'set_render_interval',\n            interval: 180,\n          });\n          // $FlowFixMe\n          if (module.hot) {\n            // $FlowFixMe\n            module.hot.addStatusHandler(status => {\n              if (status === 'dispose') {\n                worker.postMessage({id: 'invalidate'});\n              }\n            });\n          }\n          debugEngine = new DebugEngine(worker);\n        }\n        ctx.element = (\n          <StyletronProvider\n            value={engine}\n            debug={debugEngine}\n            debugAfterHydration={Boolean(debugEngine)}\n          >\n            <LegacyProvider value={engine}>{ctx.element}</LegacyProvider>\n          </StyletronProvider>\n        );\n      }\n\n      return next();\n    },\n  });\n\nexport default ((plugin: any): FusionPlugin<*, *>);\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env browser */\nimport {\n  styled,\n  withStyle,\n  withStyleDeep,\n  withTransform,\n  withWrapper,\n} from 'styletron-react';\n\nimport server from './server';\nimport browser from './browser';\n\ndeclare var __NODE__: Boolean;\n\nexport default (__NODE__ ? server : browser);\nexport {styled, withStyle, withStyleDeep, withTransform, withWrapper};\n"],"names":["LegacyStyletronProvider","getChildContext","styletron","props","context","value","render","React","Children","only","children","Component","childContextTypes","noop","injectDeclarationCompatMixin","Base","injectDeclaration","prop","val","media","pseudo","style","renderStyle","workerRoute","wasmRoute","workerPath","wasmPath","base","path","dirname","require","resolve","StyletronCompat","Styletron","debugEngine","engine","plugin","createPlugin","middleware","ctx","next","element","hydrate","document","getElementsByClassName","Worker","worker","postMessage","id","url","interval","module","hot","addStatusHandler","status","DebugEngine","StyletronProvider","Boolean","LegacyProvider","browser"],"mappings":";;;;;;;;;;;;;;;;AAQA,AAEA;;;;IAIMA;;;;;;;SAGJC,6CAAkB;WACT;MAACC,SAAS,EAAE,KAAKA;KAAxB;;;;mCAGUC,KAAZ,EAAmBC,OAAnB,EAA4B;;;wCACpBD,KAAN,EAAaC,OAAb;UACKF,SAAL,GAAiBC,KAAK,CAACE,KAAvB;;;;SAEFC,2BAAS;WACAC,KAAK,CAACC,QAAN,CAAeC,IAAf,CAAoB,KAAKN,KAAL,CAAWO,QAA/B,CAAP;;;;EAZkCH,KAAK,CAACI;;AAgB5CX,uBAAuB,CAACY,iBAAxB,GAA4C;EAC1CV,SAAS,EAAEW;CADb;AAIA,AAEA,SAASA,IAAT,GAAgB;;;;;;;;;;;;AC3BhB,AAAO,IAAMC,4BAA4B,GAAG,SAA/BA,4BAA+B,CAAAC,IAAI;;;;;;;;;;;;;aAG5CC,iBAH4C,oCAGE;;;YAA3BC,IAA2B,QAA3BA,IAA2B;YAArBC,GAAqB,QAArBA,GAAqB;YAAhBC,KAAgB,QAAhBA,KAAgB;YAATC,MAAS,QAATA,MAAS;YACxCC,KAAK,wBAAKJ,IAAL,IAAYC,GAAZ,SAAT;;YACIE,MAAJ,EAAY;;;UACVC,KAAK,0BACFD,MADE,IACOC,KADP,UAAL;;;YAIEF,KAAJ,EAAW;;;UACTE,KAAK,0BACFF,KADE,IACME,KADN,UAAL;;;eAIK,KAAKC,WAAL,CAAiBD,KAAjB,CAAP;OAf0C;;;MAChCN,IADgC;;CAAzC;;ACTP;;;;;;;AAQA,AAAO,IAAMQ,WAAW,GAAG,iCAApB;AACP,AAAO,IAAMC,SAAS,GAAG,qCAAlB;;ACTP;;;;;;;;;AAUA,AAcA,IAAIC,UAAJ;AACA,IAAIC,QAAJ;;AAEA,IAAI,8CAAJ,EAAyB;MACjBC,IAAI,GAAGC,IAAI,CAACC,OAAL,CAAaC,OAAO,CAACC,OAAR,CAAgB,4BAAhB,CAAb,CAAb;EACAN,UAAU,GAAGG,IAAI,CAACG,OAAL,CAAaJ,IAAb,EAAmB,WAAnB,CAAb;EACAD,QAAQ,GAAGE,IAAI,CAACG,OAAL,CAAaJ,IAAb,EAAmB,eAAnB,CAAX;;;AAGF,IAAMK,eAAe,GAAGlB,4BAA4B,CAACmB,MAAD,CAApD;;ACjCA;;;;;;;;;;;AAUA,AAWA,IAAMD,iBAAe,GAAGlB,4BAA4B,CAACmB,MAAD,CAApD;AAEA,IAAIC,WAAJ;AACA,IAAIC,MAAJ;AAEA,IAAMC,QAAM,GACV,QACAC,YAAY,CAAC;EACXC,UAAU,EAAE;WAAM,UAACC,GAAD,EAAMC,IAAN,EAAe;UAC3BD,GAAG,CAACE,OAAR,EAAiB;YACX,CAACN,MAAL,EAAa;UACXA,MAAM,GAAG,IAAIH,iBAAJ,CAAoB;YAC3BU,OAAO,EAAEC,QAAQ,CAACC,sBAAT,CAAgC,qBAAhC;WADF,CAAT;;;YAIE,yCAAW,CAACV,WAAZ,IAA2B,OAAOW,MAAP,KAAkB,WAAjD,EAA8D;cACtDC,MAAM,GAAG,IAAID,MAAJ,CAAWtB,WAAX,CAAf;UACAuB,MAAM,CAACC,WAAP,CAAmB;YACjBC,EAAE,EAAE,WADa;YAEjBC,GAAG,EAAEzB;WAFP;UAIAsB,MAAM,CAACC,WAAP,CAAmB;YACjBC,EAAE,EAAE,qBADa;YAEjBE,QAAQ,EAAE;WAFZ,EAN4D;;cAWxDC,MAAM,CAACC,GAAX,EAAgB;;YAEdD,MAAM,CAACC,GAAP,CAAWC,gBAAX,CAA4B,UAAAC,MAAM,EAAI;kBAChCA,MAAM,KAAK,SAAf,EAA0B;gBACxBR,MAAM,CAACC,WAAP,CAAmB;kBAACC,EAAE,EAAE;iBAAxB;;aAFJ;;;UAMFd,WAAW,GAAG,IAAIqB,WAAJ,CAAgBT,MAAhB,CAAd;;;QAEFP,GAAG,CAACE,OAAJ,GACE,oBAACe,QAAD;UACE,KAAK,EAAErB,MADT;UAEE,KAAK,EAAED,WAFT;UAGE,mBAAmB,EAAEuB,OAAO,CAACvB,WAAD;WAE5B,oBAACwB,uBAAD;UAAgB,KAAK,EAAEvB;WAASI,GAAG,CAACE,OAApC,CALF,CADF;;;aAWKD,IAAI,EAAX;KAvCU;;CADF,CAFd;;AC1BA;;;;;;;;;AASA,AAaA,YAAoCmB,QAApC;;;;"}